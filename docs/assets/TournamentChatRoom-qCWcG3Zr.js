import{c as N,u as C,j as e}from"./index-BI1Zh8jC.js";import{r}from"./react-vendor-wpuS94OW.js";import{t as x}from"./TournamentService-C6zcdh7M.js";import{M as _}from"./message-square-BC04dgYS.js";import{U as L}from"./users-Doj8e7tS.js";import{S as y}from"./shield-UrmeYB5b.js";import{L as g}from"./loader-circle-DGd37Dy2.js";import{A as R,m as T}from"./animation-vendor-DcM-v-LS.js";import{S as A}from"./send-BLDoqAZd.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M15 9.34V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H7.89",key:"znwnzq"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h11",key:"c9qhm2"}]],V=N("pin-off",E);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]],j=N("pin",D),G=({tournamentId:o,tournamentName:v,isAdmin:i=!1})=>{const{user:c}=C(),[n,d]=r.useState([]),[l,h]=r.useState(""),[m,p]=r.useState(!1),u=r.useRef(null),[k,M]=r.useState(!0);r.useEffect(()=>{const s=async()=>{try{const t=await x.getChatMessages(o);t&&Array.isArray(t)&&d(t)}catch{}finally{M(!1)}};s();const a=setInterval(s,3e3);return()=>clearInterval(a)},[o]),r.useEffect(()=>{z()},[n.length]);const z=()=>{u.current?.scrollIntoView({behavior:"smooth"})},f=async()=>{if(!l.trim()||!c)return;p(!0);const a={_id:Date.now().toString(),userId:c.uid||c.id||"user",userName:c.displayName||"Me",userRole:i?"host":"player",message:l.trim(),createdAt:new Date().toISOString(),isPinned:!1};d(t=>[...t,a]),h("");try{await x.sendChatMessage(o,l.trim())}catch{}finally{p(!1)}},b=async s=>{if(i)try{d(a=>a.map(t=>t._id===s||t.id===s?{...t,isPinned:!t.isPinned}:t)),await x.pinMessage(o,s)}catch{}},S=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),f())},w=n.filter(s=>s.isPinned),P=n;return e.jsxs("div",{className:"bg-zinc-900/60 backdrop-blur-3xl border border-white/5 rounded-2xl overflow-hidden shadow-2xl flex flex-col h-[500px]",children:[e.jsx("div",{className:"bg-gradient-to-r from-teal-500/10 to-cyan-500/10 border-b border-white/5 p-4 shrink-0",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-teal-500/20 border border-teal-500/30 flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-teal-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-black text-white uppercase tracking-wider",children:"Tournament Chat"}),e.jsx("p",{className:"text-xs text-zinc-500",children:v})]}),e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-zinc-950/40 rounded-lg border border-white/5",children:[e.jsx(L,{className:"w-3 h-3 text-zinc-500"}),e.jsx("span",{className:"text-xs font-bold text-zinc-400",children:n.length})]})]})}),w.length>0&&e.jsxs("div",{className:"bg-yellow-500/5 border-b border-yellow-500/20 p-4 shrink-0 max-h-[150px] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 sticky top-0 bg-transparent",children:[e.jsx(j,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-xs font-black text-yellow-500 uppercase tracking-wider",children:"Pinned Messages"})]}),e.jsx("div",{className:"space-y-2",children:w.map(s=>e.jsxs("div",{className:"bg-yellow-500/10 rounded-lg p-3 border border-yellow-500/20",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-3 h-3 text-yellow-500"}),e.jsx("span",{className:"text-xs font-bold text-yellow-500",children:s.userName})]}),i&&e.jsx("button",{onClick:()=>b(s._id||s.id),className:"text-yellow-600 hover:text-yellow-500 transition-colors",children:e.jsx(V,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-sm text-white whitespace-pre-wrap leading-relaxed",children:s.message})]},`pin-${s._id||s.id}`))})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 scroll-smooth bg-zinc-950/20",children:[k&&n.length===0?e.jsxs("div",{className:"flex items-center justify-center h-full text-zinc-500 text-xs uppercase tracking-widest",children:[e.jsx(g,{className:"w-5 h-5 animate-spin mr-2"})," Loading Comms..."]}):e.jsx(R,{initial:!1,children:P.map(s=>{const a=s.userRole==="host"||s.userRole==="admin";return e.jsxs(T.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`group ${a?"bg-teal-500/10 border border-teal-500/20 ml-auto max-w-[90%]":"bg-zinc-800/40 border border-white/5 mr-auto max-w-[90%]"} rounded-2xl p-3 hover:bg-opacity-100 transition-all`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsx(y,{className:"w-3 h-3 text-teal-400"}),e.jsx("span",{className:`text-xs font-bold ${a?"text-teal-400":"text-zinc-400"}`,children:s.userName}),e.jsx("span",{className:"text-[9px] text-zinc-600",children:new Date(s.createdAt||s.timestamp).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})})]}),i&&!s.isPinned&&e.jsx("button",{onClick:()=>b(s._id||s.id),className:"opacity-0 group-hover:opacity-100 text-zinc-600 hover:text-teal-400 transition-all",title:"Pin Message",children:e.jsx(j,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-sm text-white whitespace-pre-wrap leading-relaxed break-words",children:s.message})]},s._id||s.id)})}),e.jsx("div",{ref:u})]}),e.jsx("div",{className:"border-t border-white/5 p-4 bg-zinc-900/80 shrink-0",children:e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("textarea",{value:l,onChange:s=>h(s.target.value),onKeyPress:S,placeholder:i?"Type an announcement...":"Type your message...",rows:1,className:"w-full px-4 py-3 bg-zinc-800/50 border border-white/5 rounded-xl text-white placeholder-zinc-500 focus:outline-none focus:border-teal-500/30 transition-colors resize-none overflow-hidden",maxLength:500})}),e.jsx("button",{onClick:f,disabled:!l.trim()||m,className:"px-5 py-3 bg-teal-500 hover:bg-teal-400 rounded-xl font-black text-sm uppercase tracking-widest text-black transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:m?e.jsx(g,{className:"w-4 h-4 animate-spin"}):e.jsx(A,{className:"w-4 h-4"})})]})})]})};export{G as T};
