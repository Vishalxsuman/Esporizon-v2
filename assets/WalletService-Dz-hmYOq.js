import{a as o}from"./index-B9ygI19o.js";class i{pollingInterval=null;currentUserId=null;async getWallet(t){this.setupRealtimeSync(t);try{let e="https://api.esporizon.in/api";e||(console.warn("VITE_API_URL missing in WalletService, using fallback"),e="https://api.esporizon.in/api"),console.log("ðŸ’° WalletService fetching from:",`${e}/wallet`);const a=await o.get(`${e}/wallet`,{headers:{"user-id":t}});return{balance:a.data.balance||0,espoCoins:a.data.balance||0,transactions:[]}}catch(e){return console.error("Error fetching wallet from backend:",e),{balance:0,espoCoins:0,transactions:[]}}}setupRealtimeSync(t){this.currentUserId===t&&this.pollingInterval||(this.pollingInterval&&clearInterval(this.pollingInterval),this.currentUserId=t,this.pollingInterval=setInterval(async()=>{try{let e="https://api.esporizon.in/api";e||(e="https://api.esporizon.in/api");const a=await o.get(`${e}/wallet`,{headers:{"user-id":t}}),n={balance:a.data.balance||0,espoCoins:a.data.balance||0,transactions:[]};window.dispatchEvent(new CustomEvent("walletUpdate",{detail:n}))}catch(e){console.error("Wallet polling error:",e)}},5e3))}async addFunds(t,e){try{const a=await window.Clerk?.session?.getToken({template:"firebase"});if(!a)throw new Error("Authentication required - please login");let n="https://api.esporizon.in/api";n||(n="https://api.esporizon.in/api");const s=await o.post(`${n}/predict/wallet/deposit`,{amount:t},{headers:{Authorization:`Bearer ${a}`}});if(s.data.success&&s.data.balance!==void 0){const r={balance:s.data.balance,espoCoins:s.data.balance,transactions:[]};window.dispatchEvent(new CustomEvent("walletUpdate",{detail:r}))}}catch(a){throw console.error("Error adding funds:",a),new Error("Failed to deposit funds")}}async withdrawFunds(t,e,a){console.warn("Withdraw API not integrated")}async addEspoCoins(t,e,a){}async deductEspoCoins(t,e,a,n){}async convertINRToEspoCoins(t,e){}subscribeToWallet(t,e){let a="https://api.esporizon.in/api";const n=async()=>{try{const r=await o.get(`${a}/wallet`,{headers:{"user-id":t}});e({balance:r.data.balance||0,espoCoins:r.data.balance||0,transactions:[]})}catch(r){console.error("Wallet subscription error:",r)}};n();const s=setInterval(n,5e3);return()=>clearInterval(s)}}const p=new i;export{p as w};
