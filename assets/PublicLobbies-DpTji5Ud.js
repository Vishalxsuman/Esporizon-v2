import{a as j,j as e}from"./index--b10zKEF.js";import{d as N,r as n}from"./react-vendor-wpuS94OW.js";import{m as p,f as y}from"./espoCoin-CHE-5TF3.js";import{w as h}from"./WalletService-Dz-hmYOq.js";import{z as o}from"./index-CNUiO53a.js";import{A as w}from"./arrow-left-DXLZyVYx.js";import{S as E}from"./search-D0vMK7kb.js";import{m as C}from"./animation-vendor-DcM-v-LS.js";import{U as k}from"./users-BZz0W578.js";import{Z as L}from"./zap-DmD6sY9k.js";import"./firebase-CrKjQ57N.js";import"./index-B9ygI19o.js";const D=()=>{const c=N(),{user:t}=j(),[d,v]=n.useState([]),[b,g]=n.useState(!0),[s,l]=n.useState("all");n.useEffect(()=>{m();const a=setInterval(m,5e3);return()=>clearInterval(a)},[s]);const m=async()=>{try{const a=s==="all"?void 0:s,r=await p.getPublicLobbies(a);v(r)}catch(a){console.error("Error loading lobbies:",a)}finally{g(!1)}},f=async(a,r)=>{if(t)try{if(r>0){if((await h.getWallet(t.id)).espoCoins<r){o.error("Insufficient Espo Coins!");return}await h.deductEspoCoins(r,t.id,"Entry fee for match",{matchId:a})}await p.joinMatch({matchId:a,userId:t.id,userName:t.fullName||t.firstName||"Player",userAvatar:t.imageUrl}),o.success("Joined match!"),c(`/play/match/${a}`)}catch(i){console.error("Error joining match:",i),o.error(i instanceof Error?i.message:"Failed to join match")}},u=a=>{const r=new Date(a),i=new Date,x=r.getTime()-i.getTime();return x<=0?"Expired":`${Math.floor(x/6e4)}m left`};return e.jsx("div",{className:"min-h-screen bg-[var(--bg-primary)] text-[var(--text-primary)] pb-24 lg:pb-8",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>c("/play"),className:"flex items-center gap-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] mb-4",children:[e.jsx(w,{className:"w-5 h-5"}),"Back to Play"]}),e.jsx("h1",{className:"text-3xl font-black mb-2",children:"Public Lobbies"}),e.jsx("p",{className:"text-[var(--text-secondary)]",children:"Join an open match or create your own"})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:()=>l("all"),className:`px-4 py-2 rounded-lg font-bold transition-all ${s==="all"?"bg-[var(--accent)] text-[var(--bg-primary)]":"bg-[var(--glass)] border border-[var(--border)]"}`,children:"All Games"}),e.jsx("button",{onClick:()=>l("chess"),className:`px-4 py-2 rounded-lg font-bold transition-all ${s==="chess"?"bg-[var(--accent)] text-[var(--bg-primary)]":"bg-[var(--glass)] border border-[var(--border)]"}`,children:"Chess"}),e.jsx("button",{onClick:()=>l("card29"),className:`px-4 py-2 rounded-lg font-bold transition-all ${s==="card29"?"bg-[var(--accent)] text-[var(--bg-primary)]":"bg-[var(--glass)] border border-[var(--border)]"}`,children:"29 Card Game"})]}),b?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[var(--accent)]"})}):d.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(E,{className:"w-16 h-16 mx-auto mb-4 text-[var(--text-secondary)] opacity-30"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No public lobbies"}),e.jsx("p",{className:"text-[var(--text-secondary)] mb-6",children:"Be the first to create one!"}),e.jsx("button",{onClick:()=>c("/play"),className:"px-6 py-3 bg-[var(--accent)] text-[var(--bg-primary)] font-bold rounded-lg hover:bg-[var(--accent)]/90 transition-all",children:"Create Match"})]}):e.jsx("div",{className:"grid gap-4",children:d.map((a,r)=>e.jsx(C.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:r*.05},className:"p-6 bg-[var(--glass)] rounded-xl border border-[var(--border)] hover:border-[var(--accent)]/30 transition-all",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-[var(--accent)] to-purple-500 flex items-center justify-center text-2xl",children:a.gameId==="chess"?"â™Ÿï¸":"ðŸƒ"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-lg",children:a.gameName}),e.jsxs("p",{className:"text-sm text-[var(--text-secondary)]",children:["by ",a.creatorName]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-[var(--text-secondary)]"}),e.jsxs("span",{children:[a.players.length,"/",a.maxPlayers," players"]})]}),a.mode==="paid"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-[var(--accent)]"}),e.jsxs("span",{className:"font-bold text-[var(--accent)]",children:[y(a.entryFee)," Entry"]})]}):e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"px-2 py-1 bg-green-500/20 text-green-400 rounded text-xs font-bold",children:"FREE"})}),e.jsx("div",{className:"text-[var(--text-secondary)]",children:a.expiresAt?u(a.expiresAt):"No limit"})]})]}),e.jsx("button",{onClick:()=>f(a.id,a.entryFee),className:"px-6 py-3 bg-[var(--accent)] text-[var(--bg-primary)] font-bold rounded-lg hover:bg-[var(--accent)]/90 transition-all whitespace-nowrap",children:"Join Match"})]})},a.id))})]})})};export{D as default};
