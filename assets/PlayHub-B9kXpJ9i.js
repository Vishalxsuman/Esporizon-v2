import{a as M,j as e}from"./index--b10zKEF.js";import{d as O,r as b}from"./react-vendor-wpuS94OW.js";import{f as U,m as N}from"./espoCoin-CHE-5TF3.js";import{c as $,q as z,w as E,o as F,l as q,g as B,d as H,u as C,f as J,b as T,h as Y}from"./firebase-CrKjQ57N.js";import{w as Z}from"./WalletService-Dz-hmYOq.js";import{P as V}from"./ParticlesBackground-DMR5guET.js";import{z as D}from"./index-CNUiO53a.js";import{Z as X}from"./zap-DmD6sY9k.js";import{U as K}from"./users-BZz0W578.js";import{C as Q}from"./crown-xaJh6Xtk.js";import{A as ee,m as k}from"./animation-vendor-DcM-v-LS.js";import{X as te}from"./x-ByfO-DNc.js";import"./index-B9ygI19o.js";class ae{leaderboardsCollection=$(T,"leaderboards");async getLeaderboard(l){try{const a=z(this.leaderboardsCollection,E("type","==",l),E("period","==","weekly"),F("createdAt","desc"),q(1)),r=await B(a);if(r.empty)return await this.createLeaderboard(l);const s=r.docs[0];return{id:s.id,...s.data()}}catch(a){return console.error("Error getting leaderboard:",a),null}}async getUserRank(l,a){try{const r=await this.getLeaderboard(a);if(!r)return null;const s=r.entries.find(d=>d.userId===l);return s?s.rank:null}catch(r){return console.error("Error getting user rank:",r),null}}async updateLeaderboardEntry(l,a,r,s,d){try{const o=await this.getLeaderboard(s);if(!o)return;const x=H(this.leaderboardsCollection,o.id),f=o.entries.findIndex(u=>u.userId===l);if(f>=0){const u=o.entries[f];u.gamesPlayed+=d.gamesPlayed||0,u.gamesWon+=d.gamesWon||0,u.totalEarnings+=d.earnings||0,o.entries.sort((n,i)=>s==="top_earners"?i.totalEarnings-n.totalEarnings:i.gamesWon-n.gamesWon),o.entries.forEach((n,i)=>{n.rank=i+1,i===0?n.badge="gold":i===1?n.badge="silver":i===2?n.badge="bronze":delete n.badge}),await C(x,{entries:o.entries})}else{const u={userId:l,userName:a,userAvatar:r,gamesPlayed:d.gamesPlayed||0,gamesWon:d.gamesWon||0,totalEarnings:d.earnings||0,rank:o.entries.length+1};o.entries.push(u),o.entries.sort((n,i)=>s==="top_earners"?i.totalEarnings-n.totalEarnings:i.gamesWon-n.gamesWon),o.entries.forEach((n,i)=>{n.rank=i+1,i===0?n.badge="gold":i===1?n.badge="silver":i===2?n.badge="bronze":delete n.badge}),await C(x,{entries:o.entries})}}catch(o){throw console.error("Error updating leaderboard entry:",o),new Error("Failed to update leaderboard")}}async createLeaderboard(l){const a=new Date,r=this.getWeekStart(a),s=new Date(r);s.setDate(s.getDate()+7);const d=new Date(s),o={type:l,period:"weekly",weekStartDate:r.toISOString(),weekEndDate:s.toISOString(),entries:[],resetAt:d.toISOString(),createdAt:a.toISOString()},x=await J(this.leaderboardsCollection,{...o,createdAt:Y(),resetAt:d});return{...o,id:x.id}}getWeekStart(l){const a=new Date(l),r=a.getDay(),s=a.getDate()-r+(r===0?-6:1),d=new Date(a.setDate(s));return d.setHours(0,0,0,0),d}async checkAndResetLeaderboards(){try{const l=["overall_champions","free_masters","top_earners"];for(const a of l){const r=await this.getLeaderboard(a);if(!r)continue;const s=new Date(r.resetAt);new Date>=s&&await this.createLeaderboard(a)}}catch(l){console.error("Error checking leaderboards:",l)}}}const re=new ae,pe=()=>{const{user:c}=M(),l=O(),[a,r]=b.useState(null),[s,d]=b.useState(0),[o,x]=b.useState(null),[f,u]=b.useState(!0),[n,i]=b.useState(!1),[y,P]=b.useState(""),[S,A]=b.useState(null),[j,w]=b.useState(!1);b.useEffect(()=>{(async()=>{if(c)try{const m=await Z.getWallet(c.id);r(m);const g=await N.getUserMatches(c.id);d(g.length);const h=await re.getUserRank(c.id,"overall_champions");x(h)}catch(m){console.error("Error loading data:",m)}u(!1)})()},[c]);const I=()=>{const t=localStorage.getItem("guest_identity");return t?JSON.parse(t):null},L=t=>{const m={id:`guest_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:t,avatar:`https://api.dicebear.com/7.x/avataaars/svg?seed=${t}`};return localStorage.setItem("guest_identity",JSON.stringify(m)),m},v=async(t,m)=>{w(!0);try{const g=c?{id:c.id,name:c.fullName||c.username||"Player",avatar:c.imageUrl}:m||I();if(!g){A(t),i(!0),w(!1);return}if(t.type==="create"){const{gameId:h,mode:p}=t.data;if(p==="paid"&&!c){D.error("Guests can only play Free matches. Please login to play Paid."),w(!1);return}const _=await N.createMatch({gameId:h,mode:p,maxPlayers:h==="chess"?2:4,entryFee:p==="paid"?10:0,visibility:"private",withBots:!1},g.id,g.name,g.avatar);l(`/play/match/${_.id}`)}else if(t.type==="join"){const{code:h}=t.data,p=await N.joinRoom(h,g);l(`/play/match/${p.id}`)}}catch(g){D.error(g.message||"Action failed")}finally{w(!1),i(!1)}},R=()=>{if(!y.trim())return;const t=L(y);S&&v(S,t)},W=[{id:"chess",name:"Online Chess",icon:"â™Ÿï¸",players:2,desc:"Strategy"},{id:"card29",name:"29 Card Game",icon:"ðŸƒ",players:4,desc:"Multiplayer"}],G=[{label:"Espo Coins",value:a?U(a.espoCoins):"0 EC",icon:X,color:"text-yellow-400"},{label:"Active Matches",value:s,icon:K,color:"text-blue-400"},{label:"Rank",value:o?`#${o}`:"N/A",icon:Q,color:"text-[var(--accent)]"}];return f?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#0a0f1e] text-cyan-400",children:"Loading..."}):e.jsxs("div",{className:"min-h-screen bg-[#0a0f1e] text-white pb-24 relative overflow-hidden",children:[e.jsx(V,{}),e.jsx(ee,{children:n&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:e.jsxs(k.div,{initial:{scale:.9},animate:{scale:1},exit:{scale:.9},className:"bg-[#1a2332] w-full max-w-md p-6 rounded-2xl border border-white/10 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold bg-gradient-to-r from-cyan-400 to-purple-500 bg-clip-text text-transparent",children:"Enter Guest Name"}),e.jsx("button",{onClick:()=>i(!1),children:e.jsx(te,{className:"text-white/50 hover:text-white"})})]}),e.jsx("input",{type:"text",value:y,onChange:t=>P(t.target.value),placeholder:"Your Display Name...",className:"w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white mb-6 focus:border-cyan-400 outline-none",autoFocus:!0}),e.jsx("button",{onClick:R,disabled:!y.trim()||j,className:"w-full bg-gradient-to-r from-cyan-500 to-blue-600 py-3 rounded-xl font-bold text-white hover:opacity-90 disabled:opacity-50",children:j?"Processing...":"Continue as Guest"})]})})}),e.jsxs("div",{className:"relative pt-24 pb-12 px-4 text-center",children:[e.jsx(k.h1,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},className:"text-4xl md:text-6xl font-black mb-4 bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:"PLAY & EARN"}),e.jsx("p",{className:"text-white/60 text-lg max-w-2xl mx-auto mb-8",children:"Challenge players worldwide. No login needed for free games."}),c&&e.jsx("div",{className:"flex justify-center gap-4 flex-wrap mb-8",children:G.map((t,m)=>e.jsxs("div",{className:"bg-white/5 border border-white/10 rounded-xl p-4 flex items-center gap-3 backdrop-blur-md",children:[e.jsx("div",{className:`p-2 rounded-lg bg-white/5 ${t.color}`,children:e.jsx(t.icon,{size:20})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-xs text-white/40",children:t.label}),e.jsx("div",{className:"font-bold",children:t.value})]})]},m))})]}),e.jsx("div",{className:"max-w-xl mx-auto px-4 mb-16",children:e.jsx("div",{className:"bg-gradient-to-br from-white/10 to-white/5 rounded-2xl p-1 border border-white/10 shadow-2xl",children:e.jsxs("div",{className:"bg-[#0a0f1e]/90 rounded-xl p-6 backdrop-blur-xl",children:[e.jsx("label",{className:"block text-xs font-bold text-cyan-400 uppercase tracking-widest mb-3",children:"Have a Room Code?"}),e.jsxs("form",{onSubmit:t=>{t.preventDefault();const m=t.target.code.value;m&&v({type:"join",data:{code:m}})},className:"flex gap-2",children:[e.jsx("input",{name:"code",type:"text",placeholder:"ENTER CODE",className:"flex-1 bg-black/40 border border-white/10 rounded-xl px-4 font-mono text-center tracking-widest uppercase focus:border-cyan-400 outline-none",maxLength:8}),e.jsx("button",{type:"submit",disabled:j,className:"bg-cyan-500 hover:bg-cyan-400 text-black font-bold px-6 py-3 rounded-xl transition-all",children:"JOIN"})]})]})})}),e.jsx("div",{className:"max-w-6xl mx-auto px-4 grid md:grid-cols-2 gap-6",children:W.map(t=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-cyan-500/20 to-purple-500/20 rounded-3xl blur-xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"relative bg-[#131b2a] border border-white/10 rounded-3xl p-8 hover:border-white/20 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-8",children:[e.jsx("div",{className:"text-5xl",children:t.icon}),e.jsxs("div",{className:"px-3 py-1 rounded-full bg-green-500/10 border border-green-500/20 text-green-400 text-xs font-bold flex items-center gap-2",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"}),"LIVE"]})]}),e.jsx("h3",{className:"text-2xl font-bold mb-2",children:t.name}),e.jsxs("p",{className:"text-white/40 mb-8",children:[t.desc," â€¢ ",t.players," Players"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{onClick:()=>v({type:"create",data:{gameId:t.id,mode:"free"}}),className:"py-3 rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 font-bold transition-all",children:"Create Free"}),e.jsx("button",{onClick:()=>v({type:"create",data:{gameId:t.id,mode:"paid"}}),className:"py-3 rounded-xl bg-gradient-to-r from-cyan-600 to-blue-600 hover:opacity-90 font-bold shadow-lg shadow-cyan-500/20 transition-all",children:"Create Paid"})]})]})]},t.id))})]})};export{pe as default};
