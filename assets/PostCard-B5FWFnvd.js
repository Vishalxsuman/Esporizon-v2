import{c as C,u as q,j as e}from"./index--b10zKEF.js";import{r as f,L as H}from"./react-vendor-wpuS94OW.js";import{c as g,q as y,l as P,o as j,g as T,a as S,w as E,d as L,r as R,e as V,f as G,b as h}from"./firebase-CrKjQ57N.js";import{z as v}from"./index-CNUiO53a.js";import{m as k,A as $}from"./animation-vendor-DcM-v-LS.js";import{X as O}from"./x-ByfO-DNc.js";import{U}from"./user-Crfu7g3f.js";import{L as J}from"./lock-BbG5lLOB.js";import{S as Q}from"./share-2-C4AXdlKf.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],K=C("ellipsis",X);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Y=C("heart",W);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],M=C("loader-circle",Z);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],te=C("message-circle",ee);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ae=C("send",se),p="posts";class re{async getTodaysPosts(s=20){const t=g(h,p),a=y(t,j("createdAt","desc"),P(s));return(await T(a)).docs.map(i=>({id:i.id,...i.data()}))}subscribePublicPosts(s=20,t){const a=g(h,p),c=y(a,j("createdAt","desc"),P(s*2));return S(c,i=>{const n=i.docs.map(r=>({id:r.id,...r.data()})).filter(r=>r.visibility!=="private").slice(0,s);t(n)},i=>{console.error("Firestore [subscribePublicPosts] error:",i)})}subscribeUserPosts(s,t=20,a){const c=g(h,p),i=y(c,E("userId","==",s),j("createdAt","desc"),P(t));return S(i,n=>{const r=n.docs.map(m=>({id:m.id,...m.data()}));a(r)},n=>{if(console.error("Firestore [subscribeUserPosts] error:",n),n.code==="failed-precondition"){const r=y(c,E("userId","==",s));S(r,m=>{const x=m.docs.map(l=>({id:l.id,...l.data()})).sort((l,u)=>u.createdAt.localeCompare(l.createdAt)).slice(0,t);a(x)})}})}subscribeToPostsByRange(s,t=20,a){return this.subscribePublicPosts(t,a)}async toggleLike(s,t){if(!t)throw new Error("Authentication Required");const a=L(h,p,s);await R(h,async c=>{const i=await c.get(a);if(!i.exists())throw new Error("Post does not exist");const n=i.data(),r=n.likes||[],m=r.includes(t),x=typeof n.likeCount=="number"?n.likeCount:r.length;if(m){const l=r.filter(u=>u!==t);c.update(a,{likes:l,likeCount:Math.max(0,x-1)})}else{const l=[...r,t];c.update(a,{likes:l,likeCount:x+1})}})}async toggleLikeStatus(s,t,a){return this.toggleLike(s,t)}async sharePost(s){const t={title:"ESPO V2 Post",text:s.content,url:window.location.origin+`/social?post=${s.id}`};try{navigator.share?await navigator.share(t):await navigator.clipboard.writeText(t.url)}catch(a){console.error("Share failed",a)}}async deletePost(s){const t=L(h,p,s);await V(t)}async addComment(s,t,a,c,i){if(!t||!c.trim())return;const n=L(h,p,s),r=g(n,"comments"),m={userId:t,userName:a,userAvatar:i||"",content:c,createdAt:new Date().toISOString()},x=L(r);await R(h,async l=>{const u=await l.get(n);if(!u.exists())throw new Error("Post does not exist");const d=u.data(),w=typeof d.commentCount=="number"?d.commentCount:0;l.set(x,m),l.update(n,{commentCount:w+1})})}subscribeToComments(s,t){const a=g(h,p,s,"comments"),c=y(a,j("createdAt","desc"));return S(c,i=>{const n=i.docs.map(r=>({id:r.id,...r.data()}));t(n)})}async getComments(s){const t=g(h,p,s,"comments"),a=y(t,j("createdAt","desc"));return(await T(a)).docs.map(i=>({id:i.id,...i.data()}))}async createPost(s,t,a,c,i,n="public"){const r=g(h,p),m={userId:a,userName:c,userAvatar:i||"",content:s,imageUrl:t||"",likes:[],likeCount:0,shares:[],commentCount:0,visibility:n,createdAt:new Date().toISOString()};await G(r,m)}}const N=new re,ie=({postId:o,onClose:s})=>{const[t,a]=f.useState([]),[c,i]=f.useState(""),[n,r]=f.useState(!1),[m,x]=f.useState(!0),{user:l}=q();f.useEffect(()=>{x(!0);const d=N.subscribeToComments(o,w=>{a(w),x(!1)});return()=>d()},[o]);const u=async d=>{if(d.preventDefault(),!l){v.error("Tactical Error: Authorization Required");return}if(c.trim()){r(!0);try{await N.addComment(o,l.id,l.displayName||"Anonymous",c.trim(),l.photoURL||""),i("")}catch{v.error("Signal Error: Failed to drop intel")}finally{r(!1)}}};return e.jsxs(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-4 bg-black/40 rounded-3xl border border-white/5 overflow-hidden flex flex-col max-h-[400px]",children:[e.jsxs("div",{className:"p-4 border-b border-white/5 flex items-center justify-between bg-white/[0.02]",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-[0.2em] text-gray-400",children:"Tactical Comm Log"}),e.jsx("button",{onClick:s,className:"p-1 hover:bg-white/5 rounded-lg text-gray-500 hover:text-white transition-colors",children:e.jsx(O,{size:14})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar",children:m?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(M,{className:"w-5 h-5 text-[#00ffc2] animate-spin"})}):t.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-[10px] font-bold text-gray-600 uppercase tracking-widest",children:"Silence on the network..."})}):t.map(d=>e.jsxs("div",{className:"flex gap-3 group",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-[#00ffc2]/20 to-[#7c3aed]/20 p-[1px] shrink-0",children:e.jsx("div",{className:"w-full h-full rounded-full bg-[#18181b] flex items-center justify-center overflow-hidden",children:d.userAvatar?e.jsx("img",{src:d.userAvatar,alt:"",className:"w-full h-full object-cover"}):e.jsx(U,{className:"w-3 h-3 text-gray-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-[10px] font-black text-[#00ffc2] uppercase tracking-tighter",children:["@",d.userName]}),e.jsx("span",{className:"text-[8px] font-bold text-gray-600 uppercase tracking-widest",children:new Date(d.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{className:"text-xs text-gray-300 leading-relaxed bg-white/[0.03] p-3 rounded-2xl border border-white/5",children:d.content})]})]},d.id))}),e.jsxs("form",{onSubmit:u,className:"p-4 bg-white/[0.02] border-t border-white/5 flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:d=>i(d.target.value),placeholder:"Input intel...",className:"flex-1 bg-[#09090b] border border-white/5 rounded-xl px-4 py-2 text-xs focus:outline-none focus:border-[#00ffc2]/50 transition-colors",disabled:n}),e.jsx("button",{type:"submit",disabled:n||!c.trim(),className:"p-2 bg-[#00ffc2] text-black rounded-xl hover:scale-105 active:scale-95 transition-all disabled:opacity-50 disabled:hover:scale-100",children:n?e.jsx(M,{size:16,className:"animate-spin"}):e.jsx(ae,{size:16})})]})]})},fe=({post:o,index:s})=>{const[t,a]=f.useState(!1),[c,i]=f.useState(!1),[n,r]=f.useState(!1),[m,x]=f.useState(!1),{user:l}=q(),u=l?o.likes?.includes(l.id):!1,d=l?.id===o.userId,w=async()=>{if(!l){v.error("Sign in to like");return}if(!c){i(!0);try{await N.toggleLike(o.id,l.id)}catch{v.error("Failed to update like")}finally{i(!1)}}},I=async()=>{x(!0);try{await N.deletePost(o.id),v.success("Post Deleted"),r(!1)}catch{v.error("Failed to delete post")}finally{x(!1)}},F=async()=>{await N.sharePost(o),v.success("Link Copied")},B=b=>{if(!b)return"";const D=new Date(b),_=new Date().getTime()-D.getTime(),A=Math.floor(_/6e4),z=Math.floor(_/36e5);return A<1?"Just Now":A<60?`${A}m ago`:z<24?`${z}h ago`:D.toLocaleDateString(void 0,{month:"short",day:"numeric"})};return e.jsxs(k.div,{layout:!0,initial:{opacity:0,scale:.98,y:15},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-15},transition:{duration:.4,delay:s*.03,ease:"circOut"},className:"group relative bg-black/40 backdrop-blur-3xl border border-[var(--border)] rounded-[2.5rem] overflow-hidden hover:border-[var(--accent)]/40 transition-all duration-500 shadow-xl",children:[e.jsxs("div",{className:"p-6 flex items-center justify-between relative z-10",children:[e.jsxs(H,{to:`/profile/${o.userId}`,className:"flex items-center gap-4 group/user",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-11 h-11 rounded-2xl bg-[var(--accent)]/10 p-[1px] border border-[var(--border)] group-hover/user:border-[var(--accent)]/40 transition-all shadow-lg",children:e.jsx("div",{className:"w-full h-full rounded-2xl bg-black flex items-center justify-center overflow-hidden",children:o.userAvatar?e.jsx("img",{src:o.userAvatar,alt:"",className:"w-full h-full object-cover group-hover/user:scale-110 transition-all duration-700"}):e.jsx(U,{className:"w-5 h-5 text-[var(--accent)]/50"})})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h3",{className:"text-[11px] font-black uppercase tracking-wider text-[var(--text-primary)] group-hover/user:text-[var(--accent)] transition-colors",children:["@",o.userName]}),o.visibility==="private"?e.jsx(J,{size:10,className:"text-white"}):e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-[var(--accent)]/40"})]}),e.jsx("p",{className:"text-[8px] font-black uppercase tracking-[0.2em] text-[var(--text-secondary)] mt-0.5",children:B(o.createdAt)})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:d&&e.jsx("button",{onClick:()=>r(!0),className:"p-3 text-[var(--text-secondary)] hover:text-red-500 hover:bg-red-500/5 rounded-2xl transition-all",title:"Delete Post",children:e.jsx(K,{size:18})})})]}),e.jsx($,{children:n&&e.jsxs(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-30 bg-black/90 backdrop-blur-xl flex flex-col items-center justify-center p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/10 rounded-[1.5rem] flex items-center justify-center mb-4 border border-red-500/30",children:e.jsx(O,{className:"w-8 h-8 text-red-500"})}),e.jsx("h3",{className:"text-sm font-black uppercase tracking-widest mb-2 italic text-red-500",children:"Delete Post?"}),e.jsx("p",{className:"text-[10px] text-[var(--text-secondary)] font-bold uppercase tracking-tight mb-8 max-w-xs",children:"This action cannot be undone. Are you sure?"}),e.jsxs("div",{className:"flex gap-4 w-full max-w-xs",children:[e.jsx("button",{onClick:()=>r(!1),className:"flex-1 py-4 bg-white/5 border border-white/5 rounded-2xl text-[10px] font-black uppercase tracking-widest hover:bg-white/10 transition-all",children:"CANCEL"}),e.jsx("button",{onClick:I,disabled:m,className:"flex-1 py-4 bg-red-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-lg hover:scale-105 active:scale-95 transition-all",children:m?"DELETING...":"DELETE"})]})]})}),e.jsx("div",{className:"px-8 pb-6 relative z-10",children:e.jsx("p",{className:"text-sm leading-relaxed text-[var(--text-primary)] font-medium whitespace-pre-wrap tracking-tight",children:o.content})}),o.imageUrl&&e.jsx("div",{className:"px-6 mb-6",children:e.jsx("div",{className:"relative rounded-[1.5rem] overflow-hidden border border-[var(--border)] group-hover:border-[var(--accent)]/30 transition-all bg-black/40 aspect-video shadow-2xl",children:e.jsx("img",{src:o.imageUrl,alt:"",className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000"})})}),e.jsxs("div",{className:"px-8 py-5 bg-[var(--accent)]/5 border-t border-[var(--border)] flex items-center justify-between relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs(k.button,{whileTap:{scale:.9},onClick:w,disabled:c,className:`flex items-center gap-3 transition-all duration-300 ${u?"text-[var(--accent)]":"text-[var(--text-secondary)] hover:text-white"}`,children:[e.jsx(Y,{size:18,className:u?"fill-current shadow-[0_0_15px_var(--accent)]":""}),e.jsx("span",{className:"text-[10px] font-black tracking-widest",children:o.likeCount??o.likes?.length??0})]}),e.jsxs("button",{onClick:()=>a(!t),className:`flex items-center gap-3 transition-all duration-300 ${t?"text-[var(--accent)]":"text-[var(--text-secondary)] hover:text-white"}`,children:[e.jsx(te,{size:18,className:t?"shadow-[0_0_15px_var(--accent)]":""}),e.jsx("span",{className:"text-[10px] font-black tracking-widest",children:o.commentCount??0})]}),e.jsx("button",{onClick:F,className:"p-1 text-[var(--text-secondary)] hover:text-[var(--accent)] transition-all",title:"Share",children:e.jsx(Q,{size:16})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex gap-1",children:[1,2,3].map(b=>e.jsx("div",{className:`w-1 h-3 rounded-full ${b<=(o.likes?.length||0)%4?"bg-[var(--accent)] shadow-[0_0_5px_var(--accent)]":"bg-white/10"}`},b))}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest text-[var(--accent)]/40",children:"Verified"})]})]}),e.jsx($,{children:t&&e.jsx(k.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden bg-black/40 border-t border-[var(--border)]",children:e.jsx(ie,{postId:o.id,onClose:()=>a(!1)})})})]})};export{M as L,fe as P,ae as S,N as p};
