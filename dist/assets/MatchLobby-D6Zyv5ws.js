import{a as k,j as e}from"./index--b10zKEF.js";import{e as C,d as I,r as o}from"./react-vendor-wpuS94OW.js";import{m as p,f as l}from"./espoCoin-CHE-5TF3.js";import{z as a}from"./index-CNUiO53a.js";import{A as S}from"./arrow-left-DXLZyVYx.js";import{C as P}from"./clock-Bk-93DQH.js";import{U as g}from"./users-BZz0W578.js";import{m as A}from"./animation-vendor-DcM-v-LS.js";import{C as M}from"./crown-xaJh6Xtk.js";import{T}from"./trash-2-CKyWL8wo.js";import{S as $}from"./share-2-C4AXdlKf.js";import{C as B}from"./copy-CCS_cXXG.js";import"./firebase-CrKjQ57N.js";const Y=()=>{const{id:i}=C(),{user:c}=k(),n=I(),[d,v]=o.useState(null);o.useEffect(()=>{if(c)v(c.id);else{const t=localStorage.getItem("guest_identity");t&&v(JSON.parse(t).id)}},[c]);const[s,f]=o.useState(null),[j,h]=o.useState("");o.useEffect(()=>{if(!i)return;const t=p.listenToMatch(i,r=>{if(!r){a.error("Match not found"),n("/play");return}f(r),(r.status==="in_progress"||r.status==="locked")&&setTimeout(()=>{n(`/play/game/${i}`)},1500)});return()=>t()},[i,n]),o.useEffect(()=>{if(!s)return;const t=setInterval(()=>{if(!s.expiresAt)return;const r=s.expiresAt.toDate?s.expiresAt.toDate():new Date(s.expiresAt),m=new Date,b=r.getTime()-m.getTime();if(b<=0)h("Expired"),clearInterval(t);else{const N=Math.floor(b/6e4),w=Math.floor(b%6e4/1e3);h(`${N}:${w.toString().padStart(2,"0")}`)}},1e3);return()=>clearInterval(t)},[s]);const x=()=>{if(!s?.inviteCode)return;const t=`${window.location.origin}/play/join/${s.inviteCode}`;navigator.clipboard.writeText(t),a.success("Invite link copied!")},y=async()=>{!s||!d||(a.success("Left match"),n("/play"))},u=s?.creatorId===d;return s?e.jsx("div",{className:"min-h-screen bg-[var(--bg-primary)] text-[var(--text-primary)] pb-24 lg:pb-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>n("/play"),className:"flex items-center gap-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] mb-4",children:[e.jsx(S,{className:"w-5 h-5"}),"Back to Play"]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black mb-2",children:"Match Lobby"}),e.jsxs("p",{className:"text-[var(--text-secondary)]",children:[s.gameName," â€¢ ",s.mode==="free"?"Free Play":`${l(s.entryFee)} Entry`]})]}),s.status==="waiting"&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-yellow-500/20 rounded-lg border border-yellow-500/30",children:[e.jsx(P,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{className:"text-sm font-bold text-yellow-400",children:j})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsxs("div",{className:"p-6 bg-[var(--glass)] rounded-xl border border-[var(--border)]",children:[e.jsx(g,{className:"w-8 h-8 text-[var(--accent)] mb-2"}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-1",children:"Players"}),e.jsxs("p",{className:"text-2xl font-black",children:[s.players.length,"/",s.maxPlayers]})]}),s.mode==="paid"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 bg-[var(--glass)] rounded-xl border border-[var(--border)]",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ’°"}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-1",children:"Prize Pool"}),e.jsx("p",{className:"text-2xl font-black text-[var(--accent)]",children:l(s.prizePool)})]}),e.jsxs("div",{className:"p-6 bg-[var(--glass)] rounded-xl border border-[var(--border)]",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ†"}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-1",children:"Winner Gets"}),e.jsx("p",{className:"text-2xl font-black text-[var(--accent)]",children:l(s.winnerPrize)})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-black mb-4",children:"Players"}),e.jsxs("div",{className:"space-y-3",children:[s.players.map((t,r)=>e.jsxs(A.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:r*.1},className:"p-4 bg-[var(--glass)] rounded-lg border border-[var(--border)] flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:t.userAvatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${t.userId}`,className:"w-10 h-10 rounded-full bg-gradient-to-br from-[var(--accent)] to-purple-500",alt:""}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-bold",children:t.userName}),t.role==="creator"&&e.jsx(M,{className:"w-4 h-4 text-yellow-400"}),t.isBot?e.jsx("span",{className:"text-[10px] bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded font-bold uppercase tracking-wide",children:"BOT"}):e.jsx("span",{className:"text-[10px] bg-green-500/20 text-green-400 px-2 py-0.5 rounded font-bold uppercase tracking-wide",children:"HUMAN"})]}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)]",children:s.mode==="paid"?`${l(t.coinsLocked)} locked`:"Ready"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.userId===d&&e.jsx("span",{className:"text-xs bg-[var(--accent)]/20 text-[var(--accent)] px-2 py-1 rounded",children:"You"}),u&&t.isBot&&s.status==="waiting"&&e.jsx("button",{onClick:async()=>{try{await p.removeBotFromMatch(s.id,t.userId),a.success("Bot removed")}catch{a.error("Failed to remove bot")}},className:"p-2 hover:bg-red-500/20 text-red-400 rounded-lg transition-colors group/remove",title:"Remove Bot",children:e.jsx(T,{className:"w-4 h-4 group-hover/remove:scale-110 transition-transform"})})]})]},t.userId)),Array.from({length:s.maxPlayers-s.players.length}).map((t,r)=>e.jsxs("div",{className:"p-4 bg-[var(--glass)]/30 rounded-lg border border-dashed border-[var(--border)] flex items-center gap-3 opacity-50",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--glass)] flex items-center justify-center",children:e.jsx(g,{className:"w-5 h-5 text-[var(--text-secondary)]"})}),e.jsx("p",{className:"text-sm text-[var(--text-secondary)]",children:"Waiting for player..."})]},`empty-${r}`))]})]}),e.jsxs("div",{className:"space-y-3",children:[s.inviteCode&&e.jsxs("div",{className:"bg-[var(--glass)] p-6 rounded-xl border border-[var(--border)] mb-6 text-center",children:[e.jsx("p",{className:"text-sm text-[var(--text-secondary)] mb-2 uppercase tracking-widest font-bold",children:"Room Code"}),e.jsx("div",{onClick:()=>{navigator.clipboard.writeText(s.inviteCode),a.success("Code copied!")},className:"text-4xl font-black font-mono tracking-[0.2em] text-[var(--accent)] cursor-pointer hover:scale-105 transition-transform select-all",children:s.inviteCode}),e.jsx("p",{className:"text-xs text-[var(--text-secondary)] mt-2",children:"Share this code with friends to let them join"})]}),s.inviteCode&&e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:async()=>{const t=`${window.location.origin}/play/join/${s.inviteCode}`,r="Join my ðŸƒ 29 Card Game room on Esporizon! Click to play:";if(navigator.share)try{await navigator.share({title:"29 Card Game Room",text:r,url:t})}catch{x()}else x()},className:"flex-1 py-4 bg-[var(--accent)] text-[var(--bg-primary)] rounded-xl font-black hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-3 shadow-[0_0_20px_rgba(0,255,194,0.3)]",children:[e.jsx($,{className:"w-5 h-5 font-black"}),"SHARE ROOM"]}),e.jsx("button",{onClick:x,className:"px-5 py-4 bg-[var(--glass)] border border-[var(--border)] rounded-xl font-bold hover:bg-[var(--glass-intense)] transition-all flex items-center justify-center",title:"Copy Link",children:e.jsx(B,{className:"w-5 h-5"})})]}),s.status==="waiting"&&e.jsx("button",{onClick:y,className:"w-full py-3 bg-red-500/20 border border-red-500/30 rounded-lg font-bold hover:bg-red-500/30 transition-all text-red-400",children:"Leave Match"}),s.status==="locked"&&e.jsx("div",{className:"p-4 bg-[var(--accent)]/10 border border-[var(--accent)]/30 rounded-lg text-center",children:e.jsx("p",{className:"font-bold text-[var(--accent)]",children:"Match is full! Starting game..."})}),s.mode==="free"&&u&&s.status==="waiting"&&e.jsxs("button",{onClick:async()=>{try{await p.addBotToMatch(s.id),a.success("Bot added!")}catch{a.error("Failed to add bot")}},className:"w-full py-3 bg-blue-500/20 border border-blue-500/30 rounded-lg font-bold hover:bg-blue-500/30 transition-all text-blue-400 flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"ðŸ¤–"}),"Add Bot Player"]})]})]})}):e.jsx("div",{className:"min-h-screen bg-[var(--bg-primary)] flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[var(--accent)]"})})};export{Y as default};
