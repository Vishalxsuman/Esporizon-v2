import{c as Qn,j as i,a as hn,W as Yn}from"./index--b10zKEF.js";import{r as w,R as Xn,e as Cr,d as Sr}from"./react-vendor-wpuS94OW.js";import{m as X,f as Jn}from"./espoCoin-CHE-5TF3.js";import{w as Zn}from"./WalletService-Dz-hmYOq.js";import{z as Ee}from"./index-CNUiO53a.js";import{d as Xe,b as Je,u as Ze,h as fr}from"./firebase-CrKjQ57N.js";import{A as gn}from"./arrow-left-DXLZyVYx.js";import{m as Y,A as Jt}from"./animation-vendor-DcM-v-LS.js";import{S as hr}from"./shield-sPsdbmlr.js";import{T as $r}from"./trophy-BGopWeg1.js";import"./index-B9ygI19o.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ts=Qn("eye",es);function rs(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t}const ht="abcdefgh".split(""),_t={a8:"bR",b8:"bN",c8:"bB",d8:"bQ",e8:"bK",f8:"bB",g8:"bN",h8:"bR",a7:"bP",b7:"bP",c7:"bP",d7:"bP",e7:"bP",f7:"bP",g7:"bP",h7:"bP",a2:"wP",b2:"wP",c2:"wP",d2:"wP",e2:"wP",f2:"wP",g2:"wP",h2:"wP",a1:"wR",b1:"wN",c1:"wB",d1:"wQ",e1:"wK",f1:"wB",g1:"wN",h1:"wR"},ns={a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7},ss={a:7,b:6,c:5,d:4,e:3,f:2,g:1,h:0},is=[7,6,5,4,3,2,1,0],os=[0,1,2,3,4,5,6,7],Br={wP:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsx("path",{d:"m 22.5,9 c -2.21,0 -4,1.79 -4,4 0,0.89 0.29,1.71 0.78,2.38 C 17.33,16.5 16,18.59 16,21 c 0,2.03 0.94,3.84 2.41,5.03 C 15.41,27.09 11,31.58 11,39.5 H 34 C 34,31.58 29.59,27.09 26.59,26.03 28.06,24.84 29,23.03 29,21 29,18.59 27.67,16.5 25.72,15.38 26.21,14.71 26.5,13.89 26.5,13 c 0,-2.21 -1.79,-4 -4,-4 z",style:{opacity:"1",fill:"#ffffff",fillOpacity:"1",fillRule:"nonzero",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"miter",strokeMiterlimit:"4",strokeDasharray:"none",strokeOpacity:"1"}})})),wR:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsxs("g",Object.assign({style:{opacity:"1",fill:"#ffffff",fillOpacity:"1",fillRule:"evenodd",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"4",strokeDasharray:"none",strokeOpacity:"1"}},{children:[i.jsx("path",{d:"M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z ",style:{strokeLinecap:"butt"}}),i.jsx("path",{d:"M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z ",style:{strokeLinecap:"butt"}}),i.jsx("path",{d:"M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14",style:{strokeLinecap:"butt"}}),i.jsx("path",{d:"M 34,14 L 31,17 L 14,17 L 11,14"}),i.jsx("path",{d:"M 31,17 L 31,29.5 L 14,29.5 L 14,17",style:{strokeLinecap:"butt",strokeLinejoin:"miter"}}),i.jsx("path",{d:"M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5"}),i.jsx("path",{d:"M 11,14 L 34,14",style:{fill:"none",stroke:"#000000",strokeLinejoin:"miter"}})]}))})),wN:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsxs("g",Object.assign({style:{opacity:"1",fill:"none",fillOpacity:"1",fillRule:"evenodd",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"4",strokeDasharray:"none",strokeOpacity:"1"}},{children:[i.jsx("path",{d:"M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18",style:{fill:"#ffffff",stroke:"#000000"}}),i.jsx("path",{d:"M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10",style:{fill:"#ffffff",stroke:"#000000"}}),i.jsx("path",{d:"M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z",style:{fill:"#000000",stroke:"#000000"}}),i.jsx("path",{d:"M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z",transform:"matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)",style:{fill:"#000000",stroke:"#000000"}})]}))})),wB:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsxs("g",Object.assign({style:{opacity:"1",fill:"none",fillRule:"evenodd",fillOpacity:"1",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"4",strokeDasharray:"none",strokeOpacity:"1"}},{children:[i.jsxs("g",Object.assign({style:{fill:"#ffffff",stroke:"#000000",strokeLinecap:"butt"}},{children:[i.jsx("path",{d:"M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.65,38.99 6.68,38.97 6,38 C 7.35,36.54 9,36 9,36 z"}),i.jsx("path",{d:"M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z"}),i.jsx("path",{d:"M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z"})]})),i.jsx("path",{d:"M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18",style:{fill:"none",stroke:"#000000",strokeLinejoin:"miter"}})]}))})),wQ:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsxs("g",Object.assign({style:{fill:"#ffffff",stroke:"#000000",strokeWidth:"1.5",strokeLinejoin:"round"}},{children:[i.jsx("path",{d:"M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z"}),i.jsx("path",{d:"M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 11,36 11,36 C 9.5,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z"}),i.jsx("path",{d:"M 11.5,30 C 15,29 30,29 33.5,30",style:{fill:"none"}}),i.jsx("path",{d:"M 12,33.5 C 18,32.5 27,32.5 33,33.5",style:{fill:"none"}}),i.jsx("circle",{cx:"6",cy:"12",r:"2"}),i.jsx("circle",{cx:"14",cy:"9",r:"2"}),i.jsx("circle",{cx:"22.5",cy:"8",r:"2"}),i.jsx("circle",{cx:"31",cy:"9",r:"2"}),i.jsx("circle",{cx:"39",cy:"12",r:"2"})]}))})),wK:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsxs("g",Object.assign({style:{fill:"none",fillOpacity:"1",fillRule:"evenodd",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"4",strokeDasharray:"none",strokeOpacity:"1"}},{children:[i.jsx("path",{d:"M 22.5,11.63 L 22.5,6",style:{fill:"none",stroke:"#000000",strokeLinejoin:"miter"}}),i.jsx("path",{d:"M 20,8 L 25,8",style:{fill:"none",stroke:"#000000",strokeLinejoin:"miter"}}),i.jsx("path",{d:"M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25",style:{fill:"#ffffff",stroke:"#000000",strokeLinecap:"butt",strokeLinejoin:"miter"}}),i.jsx("path",{d:"M 12.5,37 C 18,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 20,16 10.5,13 6.5,19.5 C 3.5,25.5 12.5,30 12.5,30 L 12.5,37",style:{fill:"#ffffff",stroke:"#000000"}}),i.jsx("path",{d:"M 12.5,30 C 18,27 27,27 32.5,30",style:{fill:"none",stroke:"#000000"}}),i.jsx("path",{d:"M 12.5,33.5 C 18,30.5 27,30.5 32.5,33.5",style:{fill:"none",stroke:"#000000"}}),i.jsx("path",{d:"M 12.5,37 C 18,34 27,34 32.5,37",style:{fill:"none",stroke:"#000000"}})]}))})),bP:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsx("path",{d:"m 22.5,9 c -2.21,0 -4,1.79 -4,4 0,0.89 0.29,1.71 0.78,2.38 C 17.33,16.5 16,18.59 16,21 c 0,2.03 0.94,3.84 2.41,5.03 C 15.41,27.09 11,31.58 11,39.5 H 34 C 34,31.58 29.59,27.09 26.59,26.03 28.06,24.84 29,23.03 29,21 29,18.59 27.67,16.5 25.72,15.38 26.21,14.71 26.5,13.89 26.5,13 c 0,-2.21 -1.79,-4 -4,-4 z",style:{opacity:"1",fill:"#000000",fillOpacity:"1",fillRule:"nonzero",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"miter",strokeMiterlimit:"4",strokeDasharray:"none",strokeOpacity:"1"}})})),bR:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsxs("g",Object.assign({style:{opacity:"1",fill:"#000000",fillOpacity:"1",fillRule:"evenodd",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"4",strokeDasharray:"none",strokeOpacity:"1"}},{children:[i.jsx("path",{d:"M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z ",style:{strokeLinecap:"butt"}}),i.jsx("path",{d:"M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z ",style:{strokeLinecap:"butt"}}),i.jsx("path",{d:"M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z ",style:{strokeLinecap:"butt"}}),i.jsx("path",{d:"M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z ",style:{strokeLinecap:"butt",strokeLinejoin:"miter"}}),i.jsx("path",{d:"M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z ",style:{strokeLinecap:"butt"}}),i.jsx("path",{d:"M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z ",style:{strokeLinecap:"butt"}}),i.jsx("path",{d:"M 12,35.5 L 33,35.5 L 33,35.5",style:{fill:"none",stroke:"#ffffff",strokeWidth:"1",strokeLinejoin:"miter"}}),i.jsx("path",{d:"M 13,31.5 L 32,31.5",style:{fill:"none",stroke:"#ffffff",strokeWidth:"1",strokeLinejoin:"miter"}}),i.jsx("path",{d:"M 14,29.5 L 31,29.5",style:{fill:"none",stroke:"#ffffff",strokeWidth:"1",strokeLinejoin:"miter"}}),i.jsx("path",{d:"M 14,16.5 L 31,16.5",style:{fill:"none",stroke:"#ffffff",strokeWidth:"1",strokeLinejoin:"miter"}}),i.jsx("path",{d:"M 11,14 L 34,14",style:{fill:"none",stroke:"#ffffff",strokeWidth:"1",strokeLinejoin:"miter"}})]}))})),bN:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsxs("g",Object.assign({style:{opacity:"1",fill:"none",fillOpacity:"1",fillRule:"evenodd",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"4",strokeDasharray:"none",strokeOpacity:"1"}},{children:[i.jsx("path",{d:"M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18",style:{fill:"#000000",stroke:"#000000"}}),i.jsx("path",{d:"M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10",style:{fill:"#000000",stroke:"#000000"}}),i.jsx("path",{d:"M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z",style:{fill:"#ffffff",stroke:"#ffffff"}}),i.jsx("path",{d:"M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z",transform:"matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)",style:{fill:"#ffffff",stroke:"#ffffff"}}),i.jsx("path",{d:"M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z ",style:{fill:"#ffffff",stroke:"none"}})]}))})),bB:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsxs("g",Object.assign({style:{opacity:"1",fill:"none",fillRule:"evenodd",fillOpacity:"1",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"4",strokeDasharray:"none",strokeOpacity:"1"}},{children:[i.jsxs("g",Object.assign({style:{fill:"#000000",stroke:"#000000",strokeLinecap:"butt"}},{children:[i.jsx("path",{d:"M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.65,38.99 6.68,38.97 6,38 C 7.35,36.54 9,36 9,36 z"}),i.jsx("path",{d:"M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z"}),i.jsx("path",{d:"M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z"})]})),i.jsx("path",{d:"M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18",style:{fill:"none",stroke:"#ffffff",strokeLinejoin:"miter"}})]}))})),bQ:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsxs("g",Object.assign({style:{fill:"#000000",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}},{children:[i.jsx("path",{d:"M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z",style:{strokeLinecap:"butt",fill:"#000000"}}),i.jsx("path",{d:"m 9,26 c 0,2 1.5,2 2.5,4 1,1.5 1,1 0.5,3.5 -1.5,1 -1,2.5 -1,2.5 -1.5,1.5 0,2.5 0,2.5 6.5,1 16.5,1 23,0 0,0 1.5,-1 0,-2.5 0,0 0.5,-1.5 -1,-2.5 -0.5,-2.5 -0.5,-2 0.5,-3.5 1,-2 2.5,-2 2.5,-4 -8.5,-1.5 -18.5,-1.5 -27,0 z"}),i.jsx("path",{d:"M 11.5,30 C 15,29 30,29 33.5,30"}),i.jsx("path",{d:"m 12,33.5 c 6,-1 15,-1 21,0"}),i.jsx("circle",{cx:"6",cy:"12",r:"2"}),i.jsx("circle",{cx:"14",cy:"9",r:"2"}),i.jsx("circle",{cx:"22.5",cy:"8",r:"2"}),i.jsx("circle",{cx:"31",cy:"9",r:"2"}),i.jsx("circle",{cx:"39",cy:"12",r:"2"}),i.jsx("path",{d:"M 11,38.5 A 35,35 1 0 0 34,38.5",style:{fill:"none",stroke:"#000000",strokeLinecap:"butt"}}),i.jsxs("g",Object.assign({style:{fill:"none",stroke:"#ffffff"}},{children:[i.jsx("path",{d:"M 11,29 A 35,35 1 0 1 34,29"}),i.jsx("path",{d:"M 12.5,31.5 L 32.5,31.5"}),i.jsx("path",{d:"M 11.5,34.5 A 35,35 1 0 0 33.5,34.5"}),i.jsx("path",{d:"M 10.5,37.5 A 35,35 1 0 0 34.5,37.5"})]}))]}))})),bK:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",width:"45",height:"45"},{children:i.jsxs("g",Object.assign({style:{fill:"none",fillOpacity:"1",fillRule:"evenodd",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"4",strokeDasharray:"none",strokeOpacity:"1"}},{children:[i.jsx("path",{d:"M 22.5,11.63 L 22.5,6",style:{fill:"none",stroke:"#000000",strokeLinejoin:"miter"},id:"path6570"}),i.jsx("path",{d:"M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25",style:{fill:"#000000",fillOpacity:"1",strokeLinecap:"butt",strokeLinejoin:"miter"}}),i.jsx("path",{d:"M 12.5,37 C 18,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 20,16 10.5,13 6.5,19.5 C 3.5,25.5 12.5,30 12.5,30 L 12.5,37",style:{fill:"#000000",stroke:"#000000"}}),i.jsx("path",{d:"M 20,8 L 25,8",style:{fill:"none",stroke:"#000000",strokeLinejoin:"miter"}}),i.jsx("path",{d:"M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.5,26.6 L 22.5,24.5 C 20,18 10.85,14 6.97,19.85 C 4.5,25.5 13,29.5 13,29.5",style:{fill:"none",stroke:"#ffffff"}}),i.jsx("path",{d:"M 12.5,30 C 18,27 27,27 32.5,30 M 12.5,33.5 C 18,30.5 27,30.5 32.5,33.5 M 12.5,37 C 18,34 27,34 32.5,37",style:{fill:"none",stroke:"#ffffff"}})]}))}))};function gr(r,e,t){const n=e/8,s=r==="white"?ns:ss,o=r==="white"?is:os,c=s[t[0]]*n+n/2,l=o[parseInt(t[1],10)-1]*n+n/2;return{x:c,y:l}}function Hr(r){let e=!1;return Object.keys(_t).forEach(t=>{r[t]!==_t[t]&&(e=!0)}),Object.keys(r).forEach(t=>{_t[t]!==r[t]&&(e=!0)}),e}function as(r,e){const t={removed:{},added:{}};return Object.keys(r).forEach(n=>{e[n]!==r[n]&&(t.removed[n]=r[n])}),Object.keys(e).forEach(n=>{r[n]!==e[n]&&(t.added[n]=e[n])}),t}function Fr(r){return r==="start"?_t:typeof r=="string"?ls(r):r}function ls(r){if(!cs(r))return{};r=r.replace(/ .+$/,"");const e=r.split("/"),t={};let n=8;for(let s=0;s<8;s++){const o=e[s].split("");let c=0;for(let l=0;l<o.length;l++)if(o[l].search(/[1-8]/)!==-1){const a=parseInt(o[l],10);c=c+a}else{const a=ht[c]+n;t[a]=ds(o[l]),c=c+1}n=n-1}return t}function cs(r){r=r.replace(/ .+$/,""),r=us(r);const e=r.split("/");if(e.length!==8)return!1;for(let t=0;t<8;t++)if(e[t].length!==8||e[t].search(/[^kqrnbpKQRNBP1]/)!==-1)return!1;return!0}function us(r){return r.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11")}function ds(r){return r.toLowerCase()===r?"b"+r.toUpperCase():"w"+r.toUpperCase()}const fs=(r,e=!0,t,n)=>{const[s,o]=w.useState([]),[c,l]=w.useState([]),[a,d]=w.useState();w.useEffect(()=>{Array.isArray(r)&&(h(),o(r?.filter(p=>p[0]!==p[1])))},[r]),w.useEffect(()=>{t?.(c)},[c]);function h(){l([]),d(void 0)}const x=(p,m)=>{e&&d([p,m,n])},u=[...c,...s];return{arrows:u,newArrow:a,clearArrows:h,drawNewArrow:x,setArrows:l,onArrowDrawEnd:(p,m)=>{if(p===m||!e)return;let C;const S=[p,m,n];u.every(([j,T])=>!(j===p&&T===m))?C=[...c,S]:C=c.filter(([j,T])=>!(j===p&&T===m)),d(void 0),l(C)}}},pn=w.createContext({}),je=()=>w.useContext(pn),hs=w.forwardRef(({allowDragOutsideBoard:r=!0,animationDuration:e=300,areArrowsAllowed:t=!0,arePiecesDraggable:n=!0,arePremovesAllowed:s=!1,autoPromoteToQueen:o=!1,boardOrientation:c="white",boardWidth:l,children:a,clearPremovesOnRightClick:d=!0,customArrows:h,customArrowColor:x="rgb(255,170,0)",customBoardStyle:u,customNotationStyle:f,customDarkSquareStyle:p={backgroundColor:"#B58863"},customDropSquareStyle:m={boxShadow:"inset 0 0 1px 6px rgba(255,255,255,0.75)"},customLightSquareStyle:C={backgroundColor:"#F0D9B5"},customPieces:S,customPremoveDarkSquareStyle:O={backgroundColor:"#A42323"},customPremoveLightSquareStyle:j={backgroundColor:"#BD2828"},customSquare:T="div",customSquareStyles:D,dropOffBoardAction:E="snapback",id:H=0,isDraggablePiece:V=()=>!0,getPositionObject:L=()=>{},onArrowsChange:U=()=>{},onDragOverSquare:se=()=>{},onMouseOutSquare:G=()=>{},onMouseOverSquare:k=()=>{},onPieceClick:R=()=>{},onPieceDragBegin:A=()=>{},onPieceDragEnd:z=()=>{},onPieceDrop:Q=()=>!0,onPieceDropOffBoard:ce=()=>{},onPromotionCheck:he=(ae,de,We)=>(We==="wP"&&ae[1]==="7"&&de[1]==="8"||We==="bP"&&ae[1]==="2"&&de[1]==="1")&&Math.abs(ae.charCodeAt(0)-de.charCodeAt(0))<=1,onPromotionPieceSelect:ge=()=>!0,onSparePieceDrop:J=()=>!0,onSquareClick:oe=()=>{},onSquareRightClick:Ce=()=>{},position:Se="start",promotionDialogVariant:Fe="default",promotionToSquare:Ie=null,showBoardNotation:F=!0,showPromotionDialog:ye=!1,snapToCursor:_e=!0},Le)=>{const[ae,de]=w.useState(Fr(Se)),[We,Mt]=w.useState({removed:{},added:{}}),[Ue,ke]=w.useState(void 0),[Rt,ze]=w.useState(ye&&!o),[At,pt]=w.useState(null),[$t,tt]=w.useState(Ie),[rt,nt]=w.useState([]),we=w.useRef(rt),[st,Me]=w.useState(),[Bt,Ht]=w.useState(Object.assign(Object.assign({},Br),S)),[Ft,qe]=w.useState(!1),Ke=w.useRef(),[Ge,Ve]=w.useState(!1),[Wt,Ut]=w.useState(null);w.useImperativeHandle(Le,()=>({clearPremoves(q=!0){Qe(q)}})),w.useEffect(()=>{Ht(Object.assign(Object.assign({},Br),S))},[S]),w.useEffect(()=>{ze(ye),tt(Ie)},[Ie,ye]),w.useEffect(()=>{var q,_,re;at();const W=Fr(Se),ee=as(ae,W),me=((q=Object.keys(ee.added))===null||q===void 0?void 0:q.length)<=2?(re=(_=Object.entries(ee.added))===null||_===void 0?void 0:_[0])===null||re===void 0?void 0:re[1][0]:void 0;if(Ge)de(W),Ve(!1),s&&ot(me),Ke.current&&clearTimeout(Ke.current);else if(Ft)de(W),Ve(!1),s&&ot(me);else{Hr(W)&&Ue!==void 0?ke(me):Hr(W)?ke(void 0):ke("b"),Mt(ee),Ve(!0);const fe=setTimeout(()=>{de(W),Ve(!1),s&&ot(me)},e);Ke.current=fe}return qe(!1),L(W),it(),()=>{clearTimeout(Ke.current)}},[Se]);const{arrows:mt,newArrow:zt,clearArrows:it,drawNewArrow:qt,onArrowDrawEnd:Kt}=fs(h,t,U,x);function Gt(q,_,re,W){if(q===_)return;if(it(),s&&Ge||s&&(Ue===re[0]||we.current.filter(me=>me.piece[0]===re[0]).length>0)){const me=[...we.current];me.push({sourceSq:q,targetSq:_,piece:re}),we.current=me,nt([...me]),at();return}if(!s&&Ge)return;const ee=Object.assign({},ae);qe(!!W),ke(re[0]),Q.length?Q(q,_,re)||(Qe(),qe(!1)):(delete ee[q],ee[_]=re,de(ee)),at(),L(ee)}function Vt(q){const _=Object.assign({},ae);delete _[q],de(_),L(_)}function ot(q){if(we.current.length===0)return;const _=we.current[0];if(_.piece[0]!==void 0&&_.piece[0]!==q&&Q.length)if(ke(_.piece[0]),qe(!0),Q(_.sourceSq,_.targetSq,_.piece)){const W=[...we.current];W.shift(),we.current=W,nt([...W])}else Qe()}function Qt(q,_){if(!J(q,_))return;const W=Object.assign({},ae);W[_]=q,de(W),L(W)}function Qe(q=!0){q&&ke(void 0),we.current=[],nt([])}function at(){pt(null),tt(null),ze(!1)}function Yt(q){Me(q)}function v(q){if(st){if(st===q){Me(void 0),d&&Qe(!1),Ce(q);return}}else Me(void 0)}function Oe(){Me(void 0)}const pe={allowDragOutsideBoard:r,animationDuration:e,arePiecesDraggable:n,arePremovesAllowed:s,arrows:mt,autoPromoteToQueen:o,boardOrientation:c,boardWidth:l,chessPieces:Bt,clearArrows:it,clearCurrentRightClickDown:Oe,currentPosition:ae,currentRightClickDown:st,customArrowColor:x,customBoardStyle:u,customDarkSquareStyle:p,customDropSquareStyle:m,customLightSquareStyle:C,customNotationStyle:f,customPremoveDarkSquareStyle:O,customPremoveLightSquareStyle:j,customSquare:T,customSquareStyles:D,deletePieceFromSquare:Vt,drawNewArrow:qt,dropOffBoardAction:E,handleSetPosition:Gt,handleSparePieceDrop:Qt,id:H,isDraggablePiece:V,isWaitingForAnimation:Ge,lastPieceColour:Ue,lastSquareDraggedOver:Wt,newArrow:zt,onArrowDrawEnd:Kt,onDragOverSquare:se,onMouseOutSquare:G,onMouseOverSquare:k,onPieceClick:R,onPieceDragBegin:A,onPieceDragEnd:z,onPieceDrop:Q,onPieceDropOffBoard:ce,onPromotionCheck:he,onPromotionPieceSelect:ge,onRightClickDown:Yt,onRightClickUp:v,onSparePieceDrop:J,onSquareClick:oe,positionDifferences:We,premoves:rt,promoteFromSquare:At,promoteToSquare:$t,promotionDialogVariant:Fe,setLastSquareDraggedOver:Ut,setPromoteFromSquare:pt,setPromoteToSquare:tt,setShowPromoteDialog:ze,showBoardNotation:F,showPromoteDialog:Rt,snapToCursor:_e};return i.jsx(pn.Provider,Object.assign({value:pe},{children:a}))});function gs({row:r,col:e}){const{boardOrientation:t,boardWidth:n,customDarkSquareStyle:s,customLightSquareStyle:o,customNotationStyle:c}=je(),l=o.backgroundColor,a=s.backgroundColor,d=e===0,h=r===7,x=d&&h;function u(){return t==="white"?8-r:r+1}function f(){return t==="black"?ht[7-e]:ht[e]}function p(){return i.jsxs(i.Fragment,{children:[i.jsx("div",Object.assign({style:Object.assign(Object.assign({zIndex:3,position:"absolute"},{color:l}),Ur(n,c))},{children:u()})),i.jsx("div",Object.assign({style:Object.assign(Object.assign({zIndex:3,position:"absolute"},{color:l}),Wr(n,c))},{children:f()}))]})}function m(){return i.jsx("div",Object.assign({style:Object.assign(Object.assign({userSelect:"none",zIndex:3,position:"absolute"},{color:e%2!==0?a:l}),Wr(n,c))},{children:f()}))}function C(){return i.jsx("div",Object.assign({style:Object.assign(Object.assign({userSelect:"none",zIndex:3,position:"absolute"},t==="black"?{color:r%2===0?a:l}:{color:r%2===0?a:l}),Ur(n,c))},{children:u()}))}return x?p():h?m():d?C():null}const Wr=(r,e)=>Object.assign({alignSelf:"flex-end",paddingLeft:r/8-r/48,fontSize:r/48},e),Ur=(r,e)=>Object.assign({alignSelf:"flex-start",paddingRight:r/8-r/48,fontSize:r/48},e),mn=w.createContext({dragDropManager:void 0});function xe(r){return"Minified Redux error #"+r+"; visit https://redux.js.org/Errors?code="+r+" for the full message or use the non-minified dev environment for full errors. "}var zr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),qr=function(){return Math.random().toString(36).substring(7).split("").join(".")},Kr={INIT:"@@redux/INIT"+qr(),REPLACE:"@@redux/REPLACE"+qr()};function ps(r){if(typeof r!="object"||r===null)return!1;for(var e=r;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e}function vn(r,e,t){var n;if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(xe(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(xe(1));return t(vn)(r,e)}if(typeof r!="function")throw new Error(xe(2));var s=r,o=e,c=[],l=c,a=!1;function d(){l===c&&(l=c.slice())}function h(){if(a)throw new Error(xe(3));return o}function x(m){if(typeof m!="function")throw new Error(xe(4));if(a)throw new Error(xe(5));var C=!0;return d(),l.push(m),function(){if(C){if(a)throw new Error(xe(6));C=!1,d();var O=l.indexOf(m);l.splice(O,1),c=null}}}function u(m){if(!ps(m))throw new Error(xe(7));if(typeof m.type>"u")throw new Error(xe(8));if(a)throw new Error(xe(9));try{a=!0,o=s(o,m)}finally{a=!1}for(var C=c=l,S=0;S<C.length;S++){var O=C[S];O()}return m}function f(m){if(typeof m!="function")throw new Error(xe(10));s=m,u({type:Kr.REPLACE})}function p(){var m,C=x;return m={subscribe:function(O){if(typeof O!="object"||O===null)throw new Error(xe(11));function j(){O.next&&O.next(h())}j();var T=C(j);return{unsubscribe:T}}},m[zr]=function(){return this},m}return u({type:Kr.INIT}),n={dispatch:u,subscribe:x,getState:h,replaceReducer:f},n[zr]=p,n}function B(r,e,...t){if(ms()&&e===void 0)throw new Error("invariant requires an error message argument");if(!r){let n;if(e===void 0)n=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let s=0;n=new Error(e.replace(/%s/g,function(){return t[s++]})),n.name="Invariant Violation"}throw n.framesToPop=1,n}}function ms(){return typeof process<"u"&&!0}function vs(r,e,t){return e.split(".").reduce((n,s)=>n&&n[s]?n[s]:t||null,r)}function xs(r,e){return r.filter(t=>t!==e)}function xn(r){return typeof r=="object"}function bs(r,e){const t=new Map,n=o=>{t.set(o,t.has(o)?t.get(o)+1:1)};r.forEach(n),e.forEach(n);const s=[];return t.forEach((o,c)=>{o===1&&s.push(c)}),s}function ys(r,e){return r.filter(t=>e.indexOf(t)>-1)}const _r="dnd-core/INIT_COORDS",Dt="dnd-core/BEGIN_DRAG",jr="dnd-core/PUBLISH_DRAG_SOURCE",Et="dnd-core/HOVER",Nt="dnd-core/DROP",Pt="dnd-core/END_DRAG";function Gr(r,e){return{type:_r,payload:{sourceClientOffset:e||null,clientOffset:r||null}}}const ws={type:_r,payload:{clientOffset:null,sourceClientOffset:null}};function Cs(r){return function(t=[],n={publishSource:!0}){const{publishSource:s=!0,clientOffset:o,getSourceClientOffset:c}=n,l=r.getMonitor(),a=r.getRegistry();r.dispatch(Gr(o)),Ss(t,l,a);const d=ks(t,l);if(d==null){r.dispatch(ws);return}let h=null;if(o){if(!c)throw new Error("getSourceClientOffset must be defined");_s(c),h=c(d)}r.dispatch(Gr(o,h));const u=a.getSource(d).beginDrag(l,d);if(u==null)return;js(u),a.pinSource(d);const f=a.getSourceType(d);return{type:Dt,payload:{itemType:f,item:u,sourceId:d,clientOffset:o||null,sourceClientOffset:h||null,isSourcePublic:!!s}}}}function Ss(r,e,t){B(!e.isDragging(),"Cannot call beginDrag while dragging."),r.forEach(function(n){B(t.getSource(n),"Expected sourceIds to be registered.")})}function _s(r){B(typeof r=="function","When clientOffset is provided, getSourceClientOffset must be a function.")}function js(r){B(xn(r),"Item must be an object.")}function ks(r,e){let t=null;for(let n=r.length-1;n>=0;n--)if(e.canDragSource(r[n])){t=r[n];break}return t}function Os(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ts(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.forEach(function(s){Os(r,s,t[s])})}return r}function Ds(r){return function(t={}){const n=r.getMonitor(),s=r.getRegistry();Es(n),Is(n).forEach((c,l)=>{const a=Ns(c,l,s,n),d={type:Nt,payload:{dropResult:Ts({},t,a)}};r.dispatch(d)})}}function Es(r){B(r.isDragging(),"Cannot call drop while not dragging."),B(!r.didDrop(),"Cannot call drop twice during one drag operation.")}function Ns(r,e,t,n){const s=t.getTarget(r);let o=s?s.drop(n,r):void 0;return Ps(o),typeof o>"u"&&(o=e===0?{}:n.getDropResult()),o}function Ps(r){B(typeof r>"u"||xn(r),"Drop result must either be an object or undefined.")}function Is(r){const e=r.getTargetIds().filter(r.canDropOnTarget,r);return e.reverse(),e}function Ls(r){return function(){const t=r.getMonitor(),n=r.getRegistry();Ms(t);const s=t.getSourceId();return s!=null&&(n.getSource(s,!0).endDrag(t,s),n.unpinSource()),{type:Pt}}}function Ms(r){B(r.isDragging(),"Cannot call endDrag while not dragging.")}function pr(r,e){return e===null?r===null:Array.isArray(r)?r.some(t=>t===e):r===e}function Rs(r){return function(t,{clientOffset:n}={}){As(t);const s=t.slice(0),o=r.getMonitor(),c=r.getRegistry(),l=o.getItemType();return Bs(s,c,l),$s(s,o,c),Hs(s,o,c),{type:Et,payload:{targetIds:s,clientOffset:n||null}}}}function As(r){B(Array.isArray(r),"Expected targetIds to be an array.")}function $s(r,e,t){B(e.isDragging(),"Cannot call hover while not dragging."),B(!e.didDrop(),"Cannot call hover after drop.");for(let n=0;n<r.length;n++){const s=r[n];B(r.lastIndexOf(s)===n,"Expected targetIds to be unique in the passed array.");const o=t.getTarget(s);B(o,"Expected targetIds to be registered.")}}function Bs(r,e,t){for(let n=r.length-1;n>=0;n--){const s=r[n],o=e.getTargetType(s);pr(o,t)||r.splice(n,1)}}function Hs(r,e,t){r.forEach(function(n){t.getTarget(n).hover(e,n)})}function Fs(r){return function(){if(r.getMonitor().isDragging())return{type:jr}}}function Ws(r){return{beginDrag:Cs(r),publishDragSource:Fs(r),hover:Rs(r),drop:Ds(r),endDrag:Ls(r)}}class Us{receiveBackend(e){this.backend=e}getMonitor(){return this.monitor}getBackend(){return this.backend}getRegistry(){return this.monitor.registry}getActions(){const e=this,{dispatch:t}=this.store;function n(o){return(...c)=>{const l=o.apply(e,c);typeof l<"u"&&t(l)}}const s=Ws(this);return Object.keys(s).reduce((o,c)=>{const l=s[c];return o[c]=n(l),o},{})}dispatch(e){this.store.dispatch(e)}constructor(e,t){this.isSetUp=!1,this.handleRefCountChange=()=>{const n=this.store.getState().refCount>0;this.backend&&(n&&!this.isSetUp?(this.backend.setup(),this.isSetUp=!0):!n&&this.isSetUp&&(this.backend.teardown(),this.isSetUp=!1))},this.store=e,this.monitor=t,e.subscribe(this.handleRefCountChange)}}function zs(r,e){return{x:r.x+e.x,y:r.y+e.y}}function bn(r,e){return{x:r.x-e.x,y:r.y-e.y}}function qs(r){const{clientOffset:e,initialClientOffset:t,initialSourceClientOffset:n}=r;return!e||!t||!n?null:bn(zs(e,n),t)}function Ks(r){const{clientOffset:e,initialClientOffset:t}=r;return!e||!t?null:bn(e,t)}const dt=[],kr=[];dt.__IS_NONE__=!0;kr.__IS_ALL__=!0;function Gs(r,e){return r===dt?!1:r===kr||typeof e>"u"?!0:ys(e,r).length>0}class Vs{subscribeToStateChange(e,t={}){const{handlerIds:n}=t;B(typeof e=="function","listener must be a function."),B(typeof n>"u"||Array.isArray(n),"handlerIds, when specified, must be an array of strings.");let s=this.store.getState().stateId;const o=()=>{const c=this.store.getState(),l=c.stateId;try{l===s||l===s+1&&!Gs(c.dirtyHandlerIds,n)||e()}finally{s=l}};return this.store.subscribe(o)}subscribeToOffsetChange(e){B(typeof e=="function","listener must be a function.");let t=this.store.getState().dragOffset;const n=()=>{const s=this.store.getState().dragOffset;s!==t&&(t=s,e())};return this.store.subscribe(n)}canDragSource(e){if(!e)return!1;const t=this.registry.getSource(e);return B(t,`Expected to find a valid source. sourceId=${e}`),this.isDragging()?!1:t.canDrag(this,e)}canDropOnTarget(e){if(!e)return!1;const t=this.registry.getTarget(e);if(B(t,`Expected to find a valid target. targetId=${e}`),!this.isDragging()||this.didDrop())return!1;const n=this.registry.getTargetType(e),s=this.getItemType();return pr(n,s)&&t.canDrop(this,e)}isDragging(){return!!this.getItemType()}isDraggingSource(e){if(!e)return!1;const t=this.registry.getSource(e,!0);if(B(t,`Expected to find a valid source. sourceId=${e}`),!this.isDragging()||!this.isSourcePublic())return!1;const n=this.registry.getSourceType(e),s=this.getItemType();return n!==s?!1:t.isDragging(this,e)}isOverTarget(e,t={shallow:!1}){if(!e)return!1;const{shallow:n}=t;if(!this.isDragging())return!1;const s=this.registry.getTargetType(e),o=this.getItemType();if(o&&!pr(s,o))return!1;const c=this.getTargetIds();if(!c.length)return!1;const l=c.indexOf(e);return n?l===c.length-1:l>-1}getItemType(){return this.store.getState().dragOperation.itemType}getItem(){return this.store.getState().dragOperation.item}getSourceId(){return this.store.getState().dragOperation.sourceId}getTargetIds(){return this.store.getState().dragOperation.targetIds}getDropResult(){return this.store.getState().dragOperation.dropResult}didDrop(){return this.store.getState().dragOperation.didDrop}isSourcePublic(){return!!this.store.getState().dragOperation.isSourcePublic}getInitialClientOffset(){return this.store.getState().dragOffset.initialClientOffset}getInitialSourceClientOffset(){return this.store.getState().dragOffset.initialSourceClientOffset}getClientOffset(){return this.store.getState().dragOffset.clientOffset}getSourceClientOffset(){return qs(this.store.getState().dragOffset)}getDifferenceFromInitialOffset(){return Ks(this.store.getState().dragOffset)}constructor(e,t){this.store=e,this.registry=t}}const Vr=typeof global<"u"?global:self,yn=Vr.MutationObserver||Vr.WebKitMutationObserver;function wn(r){return function(){const t=setTimeout(s,0),n=setInterval(s,50);function s(){clearTimeout(t),clearInterval(n),r()}}}function Qs(r){let e=1;const t=new yn(r),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){e=-e,n.data=e}}const Ys=typeof yn=="function"?Qs:wn;class Xs{enqueueTask(e){const{queue:t,requestFlush:n}=this;t.length||(n(),this.flushing=!0),t[t.length]=e}constructor(){this.queue=[],this.pendingErrors=[],this.flushing=!1,this.index=0,this.capacity=1024,this.flush=()=>{const{queue:e}=this;for(;this.index<e.length;){const t=this.index;if(this.index++,e[t].call(),this.index>this.capacity){for(let n=0,s=e.length-this.index;n<s;n++)e[n]=e[n+this.index];e.length-=this.index,this.index=0}}e.length=0,this.index=0,this.flushing=!1},this.registerPendingError=e=>{this.pendingErrors.push(e),this.requestErrorThrow()},this.requestFlush=Ys(this.flush),this.requestErrorThrow=wn(()=>{if(this.pendingErrors.length)throw this.pendingErrors.shift()})}}class Js{call(){try{this.task&&this.task()}catch(e){this.onError(e)}finally{this.task=null,this.release(this)}}constructor(e,t){this.onError=e,this.release=t,this.task=null}}class Zs{create(e){const t=this.freeTasks,n=t.length?t.pop():new Js(this.onError,s=>t[t.length]=s);return n.task=e,n}constructor(e){this.onError=e,this.freeTasks=[]}}const Cn=new Xs,ei=new Zs(Cn.registerPendingError);function ti(r){Cn.enqueueTask(ei.create(r))}const Or="dnd-core/ADD_SOURCE",Tr="dnd-core/ADD_TARGET",Dr="dnd-core/REMOVE_SOURCE",It="dnd-core/REMOVE_TARGET";function ri(r){return{type:Or,payload:{sourceId:r}}}function ni(r){return{type:Tr,payload:{targetId:r}}}function si(r){return{type:Dr,payload:{sourceId:r}}}function ii(r){return{type:It,payload:{targetId:r}}}function oi(r){B(typeof r.canDrag=="function","Expected canDrag to be a function."),B(typeof r.beginDrag=="function","Expected beginDrag to be a function."),B(typeof r.endDrag=="function","Expected endDrag to be a function.")}function ai(r){B(typeof r.canDrop=="function","Expected canDrop to be a function."),B(typeof r.hover=="function","Expected hover to be a function."),B(typeof r.drop=="function","Expected beginDrag to be a function.")}function mr(r,e){if(e&&Array.isArray(r)){r.forEach(t=>mr(t,!1));return}B(typeof r=="string"||typeof r=="symbol",e?"Type can only be a string, a symbol, or an array of either.":"Type can only be a string or a symbol.")}var be;(function(r){r.SOURCE="SOURCE",r.TARGET="TARGET"})(be||(be={}));let li=0;function ci(){return li++}function ui(r){const e=ci().toString();switch(r){case be.SOURCE:return`S${e}`;case be.TARGET:return`T${e}`;default:throw new Error(`Unknown Handler Role: ${r}`)}}function Qr(r){switch(r[0]){case"S":return be.SOURCE;case"T":return be.TARGET;default:throw new Error(`Cannot parse handler ID: ${r}`)}}function Yr(r,e){const t=r.entries();let n=!1;do{const{done:s,value:[,o]}=t.next();if(o===e)return!0;n=!!s}while(!n);return!1}class di{addSource(e,t){mr(e),oi(t);const n=this.addHandler(be.SOURCE,e,t);return this.store.dispatch(ri(n)),n}addTarget(e,t){mr(e,!0),ai(t);const n=this.addHandler(be.TARGET,e,t);return this.store.dispatch(ni(n)),n}containsHandler(e){return Yr(this.dragSources,e)||Yr(this.dropTargets,e)}getSource(e,t=!1){return B(this.isSourceId(e),"Expected a valid source ID."),t&&e===this.pinnedSourceId?this.pinnedSource:this.dragSources.get(e)}getTarget(e){return B(this.isTargetId(e),"Expected a valid target ID."),this.dropTargets.get(e)}getSourceType(e){return B(this.isSourceId(e),"Expected a valid source ID."),this.types.get(e)}getTargetType(e){return B(this.isTargetId(e),"Expected a valid target ID."),this.types.get(e)}isSourceId(e){return Qr(e)===be.SOURCE}isTargetId(e){return Qr(e)===be.TARGET}removeSource(e){B(this.getSource(e),"Expected an existing source."),this.store.dispatch(si(e)),ti(()=>{this.dragSources.delete(e),this.types.delete(e)})}removeTarget(e){B(this.getTarget(e),"Expected an existing target."),this.store.dispatch(ii(e)),this.dropTargets.delete(e),this.types.delete(e)}pinSource(e){const t=this.getSource(e);B(t,"Expected an existing source."),this.pinnedSourceId=e,this.pinnedSource=t}unpinSource(){B(this.pinnedSource,"No source is pinned at the time."),this.pinnedSourceId=null,this.pinnedSource=null}addHandler(e,t,n){const s=ui(e);return this.types.set(s,t),e===be.SOURCE?this.dragSources.set(s,n):e===be.TARGET&&this.dropTargets.set(s,n),s}constructor(e){this.types=new Map,this.dragSources=new Map,this.dropTargets=new Map,this.pinnedSourceId=null,this.pinnedSource=null,this.store=e}}const fi=(r,e)=>r===e;function hi(r,e){return!r&&!e?!0:!r||!e?!1:r.x===e.x&&r.y===e.y}function gi(r,e,t=fi){if(r.length!==e.length)return!1;for(let n=0;n<r.length;++n)if(!t(r[n],e[n]))return!1;return!0}function pi(r=dt,e){switch(e.type){case Et:break;case Or:case Tr:case It:case Dr:return dt;case Dt:case jr:case Pt:case Nt:default:return kr}const{targetIds:t=[],prevTargetIds:n=[]}=e.payload,s=bs(t,n);if(!(s.length>0||!gi(t,n)))return dt;const c=n[n.length-1],l=t[t.length-1];return c!==l&&(c&&s.push(c),l&&s.push(l)),s}function mi(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function vi(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.forEach(function(s){mi(r,s,t[s])})}return r}const Xr={initialSourceClientOffset:null,initialClientOffset:null,clientOffset:null};function xi(r=Xr,e){const{payload:t}=e;switch(e.type){case _r:case Dt:return{initialSourceClientOffset:t.sourceClientOffset,initialClientOffset:t.clientOffset,clientOffset:t.clientOffset};case Et:return hi(r.clientOffset,t.clientOffset)?r:vi({},r,{clientOffset:t.clientOffset});case Pt:case Nt:return Xr;default:return r}}function bi(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ye(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.forEach(function(s){bi(r,s,t[s])})}return r}const yi={itemType:null,item:null,sourceId:null,targetIds:[],dropResult:null,didDrop:!1,isSourcePublic:null};function wi(r=yi,e){const{payload:t}=e;switch(e.type){case Dt:return Ye({},r,{itemType:t.itemType,item:t.item,sourceId:t.sourceId,isSourcePublic:t.isSourcePublic,dropResult:null,didDrop:!1});case jr:return Ye({},r,{isSourcePublic:!0});case Et:return Ye({},r,{targetIds:t.targetIds});case It:return r.targetIds.indexOf(t.targetId)===-1?r:Ye({},r,{targetIds:xs(r.targetIds,t.targetId)});case Nt:return Ye({},r,{dropResult:t.dropResult,didDrop:!0,targetIds:[]});case Pt:return Ye({},r,{itemType:null,item:null,sourceId:null,dropResult:null,didDrop:!1,isSourcePublic:null,targetIds:[]});default:return r}}function Ci(r=0,e){switch(e.type){case Or:case Tr:return r+1;case Dr:case It:return r-1;default:return r}}function Si(r=0){return r+1}function _i(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function ji(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.forEach(function(s){_i(r,s,t[s])})}return r}function ki(r={},e){return{dirtyHandlerIds:pi(r.dirtyHandlerIds,{type:e.type,payload:ji({},e.payload,{prevTargetIds:vs(r,"dragOperation.targetIds",[])})}),dragOffset:xi(r.dragOffset,e),refCount:Ci(r.refCount,e),dragOperation:wi(r.dragOperation,e),stateId:Si(r.stateId)}}function Oi(r,e=void 0,t={},n=!1){const s=Ti(n),o=new Vs(s,new di(s)),c=new Us(s,o),l=r(c,e,t);return c.receiveBackend(l),c}function Ti(r){const e=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION__;return vn(ki,r&&e&&e({name:"dnd-core",instanceId:"dnd-core"}))}function Di(r,e){if(r==null)return{};var t=Ei(r,e),n,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(s=0;s<o.length;s++)n=o[s],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function Ei(r,e){if(r==null)return{};var t={},n=Object.keys(r),s,o;for(o=0;o<n.length;o++)s=n[o],!(e.indexOf(s)>=0)&&(t[s]=r[s]);return t}let Jr=0;const jt=Symbol.for("__REACT_DND_CONTEXT_INSTANCE__");var Ni=w.memo(function(e){var{children:t}=e,n=Di(e,["children"]);const[s,o]=Pi(n);return w.useEffect(()=>{if(o){const c=Sn();return++Jr,()=>{--Jr===0&&(c[jt]=null)}}},[]),i.jsx(mn.Provider,{value:s,children:t})});function Pi(r){if("manager"in r)return[{dragDropManager:r.manager},!1];const e=Ii(r.backend,r.context,r.options,r.debugMode),t=!r.context;return[e,t]}function Ii(r,e=Sn(),t,n){const s=e;return s[jt]||(s[jt]={dragDropManager:Oi(r,e,t,n)}),s[jt]}function Sn(){return typeof global<"u"?global:window}var Li=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,s,o;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(s=n;s--!==0;)if(!r(e[s],t[s]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(o=Object.keys(e),n=o.length,n!==Object.keys(t).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(t,o[s]))return!1;for(s=n;s--!==0;){var c=o[s];if(!r(e[c],t[c]))return!1}return!0}return e!==e&&t!==t};const Be=typeof window<"u"?w.useLayoutEffect:w.useEffect;function _n(r,e,t){const[n,s]=w.useState(()=>e(r)),o=w.useCallback(()=>{const c=e(r);Li(n,c)||(s(c),t&&t())},[n,r,t]);return Be(o),[n,o]}function Mi(r,e,t){const[n,s]=_n(r,e,t);return Be(function(){const c=r.getHandlerId();if(c!=null)return r.subscribeToStateChange(s,{handlerIds:[c]})},[r,s]),n}function jn(r,e,t){return Mi(e,r||(()=>({})),()=>t.reconnect())}function kn(r,e){const t=[...e||[]];return e==null&&typeof r!="function"&&t.push(r),w.useMemo(()=>typeof r=="function"?r():r,t)}function Ri(r){return w.useMemo(()=>r.hooks.dragSource(),[r])}function Ai(r){return w.useMemo(()=>r.hooks.dragPreview(),[r])}let Zt=!1,er=!1;class $i{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){B(!Zt,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return Zt=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{Zt=!1}}isDragging(){if(!this.sourceId)return!1;B(!er,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return er=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{er=!1}}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,t){return this.internalMonitor.isOverTarget(e,t)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}let tr=!1;class Bi{receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;B(!tr,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return tr=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{tr=!1}}isOver(e){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,e):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}function Hi(r,e,t){const n=t.getRegistry(),s=n.addTarget(r,e);return[s,()=>n.removeTarget(s)]}function Fi(r,e,t){const n=t.getRegistry(),s=n.addSource(r,e);return[s,()=>n.removeSource(s)]}function vr(r,e,t,n){let s;if(s!==void 0)return!!s;if(r===e)return!0;if(typeof r!="object"||!r||typeof e!="object"||!e)return!1;const o=Object.keys(r),c=Object.keys(e);if(o.length!==c.length)return!1;const l=Object.prototype.hasOwnProperty.bind(e);for(let a=0;a<o.length;a++){const d=o[a];if(!l(d))return!1;const h=r[d],x=e[d];if(s=void 0,s===!1||s===void 0&&h!==x)return!1}return!0}function xr(r){return r!==null&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function Wi(r){if(typeof r.type=="string")return;const e=r.type.displayName||r.type.name||"the component";throw new Error(`Only native element nodes can now be passed to React DnD connectors.You can either wrap ${e} into a <div>, or turn it into a drag source or a drop target itself.`)}function Ui(r){return(e=null,t=null)=>{if(!w.isValidElement(e)){const o=e;return r(o,t),o}const n=e;return Wi(n),zi(n,t?o=>r(o,t):r)}}function On(r){const e={};return Object.keys(r).forEach(t=>{const n=r[t];if(t.endsWith("Ref"))e[t]=r[t];else{const s=Ui(n);e[t]=()=>s}}),e}function Zr(r,e){typeof r=="function"?r(e):r.current=e}function zi(r,e){const t=r.ref;return B(typeof t!="string","Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs"),t?w.cloneElement(r,{ref:n=>{Zr(t,n),Zr(e,n)}}):w.cloneElement(r,{ref:e})}class qi{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){const e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){const e=this.dragSource,t=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return t&&this.disconnectDragSource(),this.handlerId?e?(t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),t):(this.lastConnectedDragSource=e,t):t}reconnectDragPreview(e=!1){const t=this.dragPreview,n=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(n&&this.disconnectDragPreview(),!!this.handlerId){if(!t){this.lastConnectedDragPreview=t;return}n&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=t,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,t,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!vr(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!vr(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=On({dragSource:(t,n)=>{this.clearDragSource(),this.dragSourceOptions=n||null,xr(t)?this.dragSourceRef=t:this.dragSourceNode=t,this.reconnectDragSource()},dragPreview:(t,n)=>{this.clearDragPreview(),this.dragPreviewOptions=n||null,xr(t)?this.dragPreviewRef=t:this.dragPreviewNode=t,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}class Ki{get connectTarget(){return this.dropTarget}reconnect(){const e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();const t=this.dropTarget;if(this.handlerId){if(!t){this.lastConnectedDropTarget=t;return}e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions))}}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!vr(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=On({dropTarget:(t,n)=>{this.clearDropTarget(),this.dropTargetOptions=n,xr(t)?this.dropTargetRef=t:this.dropTargetNode=t,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}function He(){const{dragDropManager:r}=w.useContext(mn);return B(r!=null,"Expected drag drop context"),r}function Gi(r,e){const t=He(),n=w.useMemo(()=>new qi(t.getBackend()),[t]);return Be(()=>(n.dragSourceOptions=r||null,n.reconnect(),()=>n.disconnectDragSource()),[n,r]),Be(()=>(n.dragPreviewOptions=e||null,n.reconnect(),()=>n.disconnectDragPreview()),[n,e]),n}function Vi(){const r=He();return w.useMemo(()=>new $i(r),[r])}class Qi{beginDrag(){const e=this.spec,t=this.monitor;let n=null;return typeof e.item=="object"?n=e.item:typeof e.item=="function"?n=e.item(t):n={},n??null}canDrag(){const e=this.spec,t=this.monitor;return typeof e.canDrag=="boolean"?e.canDrag:typeof e.canDrag=="function"?e.canDrag(t):!0}isDragging(e,t){const n=this.spec,s=this.monitor,{isDragging:o}=n;return o?o(s):t===e.getSourceId()}endDrag(){const e=this.spec,t=this.monitor,n=this.connector,{end:s}=e;s&&s(t.getItem(),t),n.reconnect()}constructor(e,t,n){this.spec=e,this.monitor=t,this.connector=n}}function Yi(r,e,t){const n=w.useMemo(()=>new Qi(r,e,t),[e,t]);return w.useEffect(()=>{n.spec=r},[r]),n}function Xi(r){return w.useMemo(()=>{const e=r.type;return B(e!=null,"spec.type must be defined"),e},[r])}function Ji(r,e,t){const n=He(),s=Yi(r,e,t),o=Xi(r);Be(function(){if(o!=null){const[l,a]=Fi(o,s,n);return e.receiveHandlerId(l),t.receiveHandlerId(l),a}},[n,e,t,s,o])}function Zi(r,e){const t=kn(r,e);B(!t.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const n=Vi(),s=Gi(t.options,t.previewOptions);return Ji(t,n,s),[jn(t.collect,n,s),Ri(s),Ai(s)]}function eo(r){const t=He().getMonitor(),[n,s]=_n(t,r);return w.useEffect(()=>t.subscribeToOffsetChange(s)),w.useEffect(()=>t.subscribeToStateChange(s)),n}function to(r){return w.useMemo(()=>r.hooks.dropTarget(),[r])}function ro(r){const e=He(),t=w.useMemo(()=>new Ki(e.getBackend()),[e]);return Be(()=>(t.dropTargetOptions=r||null,t.reconnect(),()=>t.disconnectDropTarget()),[r]),t}function no(){const r=He();return w.useMemo(()=>new Bi(r),[r])}function so(r){const{accept:e}=r;return w.useMemo(()=>(B(r.accept!=null,"accept must be defined"),Array.isArray(e)?e:[e]),[e])}class io{canDrop(){const e=this.spec,t=this.monitor;return e.canDrop?e.canDrop(t.getItem(),t):!0}hover(){const e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){const e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function oo(r,e){const t=w.useMemo(()=>new io(r,e),[e]);return w.useEffect(()=>{t.spec=r},[r]),t}function ao(r,e,t){const n=He(),s=oo(r,e),o=so(r);Be(function(){const[l,a]=Hi(o,s,n);return e.receiveHandlerId(l),t.receiveHandlerId(l),a},[n,e,s,t,o.map(c=>c.toString()).join("|")])}function lo(r,e){const t=kn(r,e),n=no(),s=ro(t.options);return ao(t,n,s),[jn(t.collect,n,s),to(s)]}function Tn(r){let e=null;return()=>(e==null&&(e=r()),e)}function co(r,e){return r.filter(t=>t!==e)}function uo(r,e){const t=new Set,n=o=>t.add(o);r.forEach(n),e.forEach(n);const s=[];return t.forEach(o=>s.push(o)),s}class fo{enter(e){const t=this.entered.length,n=s=>this.isNodeInDocument(s)&&(!s.contains||s.contains(e));return this.entered=uo(this.entered.filter(n),[e]),t===0&&this.entered.length>0}leave(e){const t=this.entered.length;return this.entered=co(this.entered.filter(this.isNodeInDocument),e),t>0&&this.entered.length===0}reset(){this.entered=[]}constructor(e){this.entered=[],this.isNodeInDocument=e}}class ho{initializeExposedProperties(){Object.keys(this.config.exposeProperties).forEach(e=>{Object.defineProperty(this.item,e,{configurable:!0,enumerable:!0,get(){return console.warn(`Browser doesn't allow reading "${e}" until the drop event.`),null}})})}loadDataTransfer(e){if(e){const t={};Object.keys(this.config.exposeProperties).forEach(n=>{const s=this.config.exposeProperties[n];s!=null&&(t[n]={value:s(e,this.config.matchesTypes),configurable:!0,enumerable:!0})}),Object.defineProperties(this.item,t)}}canDrag(){return!0}beginDrag(){return this.item}isDragging(e,t){return t===e.getSourceId()}endDrag(){}constructor(e){this.config=e,this.item={},this.initializeExposedProperties()}}const Dn="__NATIVE_FILE__",En="__NATIVE_URL__",Nn="__NATIVE_TEXT__",Pn="__NATIVE_HTML__";var en=Object.freeze({__proto__:null,FILE:Dn,HTML:Pn,TEXT:Nn,URL:En});function rr(r,e,t){const n=e.reduce((s,o)=>s||r.getData(o),"");return n??t}const br={[Dn]:{exposeProperties:{files:r=>Array.prototype.slice.call(r.files),items:r=>r.items,dataTransfer:r=>r},matchesTypes:["Files"]},[Pn]:{exposeProperties:{html:(r,e)=>rr(r,e,""),dataTransfer:r=>r},matchesTypes:["Html","text/html"]},[En]:{exposeProperties:{urls:(r,e)=>rr(r,e,"").split(`
`),dataTransfer:r=>r},matchesTypes:["Url","text/uri-list"]},[Nn]:{exposeProperties:{text:(r,e)=>rr(r,e,""),dataTransfer:r=>r},matchesTypes:["Text","text/plain"]}};function go(r,e){const t=br[r];if(!t)throw new Error(`native type ${r} has no configuration`);const n=new ho(t);return n.loadDataTransfer(e),n}function nr(r){if(!r)return null;const e=Array.prototype.slice.call(r.types||[]);return Object.keys(br).filter(t=>{const n=br[t];return n?.matchesTypes?n.matchesTypes.some(s=>e.indexOf(s)>-1):!1})[0]||null}const po=Tn(()=>/firefox/i.test(navigator.userAgent)),In=Tn(()=>!!window.safari);class tn{interpolate(e){const{xs:t,ys:n,c1s:s,c2s:o,c3s:c}=this;let l=t.length-1;if(e===t[l])return n[l];let a=0,d=c.length-1,h;for(;a<=d;){h=Math.floor(.5*(a+d));const f=t[h];if(f<e)a=h+1;else if(f>e)d=h-1;else return n[h]}l=Math.max(0,d);const x=e-t[l],u=x*x;return n[l]+s[l]*x+o[l]*u+c[l]*x*u}constructor(e,t){const{length:n}=e,s=[];for(let f=0;f<n;f++)s.push(f);s.sort((f,p)=>e[f]<e[p]?-1:1);const o=[],c=[];let l,a;for(let f=0;f<n-1;f++)l=e[f+1]-e[f],a=t[f+1]-t[f],o.push(l),c.push(a/l);const d=[c[0]];for(let f=0;f<o.length-1;f++){const p=c[f],m=c[f+1];if(p*m<=0)d.push(0);else{l=o[f];const C=o[f+1],S=l+C;d.push(3*S/((S+C)/p+(S+l)/m))}}d.push(c[c.length-1]);const h=[],x=[];let u;for(let f=0;f<d.length-1;f++){u=c[f];const p=d[f],m=1/o[f],C=p+d[f+1]-u-u;h.push((u-p-C)*m),x.push(C*m*m)}this.xs=e,this.ys=t,this.c1s=d,this.c2s=h,this.c3s=x}}const mo=1;function Ln(r){const e=r.nodeType===mo?r:r.parentElement;if(!e)return null;const{top:t,left:n}=e.getBoundingClientRect();return{x:n,y:t}}function xt(r){return{x:r.clientX,y:r.clientY}}function vo(r){var e;return r.nodeName==="IMG"&&(po()||!(!((e=document.documentElement)===null||e===void 0)&&e.contains(r)))}function xo(r,e,t,n){let s=r?e.width:t,o=r?e.height:n;return In()&&r&&(o/=window.devicePixelRatio,s/=window.devicePixelRatio),{dragPreviewWidth:s,dragPreviewHeight:o}}function bo(r,e,t,n,s){const o=vo(e),l=Ln(o?r:e),a={x:t.x-l.x,y:t.y-l.y},{offsetWidth:d,offsetHeight:h}=r,{anchorX:x,anchorY:u}=n,{dragPreviewWidth:f,dragPreviewHeight:p}=xo(o,e,d,h),m=()=>{let E=new tn([0,.5,1],[a.y,a.y/h*p,a.y+p-h]).interpolate(u);return In()&&o&&(E+=(window.devicePixelRatio-1)*p),E},C=()=>new tn([0,.5,1],[a.x,a.x/d*f,a.x+f-d]).interpolate(x),{offsetX:S,offsetY:O}=s,j=S===0||S,T=O===0||O;return{x:j?S:C(),y:T?O:m()}}let yo=class{get window(){if(this.globalContext)return this.globalContext;if(typeof window<"u")return window}get document(){var e;return!((e=this.globalContext)===null||e===void 0)&&e.document?this.globalContext.document:this.window?this.window.document:void 0}get rootElement(){var e;return((e=this.optionsArgs)===null||e===void 0?void 0:e.rootElement)||this.window}constructor(e,t){this.ownerDocument=null,this.globalContext=e,this.optionsArgs=t}};function wo(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function rn(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.forEach(function(s){wo(r,s,t[s])})}return r}class Co{profile(){var e,t;return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodeOptions:this.sourceNodeOptions.size,sourceNodes:this.sourceNodes.size,dragStartSourceIds:((e=this.dragStartSourceIds)===null||e===void 0?void 0:e.length)||0,dropTargetIds:this.dropTargetIds.length,dragEnterTargetIds:this.dragEnterTargetIds.length,dragOverTargetIds:((t=this.dragOverTargetIds)===null||t===void 0?void 0:t.length)||0}}get window(){return this.options.window}get document(){return this.options.document}get rootElement(){return this.options.rootElement}setup(){const e=this.rootElement;if(e!==void 0){if(e.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");e.__isReactDndBackendSetUp=!0,this.addEventListeners(e)}}teardown(){const e=this.rootElement;if(e!==void 0&&(e.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.rootElement),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId)){var t;(t=this.window)===null||t===void 0||t.cancelAnimationFrame(this.asyncEndDragFrameId)}}connectDragPreview(e,t,n){return this.sourcePreviewNodeOptions.set(e,n),this.sourcePreviewNodes.set(e,t),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDragSource(e,t,n){this.sourceNodes.set(e,t),this.sourceNodeOptions.set(e,n);const s=c=>this.handleDragStart(c,e),o=c=>this.handleSelectStart(c);return t.setAttribute("draggable","true"),t.addEventListener("dragstart",s),t.addEventListener("selectstart",o),()=>{this.sourceNodes.delete(e),this.sourceNodeOptions.delete(e),t.removeEventListener("dragstart",s),t.removeEventListener("selectstart",o),t.setAttribute("draggable","false")}}connectDropTarget(e,t){const n=c=>this.handleDragEnter(c,e),s=c=>this.handleDragOver(c,e),o=c=>this.handleDrop(c,e);return t.addEventListener("dragenter",n),t.addEventListener("dragover",s),t.addEventListener("drop",o),()=>{t.removeEventListener("dragenter",n),t.removeEventListener("dragover",s),t.removeEventListener("drop",o)}}addEventListeners(e){e.addEventListener&&(e.addEventListener("dragstart",this.handleTopDragStart),e.addEventListener("dragstart",this.handleTopDragStartCapture,!0),e.addEventListener("dragend",this.handleTopDragEndCapture,!0),e.addEventListener("dragenter",this.handleTopDragEnter),e.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.addEventListener("dragover",this.handleTopDragOver),e.addEventListener("dragover",this.handleTopDragOverCapture,!0),e.addEventListener("drop",this.handleTopDrop),e.addEventListener("drop",this.handleTopDropCapture,!0))}removeEventListeners(e){e.removeEventListener&&(e.removeEventListener("dragstart",this.handleTopDragStart),e.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),e.removeEventListener("dragend",this.handleTopDragEndCapture,!0),e.removeEventListener("dragenter",this.handleTopDragEnter),e.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.removeEventListener("dragover",this.handleTopDragOver),e.removeEventListener("dragover",this.handleTopDragOverCapture,!0),e.removeEventListener("drop",this.handleTopDrop),e.removeEventListener("drop",this.handleTopDropCapture,!0))}getCurrentSourceNodeOptions(){const e=this.monitor.getSourceId(),t=this.sourceNodeOptions.get(e);return rn({dropEffect:this.altKeyPressed?"copy":"move"},t||{})}getCurrentDropEffect(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}getCurrentSourcePreviewNodeOptions(){const e=this.monitor.getSourceId(),t=this.sourcePreviewNodeOptions.get(e);return rn({anchorX:.5,anchorY:.5,captureDraggingState:!1},t||{})}isDraggingNativeItem(){const e=this.monitor.getItemType();return Object.keys(en).some(t=>en[t]===e)}beginDragNativeItem(e,t){this.clearCurrentDragSourceNode(),this.currentNativeSource=go(e,t),this.currentNativeHandle=this.registry.addSource(e,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}setCurrentDragSourceNode(e){this.clearCurrentDragSourceNode(),this.currentDragSourceNode=e;const t=1e3;this.mouseMoveTimeoutTimer=setTimeout(()=>{var n;return(n=this.rootElement)===null||n===void 0?void 0:n.addEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)},t)}clearCurrentDragSourceNode(){if(this.currentDragSourceNode){if(this.currentDragSourceNode=null,this.rootElement){var e;(e=this.window)===null||e===void 0||e.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.rootElement.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)}return this.mouseMoveTimeoutTimer=null,!0}return!1}handleDragStart(e,t){e.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(t))}handleDragEnter(e,t){this.dragEnterTargetIds.unshift(t)}handleDragOver(e,t){this.dragOverTargetIds===null&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(t)}handleDrop(e,t){this.dropTargetIds.unshift(t)}constructor(e,t,n){this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.lastClientOffset=null,this.hoverRafId=null,this.getSourceClientOffset=s=>{const o=this.sourceNodes.get(s);return o&&Ln(o)||null},this.endDragNativeItem=()=>{this.isDraggingNativeItem()&&(this.actions.endDrag(),this.currentNativeHandle&&this.registry.removeSource(this.currentNativeHandle),this.currentNativeHandle=null,this.currentNativeSource=null)},this.isNodeInDocument=s=>!!(s&&this.document&&this.document.body&&this.document.body.contains(s)),this.endDragIfSourceWasRemovedFromDOM=()=>{const s=this.currentDragSourceNode;s==null||this.isNodeInDocument(s)||(this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover())},this.scheduleHover=s=>{this.hoverRafId===null&&typeof requestAnimationFrame<"u"&&(this.hoverRafId=requestAnimationFrame(()=>{this.monitor.isDragging()&&this.actions.hover(s||[],{clientOffset:this.lastClientOffset}),this.hoverRafId=null}))},this.cancelHover=()=>{this.hoverRafId!==null&&typeof cancelAnimationFrame<"u"&&(cancelAnimationFrame(this.hoverRafId),this.hoverRafId=null)},this.handleTopDragStartCapture=()=>{this.clearCurrentDragSourceNode(),this.dragStartSourceIds=[]},this.handleTopDragStart=s=>{if(s.defaultPrevented)return;const{dragStartSourceIds:o}=this;this.dragStartSourceIds=null;const c=xt(s);this.monitor.isDragging()&&(this.actions.endDrag(),this.cancelHover()),this.actions.beginDrag(o||[],{publishSource:!1,getSourceClientOffset:this.getSourceClientOffset,clientOffset:c});const{dataTransfer:l}=s,a=nr(l);if(this.monitor.isDragging()){if(l&&typeof l.setDragImage=="function"){const h=this.monitor.getSourceId(),x=this.sourceNodes.get(h),u=this.sourcePreviewNodes.get(h)||x;if(u){const{anchorX:f,anchorY:p,offsetX:m,offsetY:C}=this.getCurrentSourcePreviewNodeOptions(),j=bo(x,u,c,{anchorX:f,anchorY:p},{offsetX:m,offsetY:C});l.setDragImage(u,j.x,j.y)}}try{l?.setData("application/json",{})}catch{}this.setCurrentDragSourceNode(s.target);const{captureDraggingState:d}=this.getCurrentSourcePreviewNodeOptions();d?this.actions.publishDragSource():setTimeout(()=>this.actions.publishDragSource(),0)}else if(a)this.beginDragNativeItem(a);else{if(l&&!l.types&&(s.target&&!s.target.hasAttribute||!s.target.hasAttribute("draggable")))return;s.preventDefault()}},this.handleTopDragEndCapture=()=>{this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleTopDragEnterCapture=s=>{if(this.dragEnterTargetIds=[],this.isDraggingNativeItem()){var o;(o=this.currentNativeSource)===null||o===void 0||o.loadDataTransfer(s.dataTransfer)}if(!this.enterLeaveCounter.enter(s.target)||this.monitor.isDragging())return;const{dataTransfer:l}=s,a=nr(l);a&&this.beginDragNativeItem(a,l)},this.handleTopDragEnter=s=>{const{dragEnterTargetIds:o}=this;if(this.dragEnterTargetIds=[],!this.monitor.isDragging())return;this.altKeyPressed=s.altKey,o.length>0&&this.actions.hover(o,{clientOffset:xt(s)}),o.some(l=>this.monitor.canDropOnTarget(l))&&(s.preventDefault(),s.dataTransfer&&(s.dataTransfer.dropEffect=this.getCurrentDropEffect()))},this.handleTopDragOverCapture=s=>{if(this.dragOverTargetIds=[],this.isDraggingNativeItem()){var o;(o=this.currentNativeSource)===null||o===void 0||o.loadDataTransfer(s.dataTransfer)}},this.handleTopDragOver=s=>{const{dragOverTargetIds:o}=this;if(this.dragOverTargetIds=[],!this.monitor.isDragging()){s.preventDefault(),s.dataTransfer&&(s.dataTransfer.dropEffect="none");return}this.altKeyPressed=s.altKey,this.lastClientOffset=xt(s),this.scheduleHover(o),(o||[]).some(l=>this.monitor.canDropOnTarget(l))?(s.preventDefault(),s.dataTransfer&&(s.dataTransfer.dropEffect=this.getCurrentDropEffect())):this.isDraggingNativeItem()?s.preventDefault():(s.preventDefault(),s.dataTransfer&&(s.dataTransfer.dropEffect="none"))},this.handleTopDragLeaveCapture=s=>{this.isDraggingNativeItem()&&s.preventDefault(),this.enterLeaveCounter.leave(s.target)&&(this.isDraggingNativeItem()&&setTimeout(()=>this.endDragNativeItem(),0),this.cancelHover())},this.handleTopDropCapture=s=>{if(this.dropTargetIds=[],this.isDraggingNativeItem()){var o;s.preventDefault(),(o=this.currentNativeSource)===null||o===void 0||o.loadDataTransfer(s.dataTransfer)}else nr(s.dataTransfer)&&s.preventDefault();this.enterLeaveCounter.reset()},this.handleTopDrop=s=>{const{dropTargetIds:o}=this;this.dropTargetIds=[],this.actions.hover(o,{clientOffset:xt(s)}),this.actions.drop({dropEffect:this.getCurrentDropEffect()}),this.isDraggingNativeItem()?this.endDragNativeItem():this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleSelectStart=s=>{const o=s.target;typeof o.dragDrop=="function"&&(o.tagName==="INPUT"||o.tagName==="SELECT"||o.tagName==="TEXTAREA"||o.isContentEditable||(s.preventDefault(),o.dragDrop()))},this.options=new yo(t,n),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.registry=e.getRegistry(),this.enterLeaveCounter=new fo(this.isNodeInDocument)}}let bt;function So(){return bt||(bt=new Image,bt.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),bt}const _o=function(e,t,n){return new Co(e,t,n)};function nn({isPremovedPiece:r=!1,piece:e,square:t,squares:n}){const{animationDuration:s,arePiecesDraggable:o,boardWidth:c,boardOrientation:l,chessPieces:a,currentPosition:d,deletePieceFromSquare:h,dropOffBoardAction:x,id:u,isDraggablePiece:f,isWaitingForAnimation:p,onPieceClick:m,onPieceDragBegin:C,onPieceDragEnd:S,onPieceDropOffBoard:O,onPromotionCheck:j,positionDifferences:T}=je(),[D,E]=w.useState({opacity:1,zIndex:5,touchAction:"none",cursor:o&&f({piece:e,sourceSquare:t})?"-webkit-grab":"default"}),[{canDrag:H,isDragging:V},L,U]=Zi(()=>({type:"piece",item:()=>(C(e,t),{piece:e,square:t,id:u}),end:(G,k)=>{S(e,t),!k.didDrop()&&(x==="trash"&&h(t),O?.(t,e))},collect:G=>({canDrag:f({piece:e,sourceSquare:t}),isDragging:!!G.isDragging()})}),[e,t,d,u]);U(So(),{captureDraggingState:!0}),w.useEffect(()=>{E(G=>Object.assign(Object.assign({},G),{opacity:V?0:1}))},[V]),w.useEffect(()=>{var G;const k=(G=T.removed)===null||G===void 0?void 0:G[t];if(!T.added||!k)return;const R=Object.entries(T.added).find(([A,z])=>z===k||j(t,A,k));if(p&&k&&R&&!r){const A=t,z=R[0];if(A&&z){const Q=c/8;E(ce=>Object.assign(Object.assign({},ce),{transform:`translate(${(l==="black"?-1:1)*(z.charCodeAt(0)-A.charCodeAt(0))*Q}px, ${(l==="black"?-1:1)*(Number(A[1])-Number(z[1]))*Q}px)`,transition:`transform ${s}ms`,zIndex:6}))}}},[T]),w.useEffect(()=>{const{sourceSq:G}=se();G&&E(k=>Object.assign(Object.assign({},k),{transform:"translate(0px, 0px)",transition:"transform 0ms"}))},[d]),w.useEffect(()=>{E(G=>Object.assign(Object.assign({},G),{cursor:o&&f({piece:e,sourceSquare:t})?"-webkit-grab":"default"}))},[t,d,o]);function se(){return{sourceSq:n[t]}}return i.jsx("div",Object.assign({ref:o&&H?L:null,onClick:()=>m(e,t),"data-piece":e,style:D},{children:typeof a[e]=="function"?a[e]({squareWidth:c/8,isDragging:V,square:t}):i.jsx("svg",Object.assign({viewBox:"1 1 43 43",width:c/8,height:c/8,style:{display:"block"}},{children:i.jsx("g",{children:a[e]})}))}))}function jo({square:r,squareColor:e,setSquares:t,squareHasPremove:n,children:s}){const o=w.useRef(null),{autoPromoteToQueen:c,boardWidth:l,boardOrientation:a,clearArrows:d,currentPosition:h,currentRightClickDown:x,customBoardStyle:u,customDarkSquareStyle:f,customDropSquareStyle:p,customLightSquareStyle:m,customPremoveDarkSquareStyle:C,customPremoveLightSquareStyle:S,customSquare:O,customSquareStyles:j,drawNewArrow:T,handleSetPosition:D,handleSparePieceDrop:E,isWaitingForAnimation:H,lastPieceColour:V,lastSquareDraggedOver:L,onArrowDrawEnd:U,onDragOverSquare:se,onMouseOutSquare:G,onMouseOverSquare:k,onPieceDrop:R,onPromotionCheck:A,onRightClickDown:z,onRightClickUp:Q,onSquareClick:ce,setLastSquareDraggedOver:he,setPromoteFromSquare:ge,setPromoteToSquare:J,setShowPromoteDialog:oe}=je(),[{isOver:Ce},Se]=lo(()=>({accept:"piece",drop:Fe,collect:F=>({isOver:!!F.isOver()})}),[r,h,R,H,V]);function Fe(F){if(F.isSpare){E(F.piece,r);return}A(F.square,r,F.piece)?c?D(F.square,r,F.piece[0]==="w"?"wQ":"bQ"):(ge(F.square),J(r),oe(!0)):D(F.square,r,F.piece,!0)}w.useEffect(()=>{if(o.current){const{x:F,y:ye}=o.current.getBoundingClientRect();t(_e=>Object.assign(Object.assign({},_e),{[r]:{x:F,y:ye}}))}},[l,a]);const Ie=Object.assign(Object.assign(Object.assign(Object.assign({},ko(r,a,u)),e==="black"?f:m),n&&(e==="black"?C:S)),Ce&&p);return i.jsx("div",Object.assign({ref:Se,style:Ie,"data-square-color":e,"data-square":r,onTouchMove:F=>{var ye;const _e=F.touches[0],Le=document.elementsFromPoint(_e.clientX,_e.clientY),ae=(ye=Le?.find(de=>de.getAttribute("data-square")))===null||ye===void 0?void 0:ye.getAttribute("data-square");ae&&ae!==L&&(he(ae),se(ae))},onMouseOver:F=>{F.buttons===2&&x&&T(x,r),!(F.relatedTarget&&F.currentTarget.contains(F.relatedTarget))&&k(r)},onMouseOut:F=>{F.relatedTarget&&F.currentTarget.contains(F.relatedTarget)||G(r)},onMouseDown:F=>{F.button===2&&z(r)},onMouseUp:F=>{F.button===2&&(x&&U(x,r),Q(r))},onDragEnter:()=>se(r),onClick:()=>{const F=h[r];ce(r,F),d()},onContextMenu:F=>{F.preventDefault()}},{children:typeof O=="string"?i.jsx(O,Object.assign({ref:o,style:Object.assign(Object.assign(Object.assign({},on(l)),sn),!n&&j?.[r])},{children:s})):i.jsx(O,Object.assign({ref:o,square:r,squareColor:e,style:Object.assign(Object.assign(Object.assign({},on(l)),sn),!n&&j?.[r])},{children:s}))}))}const sn={display:"flex",justifyContent:"center"},on=r=>({width:r/8,height:r/8}),ko=(r,e,t)=>t?.borderRadius?r==="a1"?e==="white"?{borderBottomLeftRadius:t.borderRadius}:{borderTopRightRadius:t.borderRadius}:r==="a8"?e==="white"?{borderTopLeftRadius:t.borderRadius}:{borderBottomRightRadius:t.borderRadius}:r==="h1"?e==="white"?{borderBottomRightRadius:t.borderRadius}:{borderTopLeftRadius:t.borderRadius}:r==="h8"?e==="white"?{borderTopRightRadius:t.borderRadius}:{borderBottomLeftRadius:t.borderRadius}:{}:{};function Oo(){const[r,e]=w.useState({}),{arePremovesAllowed:t,boardOrientation:n,boardWidth:s,currentPosition:o,id:c,premoves:l,showBoardNotation:a}=je(),d=w.useMemo(()=>{const h=[];return t?(l.forEach((x,u)=>{const{sourceSq:f,targetSq:p,piece:m}=x,C=h.find(S=>{var O;return S.piece===m&&((O=S.premovesRoute.at(-1))===null||O===void 0?void 0:O.targetSq)===f});C?C.premovesRoute.push({sourceSq:f,targetSq:p,index:u}):h.push({piece:m,premovesRoute:[{sourceSq:f,targetSq:p,index:u}]})}),h):[]},[l]);return i.jsx("div",Object.assign({"data-boardid":c},{children:[...Array(8)].map((h,x)=>i.jsx("div",Object.assign({style:{display:"flex",flexWrap:"nowrap",width:s}},{children:[...Array(8)].map((u,f)=>{const p=n==="black"?ht[7-f]+(x+1):ht[f]+(8-x),m=f%2===x%2?"white":"black",C=l.find(O=>O.sourceSq===p||O.targetSq===p),S=d.filter(({premovesRoute:O})=>{var j;return((j=O.at(-1))===null||j===void 0?void 0:j.targetSq)===p}).sort((O,j)=>{var T,D;return((T=j.premovesRoute.at(-1))===null||T===void 0?void 0:T.index)-((D=O.premovesRoute.at(-1))===null||D===void 0?void 0:D.index)}).at(0);return i.jsxs(jo,Object.assign({square:p,squareColor:m,setSquares:e,squareHasPremove:!!C},{children:[!C&&o[p]&&i.jsx(nn,{piece:o[p],square:p,squares:r}),S&&i.jsx(nn,{isPremovedPiece:!0,piece:S.piece,square:p,squares:r}),a&&i.jsx(gs,{row:x,col:f})]}),`${f}${x}`)})}),x.toString()))}))}const To=()=>{const{arrows:r,newArrow:e,boardOrientation:t,boardWidth:n,customArrowColor:s}=je(),o=[...r,e].filter(Boolean);return i.jsx("svg",Object.assign({width:n,height:n,style:{position:"absolute",top:"0",left:"0",pointerEvents:"none",zIndex:"10"}},{children:o.map((c,l)=>{const[a,d,h]=c;if(a===d)return null;const x=gr(t,n,a),u=gr(t,n,d);let f=n/32;const p=l===r.length;r.some(j=>j[0]!==a&&j[1]===d)&&!p&&(f=n/16);const m=u.x-x.x,C=u.y-x.y,S=Math.hypot(C,m),O={x:x.x+m*(S-f)/S,y:x.y+C*(S-f)/S};return i.jsxs(w.Fragment,{children:[i.jsx("marker",Object.assign({id:`arrowhead-${l}`,markerWidth:"2",markerHeight:"2.5",refX:"1.25",refY:"1.25",orient:"auto"},{children:i.jsx("polygon",{points:"0.3 0, 2 1.25, 0.3 2.5",fill:h??s})})),i.jsx("line",{x1:x.x,y1:x.y,x2:O.x,y2:O.y,opacity:p?"0.5":"0.65",stroke:h??s,strokeWidth:p?.9*n/40:n/40,markerEnd:`url(#arrowhead-${l})`})]},`${a}-${d}${p?"-active":""}`)})}))};function Do({option:r}){const[e,t]=w.useState(!1),{boardWidth:n,chessPieces:s,customDarkSquareStyle:o,customLightSquareStyle:c,handleSetPosition:l,onPromotionPieceSelect:a,promoteFromSquare:d,promoteToSquare:h,promotionDialogVariant:x}=je(),u=()=>{switch(r[1]){case"Q":return o.backgroundColor;case"R":return c.backgroundColor;case"N":return x==="default"?c.backgroundColor:o.backgroundColor;case"B":return x==="default"?o.backgroundColor:c.backgroundColor}};return i.jsx("div",Object.assign({onClick:()=>{a(r,d??void 0,h??void 0)&&l(d,h,r,!0)},onMouseOver:()=>t(!0),onMouseOut:()=>t(!1),"data-piece":r,style:{cursor:"pointer",backgroundColor:e?u():`${u()}aa`,borderRadius:"4px",transition:"all 0.1s ease-out"}},{children:typeof s[r]=="function"?i.jsx("div",Object.assign({style:{transition:"all 0.1s ease-out",transform:e?"scale(1)":"scale(0.85)"}},{children:s[r]({squareWidth:n/8,isDragging:!1})})):i.jsx("svg",Object.assign({viewBox:"1 1 43 43",width:n/8,height:n/8,style:{transition:"all 0.1s ease-out",transform:e?"scale(1)":"scale(0.85)"}},{children:i.jsx("g",{children:s[r]})}))}))}function Eo(){const{boardOrientation:r,boardWidth:e,promotionDialogVariant:t,promoteToSquare:n}=je(),s=n?.[1]==="1"?"b":"w",o=[`${s??"w"}Q`,`${s??"w"}R`,`${s??"w"}N`,`${s??"w"}B`],c={default:{display:"grid",gridTemplateColumns:"1fr 1fr",transform:`translate(${-e/8}px, ${-e/8}px)`},vertical:{transform:`translate(${-e/16}px, ${-e/16}px)`},modal:{display:"flex",justifyContent:"center",alignItems:"center",transform:`translate(0px, ${3*e/8}px)`,width:"100%",height:`${e/4}px`,top:0,backgroundColor:"white",left:0}},l=gr(r,e,n||"a8");return i.jsx("div",Object.assign({style:Object.assign({position:"absolute",top:`${l?.y}px`,left:`${l?.x}px`,zIndex:1e3},c[t]),title:"Choose promotion piece"},{children:o.map(a=>i.jsx(Do,{option:a},a))}))}const No={whiteKing:i.jsx("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",version:"1.1",style:{shapeRendering:"geometricPrecision",textRendering:"geometricPrecision",imageRendering:"crisp-edges"},viewBox:"0 0 4210 12970",x:"0px",y:"0px",fillRule:"evenodd",clipRule:"evenodd",width:"250",height:"250"},{children:i.jsx("g",{children:i.jsx("path",{style:{fill:"black",fillRule:"nonzero"},d:"M2105 0c169,0 286,160 249,315l200 0c-172,266 -231,479 -256,792 315,-24 530,-86 792,-255l0 897c-265,-171 -479,-231 -792,-256 18,234 75,495 185,682l339 0c233,0 369,269 225,456l545 0 -595 1916c130,94 158,275 59,402 465,0 416,568 51,568l-334 0 465 2867 332 0c250,0 381,306 199,485 162,63 273,220 273,399l0 633 168 0 0 475c-1403,0 -2807,0 -4210,0l0 -475 167 0 0 -633c0,-179 112,-336 274,-399 -181,-178 -52,-485 199,-485l332 0 465 -2867 -335 0c-353,0 -418,-568 51,-568 -98,-127 -70,-308 59,-402l-594 -1916c181,0 363,0 545,0 -144,-187 -9,-456 225,-456l339 0c110,-187 167,-448 185,-682 -315,25 -530,87 -793,256l0 -897c266,171 480,231 793,255 -25,-315 -87,-529 -256,-792l199 0c-36,-155 81,-315 250,-315zm-1994 10012l0 253 3988 0 0 -253c-1330,0 -2659,0 -3988,0zm484 -1060c-174,0 -316,142 -316,316l0 633 3652 0 0 -633c0,-174 -142,-316 -316,-316 -1007,0 -2013,0 -3020,0zm45 -457c-230,0 -225,345 0,345l2930 0c230,0 225,-345 0,-345 -977,0 -1953,0 -2930,0zm2020 -2978l-1111 0 -465 2867 2041 0 -465 -2867zm-1558 -456c-229,0 -224,345 0,345 669,0 1337,0 2005,0 230,0 225,-345 0,-345 -668,0 -1336,0 -2005,0zm1730 -457l-1454 0c-229,0 -224,345 0,345l1454 0c229,0 224,-345 0,-345zm-2064 -1862l544 1751c529,0 1057,0 1586,0l544 -1751c-892,0 -1783,0 -2674,0zm1085 -567l504 0c-126,-247 -163,-526 -177,-800 273,15 553,52 800,177l0 -504c-247,126 -527,163 -800,177 14,-273 51,-552 177,-799 -168,0 -336,0 -504,0 125,247 162,526 177,799 -274,-14 -553,-51 -800,-177l0 504c247,-125 527,-162 800,-177 -15,274 -52,553 -177,800zm969 111l-1434 0c-230,0 -225,345 0,345l1434 0c230,0 225,-345 0,-345zm-717 -2175c-105,0 -175,109 -133,204l266 0c42,-96 -30,-205 -133,-204z"})})}))};function Po({children:r}){try{return i.jsx(i.Fragment,{children:r})}catch(e){return console.log(e),i.jsx(Mn,{showError:!0})}}function Mn({showError:r=!1}){return i.jsxs("div",Object.assign({style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"}},{children:[i.jsx("div",Object.assign({style:{width:250,height:250,transform:"rotate(90deg)"}},{children:No.whiteKing})),r&&i.jsx("h1",{children:"Something went wrong"})]}))}function Io(){const r=w.useRef(null),{boardWidth:e,clearCurrentRightClickDown:t,onPromotionPieceSelect:n,setShowPromoteDialog:s,showPromoteDialog:o,customBoardStyle:c}=je();return w.useEffect(()=>{function l(a){r.current&&!r.current.contains(a.target)&&t()}return document.addEventListener("mouseup",l),()=>{document.removeEventListener("mouseup",l)}},[]),e?i.jsx("div",Object.assign({style:{perspective:"1000px"}},{children:i.jsxs("div",Object.assign({ref:r,style:Object.assign(Object.assign({position:"relative"},Lo(e)),c)},{children:[i.jsx(Oo,{}),i.jsx(To,{}),o&&i.jsxs(i.Fragment,{children:[i.jsx("div",{onClick:()=>{s(!1),n?.()},style:{position:"absolute",top:"0",left:"0",zIndex:"100",backgroundColor:"rgba(22,21,18,.7)",width:e,height:e}}),i.jsx(Eo,{})]})]}))})):i.jsx(Mn,{})}const Lo=r=>({cursor:"default",height:r,width:r});var Pe;(function(r){r.mouse="mouse",r.touch="touch",r.keyboard="keyboard"})(Pe||(Pe={}));class Mo{get delay(){var e;return(e=this.args.delay)!==null&&e!==void 0?e:0}get scrollAngleRanges(){return this.args.scrollAngleRanges}get getDropTargetElementsAtPoint(){return this.args.getDropTargetElementsAtPoint}get ignoreContextMenu(){var e;return(e=this.args.ignoreContextMenu)!==null&&e!==void 0?e:!1}get enableHoverOutsideTarget(){var e;return(e=this.args.enableHoverOutsideTarget)!==null&&e!==void 0?e:!1}get enableKeyboardEvents(){var e;return(e=this.args.enableKeyboardEvents)!==null&&e!==void 0?e:!1}get enableMouseEvents(){var e;return(e=this.args.enableMouseEvents)!==null&&e!==void 0?e:!1}get enableTouchEvents(){var e;return(e=this.args.enableTouchEvents)!==null&&e!==void 0?e:!0}get touchSlop(){return this.args.touchSlop||0}get delayTouchStart(){var e,t,n,s;return(s=(n=(e=this.args)===null||e===void 0?void 0:e.delayTouchStart)!==null&&n!==void 0?n:(t=this.args)===null||t===void 0?void 0:t.delay)!==null&&s!==void 0?s:0}get delayMouseStart(){var e,t,n,s;return(s=(n=(e=this.args)===null||e===void 0?void 0:e.delayMouseStart)!==null&&n!==void 0?n:(t=this.args)===null||t===void 0?void 0:t.delay)!==null&&s!==void 0?s:0}get window(){if(this.context&&this.context.window)return this.context.window;if(typeof window<"u")return window}get document(){var e;if(!((e=this.context)===null||e===void 0)&&e.document)return this.context.document;if(this.window)return this.window.document}get rootElement(){var e;return((e=this.args)===null||e===void 0?void 0:e.rootElement)||this.document}constructor(e,t){this.args=e,this.context=t}}function Ro(r,e,t,n){return Math.sqrt(Math.pow(Math.abs(t-r),2)+Math.pow(Math.abs(n-e),2))}function Ao(r,e,t,n,s){if(!s)return!1;const o=Math.atan2(n-e,t-r)*180/Math.PI+180;for(let c=0;c<s.length;++c){const l=s[c];if(l&&(l.start==null||o>=l.start)&&(l.end==null||o<=l.end))return!0}return!1}const $o={Left:1},Bo={Left:0};function sr(r){return r.button===void 0||r.button===Bo.Left}function Ho(r){return r.buttons===void 0||(r.buttons&$o.Left)===0}function Rn(r){return!!r.targetTouches}const Fo=1;function Wo(r){const e=r.nodeType===Fo?r:r.parentElement;if(!e)return;const{top:t,left:n}=e.getBoundingClientRect();return{x:n,y:t}}function Uo(r,e){if(r.targetTouches.length===1)return Tt(r.targetTouches[0]);if(e&&r.touches.length===1&&r.touches[0].target===e.target)return Tt(r.touches[0])}function Tt(r,e){return Rn(r)?Uo(r,e):{x:r.clientX,y:r.clientY}}const an=(()=>{let r=!1;try{addEventListener("test",()=>{},Object.defineProperty({},"passive",{get(){return r=!0,!0}}))}catch{}return r})(),lt={[Pe.mouse]:{start:"mousedown",move:"mousemove",end:"mouseup",contextmenu:"contextmenu"},[Pe.touch]:{start:"touchstart",move:"touchmove",end:"touchend"},[Pe.keyboard]:{keydown:"keydown"}};class ft{profile(){var e;return{sourceNodes:this.sourceNodes.size,sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,targetNodes:this.targetNodes.size,dragOverTargetIds:((e=this.dragOverTargetIds)===null||e===void 0?void 0:e.length)||0}}get document(){return this.options.document}setup(){const e=this.options.rootElement;e&&(B(!ft.isSetUp,"Cannot have two Touch backends at the same time."),ft.isSetUp=!0,this.addEventListener(e,"start",this.getTopMoveStartHandler()),this.addEventListener(e,"start",this.handleTopMoveStartCapture,!0),this.addEventListener(e,"move",this.handleTopMove),this.addEventListener(e,"move",this.handleTopMoveCapture,!0),this.addEventListener(e,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.addEventListener(e,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.addEventListener(e,"keydown",this.handleCancelOnEscape,!0))}teardown(){const e=this.options.rootElement;e&&(ft.isSetUp=!1,this._mouseClientOffset={},this.removeEventListener(e,"start",this.handleTopMoveStartCapture,!0),this.removeEventListener(e,"start",this.handleTopMoveStart),this.removeEventListener(e,"move",this.handleTopMoveCapture,!0),this.removeEventListener(e,"move",this.handleTopMove),this.removeEventListener(e,"end",this.handleTopMoveEndCapture,!0),this.options.enableMouseEvents&&!this.options.ignoreContextMenu&&this.removeEventListener(e,"contextmenu",this.handleTopMoveEndCapture),this.options.enableKeyboardEvents&&this.removeEventListener(e,"keydown",this.handleCancelOnEscape,!0),this.uninstallSourceNodeRemovalObserver())}addEventListener(e,t,n,s=!1){const o=an?{capture:s,passive:!1}:s;this.listenerTypes.forEach(function(c){const l=lt[c][t];l&&e.addEventListener(l,n,o)})}removeEventListener(e,t,n,s=!1){const o=an?{capture:s,passive:!1}:s;this.listenerTypes.forEach(function(c){const l=lt[c][t];l&&e.removeEventListener(l,n,o)})}connectDragSource(e,t){const n=this.handleMoveStart.bind(this,e);return this.sourceNodes.set(e,t),this.addEventListener(t,"start",n),()=>{this.sourceNodes.delete(e),this.removeEventListener(t,"start",n)}}connectDragPreview(e,t,n){return this.sourcePreviewNodeOptions.set(e,n),this.sourcePreviewNodes.set(e,t),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDropTarget(e,t){const n=this.options.rootElement;if(!this.document||!n)return()=>{};const s=o=>{if(!this.document||!n||!this.monitor.isDragging())return;let c;switch(o.type){case lt.mouse.move:c={x:o.clientX,y:o.clientY};break;case lt.touch.move:var l,a;c={x:((l=o.touches[0])===null||l===void 0?void 0:l.clientX)||0,y:((a=o.touches[0])===null||a===void 0?void 0:a.clientY)||0};break}const d=c!=null?this.document.elementFromPoint(c.x,c.y):void 0,h=d&&t.contains(d);if(d===t||h)return this.handleMove(o,e)};return this.addEventListener(this.document.body,"move",s),this.targetNodes.set(e,t),()=>{this.document&&(this.targetNodes.delete(e),this.removeEventListener(this.document.body,"move",s))}}getTopMoveStartHandler(){return!this.options.delayTouchStart&&!this.options.delayMouseStart?this.handleTopMoveStart:this.handleTopMoveStartDelay}installSourceNodeRemovalObserver(e){this.uninstallSourceNodeRemovalObserver(),this.draggedSourceNode=e,this.draggedSourceNodeRemovalObserver=new MutationObserver(()=>{e&&!e.parentElement&&(this.resurrectSourceNode(),this.uninstallSourceNodeRemovalObserver())}),!(!e||!e.parentElement)&&this.draggedSourceNodeRemovalObserver.observe(e.parentElement,{childList:!0})}resurrectSourceNode(){this.document&&this.draggedSourceNode&&(this.draggedSourceNode.style.display="none",this.draggedSourceNode.removeAttribute("data-reactid"),this.document.body.appendChild(this.draggedSourceNode))}uninstallSourceNodeRemovalObserver(){this.draggedSourceNodeRemovalObserver&&this.draggedSourceNodeRemovalObserver.disconnect(),this.draggedSourceNodeRemovalObserver=void 0,this.draggedSourceNode=void 0}constructor(e,t,n){this.getSourceClientOffset=s=>{const o=this.sourceNodes.get(s);return o&&Wo(o)},this.handleTopMoveStartCapture=s=>{sr(s)&&(this.moveStartSourceIds=[])},this.handleMoveStart=s=>{Array.isArray(this.moveStartSourceIds)&&this.moveStartSourceIds.unshift(s)},this.handleTopMoveStart=s=>{if(!sr(s))return;const o=Tt(s);o&&(Rn(s)&&(this.lastTargetTouchFallback=s.targetTouches[0]),this._mouseClientOffset=o),this.waitingForDelay=!1},this.handleTopMoveStartDelay=s=>{if(!sr(s))return;const o=s.type===lt.touch.start?this.options.delayTouchStart:this.options.delayMouseStart;this.timeout=setTimeout(this.handleTopMoveStart.bind(this,s),o),this.waitingForDelay=!0},this.handleTopMoveCapture=()=>{this.dragOverTargetIds=[]},this.handleMove=(s,o)=>{this.dragOverTargetIds&&this.dragOverTargetIds.unshift(o)},this.handleTopMove=s=>{if(this.timeout&&clearTimeout(this.timeout),!this.document||this.waitingForDelay)return;const{moveStartSourceIds:o,dragOverTargetIds:c}=this,l=this.options.enableHoverOutsideTarget,a=Tt(s,this.lastTargetTouchFallback);if(!a)return;if(this._isScrolling||!this.monitor.isDragging()&&Ao(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,a.x,a.y,this.options.scrollAngleRanges)){this._isScrolling=!0;return}if(!this.monitor.isDragging()&&this._mouseClientOffset.hasOwnProperty("x")&&o&&Ro(this._mouseClientOffset.x||0,this._mouseClientOffset.y||0,a.x,a.y)>(this.options.touchSlop?this.options.touchSlop:0)&&(this.moveStartSourceIds=void 0,this.actions.beginDrag(o,{clientOffset:this._mouseClientOffset,getSourceClientOffset:this.getSourceClientOffset,publishSource:!1})),!this.monitor.isDragging())return;const d=this.sourceNodes.get(this.monitor.getSourceId());this.installSourceNodeRemovalObserver(d),this.actions.publishDragSource(),s.cancelable&&s.preventDefault();const h=(c||[]).map(p=>this.targetNodes.get(p)).filter(p=>!!p),x=this.options.getDropTargetElementsAtPoint?this.options.getDropTargetElementsAtPoint(a.x,a.y,h):this.document.elementsFromPoint(a.x,a.y),u=[];for(const p in x){if(!x.hasOwnProperty(p))continue;let m=x[p];for(m!=null&&u.push(m);m;)m=m.parentElement,m&&u.indexOf(m)===-1&&u.push(m)}const f=u.filter(p=>h.indexOf(p)>-1).map(p=>this._getDropTargetId(p)).filter(p=>!!p).filter((p,m,C)=>C.indexOf(p)===m);if(l)for(const p in this.targetNodes){const m=this.targetNodes.get(p);if(d&&m&&m.contains(d)&&f.indexOf(p)===-1){f.unshift(p);break}}f.reverse(),this.actions.hover(f,{clientOffset:a})},this._getDropTargetId=s=>{const o=this.targetNodes.keys();let c=o.next();for(;c.done===!1;){const l=c.value;if(s===this.targetNodes.get(l))return l;c=o.next()}},this.handleTopMoveEndCapture=s=>{if(this._isScrolling=!1,this.lastTargetTouchFallback=void 0,!!Ho(s)){if(!this.monitor.isDragging()||this.monitor.didDrop()){this.moveStartSourceIds=void 0;return}s.cancelable&&s.preventDefault(),this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.drop(),this.actions.endDrag()}},this.handleCancelOnEscape=s=>{s.key==="Escape"&&this.monitor.isDragging()&&(this._mouseClientOffset={},this.uninstallSourceNodeRemovalObserver(),this.actions.endDrag())},this.options=new Mo(n,t),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.sourceNodes=new Map,this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.targetNodes=new Map,this.listenerTypes=[],this._mouseClientOffset={},this._isScrolling=!1,this.options.enableMouseEvents&&this.listenerTypes.push(Pe.mouse),this.options.enableTouchEvents&&this.listenerTypes.push(Pe.touch),this.options.enableKeyboardEvents&&this.listenerTypes.push(Pe.keyboard)}}const zo=function(e,t={},n={}){return new ft(e,t,n)},qo=w.createContext({isCustomDndProviderSet:!1}),Ko=({children:r})=>i.jsx(i.Fragment,{children:r}),Go=({customDndBackend:r,customDndBackendOptions:e,children:t})=>{const[n,s]=w.useState(),[o,c]=w.useState(!1),[l,a]=w.useState(!1),{isCustomDndProviderSet:d}=w.useContext(qo);w.useEffect(()=>{a("ontouchstart"in window),c(!0),s(window)},[]);const h=d?Ko:Ni;return o?n?i.jsx(h,Object.assign({backend:r||(l?zo:_o),context:n,options:r?e:void 0},{children:t})):i.jsx(i.Fragment,{children:t}):null};function Vo({boardContainer:r}){const{boardWidth:e,chessPieces:t,id:n,snapToCursor:s,allowDragOutsideBoard:o}=je(),c=eo(u=>({item:u.getItem(),clientOffset:u.getClientOffset(),sourceClientOffset:u.getSourceClientOffset(),isDragging:u.isDragging()})),{isDragging:l,item:a,clientOffset:d,sourceClientOffset:h}=c,x=w.useCallback((u,f)=>{if(!u||!f)return{display:"none"};let{x:p,y:m}=s?u:f;const C=e/8/2;if(s&&(p-=C,m-=C),!o){const{left:O,top:j}=r,T=O-C,D=j-C,E=O+e-C,H=j+e-C;p=Math.max(T,Math.min(p,E)),m=Math.max(D,Math.min(m,H))}const S=`translate(${p}px, ${m}px)`;return{transform:S,WebkitTransform:S,touchAction:"none"}},[e,o,s,r]);return l&&a.id===n?i.jsx("div",Object.assign({style:{position:"fixed",pointerEvents:"none",zIndex:10,left:0,top:0}},{children:i.jsx("div",Object.assign({style:x(d,h)},{children:typeof t[a.piece]=="function"?t[a.piece]({squareWidth:e/8,isDragging:!0}):i.jsx("svg",Object.assign({viewBox:"1 1 43 43",width:e/8,height:e/8},{children:i.jsx("g",{children:t[a.piece]})}))}))})):null}const Qo=w.forwardRef((r,e)=>{const{customDndBackend:t,customDndBackendOptions:n,onBoardWidthChange:s}=r,o=rs(r,["customDndBackend","customDndBackendOptions","onBoardWidthChange"]),[c,l]=w.useState(r.boardWidth),a=w.useRef(null),d=w.useRef(null),[h,x]=w.useState({left:0,top:0}),u=w.useMemo(()=>{var f;return(f=a.current)===null||f===void 0?void 0:f.getBoundingClientRect()},[a.current]);return w.useEffect(()=>{c&&s?.(c)},[c]),w.useEffect(()=>{x({left:u?.left?u?.left:0,top:u?.top?u?.top:0})},[u]),w.useEffect(()=>{var f;if(r.boardWidth===void 0&&(!((f=a.current)===null||f===void 0)&&f.offsetWidth)){const p=new ResizeObserver(()=>{var m;l((m=a.current)===null||m===void 0?void 0:m.offsetWidth)});return p.observe(a.current),()=>{p.disconnect()}}},[a.current]),i.jsx(Po,{children:i.jsxs("div",Object.assign({ref:d,style:{display:"flex",flexDirection:"column",width:"100%"}},{children:[i.jsx("div",{ref:a,style:{width:"100%"}}),i.jsx(Go,Object.assign({customDndBackend:t,customDndBackendOptions:n},{children:c&&i.jsxs(hs,Object.assign({boardWidth:c},o,{ref:e},{children:[i.jsx(Vo,{boardContainer:h}),i.jsx(Io,{})]}))}))]}))})});function Yo(r){return r!==null?{comment:r,variations:[]}:{variations:[]}}function Xo(r,e,t,n,s){const o={move:r,variations:s};return e&&(o.suffix=e),t&&(o.nag=t),n!==null&&(o.comment=n),o}function Jo(...r){const[e,...t]=r;let n=e;for(const s of t)s!==null&&(n.variations=[s,...s.variations],s.variations=[],n=s);return e}function Zo(r,e){if(e.marker&&e.marker.comment){let t=e.root;for(;;){const n=t.variations[0];if(!n){t.comment=e.marker.comment;break}t=n}}return{headers:r,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function ea(r,e){function t(){this.constructor=r}t.prototype=e.prototype,r.prototype=new t}function et(r,e,t,n){var s=Error.call(this,r);return Object.setPrototypeOf&&Object.setPrototypeOf(s,et.prototype),s.expected=e,s.found=t,s.location=n,s.name="SyntaxError",s}ea(et,Error);function ir(r,e,t){return t=t||" ",r.length>e?r:(e-=r.length,t+=t.repeat(e),r+t.slice(0,e))}et.prototype.format=function(r){var e="Error: "+this.message;if(this.location){var t=null,n;for(n=0;n<r.length;n++)if(r[n].source===this.location.source){t=r[n].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,o=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,c=this.location.source+":"+o.line+":"+o.column;if(t){var l=this.location.end,a=ir("",o.line.toString().length," "),d=t[s.line-1],h=s.line===l.line?l.column:d.length+1,x=h-s.column||1;e+=`
 --> `+c+`
`+a+` |
`+o.line+" | "+d+`
`+a+" | "+ir("",s.column-1," ")+ir("",x,"^")}else e+=`
 at `+c}return e};et.buildMessage=function(r,e){var t={literal:function(d){return'"'+s(d.text)+'"'},class:function(d){var h=d.parts.map(function(x){return Array.isArray(x)?o(x[0])+"-"+o(x[1]):o(x)});return"["+(d.inverted?"^":"")+h.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(d){return d.description}};function n(d){return d.charCodeAt(0).toString(16).toUpperCase()}function s(d){return d.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+n(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+n(h)})}function o(d){return d.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(h){return"\\x0"+n(h)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(h){return"\\x"+n(h)})}function c(d){return t[d.type](d)}function l(d){var h=d.map(c),x,u;if(h.sort(),h.length>0){for(x=1,u=1;x<h.length;x++)h[x-1]!==h[x]&&(h[u]=h[x],u++);h.length=u}switch(h.length){case 1:return h[0];case 2:return h[0]+" or "+h[1];default:return h.slice(0,-1).join(", ")+", or "+h[h.length-1]}}function a(d){return d?'"'+s(d)+'"':"end of input"}return"Expected "+l(r)+" but "+a(e)+" found."};function ta(r,e){e=e!==void 0?e:{};var t={},n=e.grammarSource,s={pgn:Pr},o=Pr,c="[",l='"',a="]",d=".",h="O-O-O",x="O-O",u="0-0-0",f="0-0",p="$",m="{",C="}",S=";",O="(",j=")",T="1-0",D="0-1",E="1/2-1/2",H="*",V=/^[a-zA-Z]/,L=/^[^"]/,U=/^[0-9]/,se=/^[.]/,G=/^[a-zA-Z1-8\-=]/,k=/^[+#]/,R=/^[!?]/,A=/^[^}]/,z=/^[^\r\n]/,Q=/^[ \t\r\n]/,ce=fe("tag pair"),he=W("[",!1),ge=W('"',!1),J=W("]",!1),oe=fe("tag name"),Ce=ee([["a","z"],["A","Z"]],!1,!1),Se=fe("tag value"),Fe=ee(['"'],!0,!1),Ie=fe("move number"),F=ee([["0","9"]],!1,!1),ye=W(".",!1),_e=ee(["."],!1,!1),Le=fe("standard algebraic notation"),ae=W("O-O-O",!1),de=W("O-O",!1),We=W("0-0-0",!1),Mt=W("0-0",!1),Ue=ee([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),ke=ee(["+","#"],!1,!1),Rt=fe("suffix annotation"),ze=ee(["!","?"],!1,!1),At=fe("NAG"),pt=W("$",!1),$t=fe("brace comment"),tt=W("{",!1),rt=ee(["}"],!0,!1),nt=W("}",!1),we=fe("rest of line comment"),st=W(";",!1),Me=ee(["\r",`
`],!0,!1),Bt=fe("variation"),Ht=W("(",!1),Ft=W(")",!1),qe=fe("game termination marker"),Ke=W("1-0",!1),Ge=W("0-1",!1),Ve=W("1/2-1/2",!1),Wt=W("*",!1),Ut=fe("whitespace"),mt=ee([" ","	","\r",`
`],!1,!1),zt=function(g,b){return Zo(g,b)},it=function(g){return Object.fromEntries(g)},qt=function(g,b){return[g,b]},Kt=function(g,b){return{root:g,marker:b}},Gt=function(g,b){return Jo(Yo(g),...b.flat())},Vt=function(g,b,y,P,I){return Xo(g,b,y,P,I)},ot=function(g){return g},Qt=function(g){return g.replace(/[\r\n]+/g," ")},Qe=function(g){return g.trim()},at=function(g){return g},Yt=function(g,b){return{result:g,comment:b}},v=e.peg$currPos|0,Oe=[{line:1,column:1}],pe=v,q=e.peg$maxFailExpected||[],_=e.peg$silentFails|0,re;if(e.startRule){if(!(e.startRule in s))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');o=s[e.startRule]}function W(g,b){return{type:"literal",text:g,ignoreCase:b}}function ee(g,b,y){return{type:"class",parts:g,inverted:b,ignoreCase:y}}function me(){return{type:"end"}}function fe(g){return{type:"other",description:g}}function Er(g){var b=Oe[g],y;if(b)return b;if(g>=Oe.length)y=Oe.length-1;else for(y=g;!Oe[--y];);for(b=Oe[y],b={line:b.line,column:b.column};y<g;)r.charCodeAt(y)===10?(b.line++,b.column=1):b.column++,y++;return Oe[g]=b,b}function Nr(g,b,y){var P=Er(g),I=Er(b),K={source:n,start:{offset:g,line:P.line,column:P.column},end:{offset:b,line:I.line,column:I.column}};return K}function N(g){v<pe||(v>pe&&(pe=v,q=[]),q.push(g))}function $n(g,b,y){return new et(et.buildMessage(g,b),g,b,y)}function Pr(){var g,b,y;return g=v,b=Bn(),y=Wn(),g=zt(b,y),g}function Bn(){var g,b,y;for(g=v,b=[],y=Ir();y!==t;)b.push(y),y=Ir();return y=ue(),g=it(b),g}function Ir(){var g,b,y,P,I,K,Re;return _++,g=v,ue(),r.charCodeAt(v)===91?(b=c,v++):(b=t,_===0&&N(he)),b!==t?(ue(),y=Hn(),y!==t?(ue(),r.charCodeAt(v)===34?(P=l,v++):(P=t,_===0&&N(ge)),P!==t?(I=Fn(),r.charCodeAt(v)===34?(K=l,v++):(K=t,_===0&&N(ge)),K!==t?(ue(),r.charCodeAt(v)===93?(Re=a,v++):(Re=t,_===0&&N(J)),Re!==t?g=qt(y,I):(v=g,g=t)):(v=g,g=t)):(v=g,g=t)):(v=g,g=t)):(v=g,g=t),_--,g===t&&_===0&&N(ce),g}function Hn(){var g,b,y;if(_++,g=v,b=[],y=r.charAt(v),V.test(y)?v++:(y=t,_===0&&N(Ce)),y!==t)for(;y!==t;)b.push(y),y=r.charAt(v),V.test(y)?v++:(y=t,_===0&&N(Ce));else b=t;return b!==t?g=r.substring(g,v):g=b,_--,g===t&&(b=t,_===0&&N(oe)),g}function Fn(){var g,b,y;for(_++,g=v,b=[],y=r.charAt(v),L.test(y)?v++:(y=t,_===0&&N(Fe));y!==t;)b.push(y),y=r.charAt(v),L.test(y)?v++:(y=t,_===0&&N(Fe));return g=r.substring(g,v),_--,b=t,_===0&&N(Se),g}function Wn(){var g,b,y;return g=v,b=Lr(),ue(),y=Vn(),y===t&&(y=null),ue(),g=Kt(b,y),g}function Lr(){var g,b,y,P;for(g=v,b=Xt(),b===t&&(b=null),y=[],P=Mr();P!==t;)y.push(P),P=Mr();return g=Gt(b,y),g}function Mr(){var g,b,y,P,I,K,Re,vt;if(g=v,ue(),Un(),ue(),b=zn(),b!==t){for(y=qn(),y===t&&(y=null),P=[],I=Rr();I!==t;)P.push(I),I=Rr();for(I=ue(),K=Xt(),K===t&&(K=null),Re=[],vt=Ar();vt!==t;)Re.push(vt),vt=Ar();g=Vt(b,y,P,K,Re)}else v=g,g=t;return g}function Un(){var g,b,y,P,I,K;for(_++,g=v,b=[],y=r.charAt(v),U.test(y)?v++:(y=t,_===0&&N(F));y!==t;)b.push(y),y=r.charAt(v),U.test(y)?v++:(y=t,_===0&&N(F));if(r.charCodeAt(v)===46?(y=d,v++):(y=t,_===0&&N(ye)),y!==t){for(P=ue(),I=[],K=r.charAt(v),se.test(K)?v++:(K=t,_===0&&N(_e));K!==t;)I.push(K),K=r.charAt(v),se.test(K)?v++:(K=t,_===0&&N(_e));b=[b,y,P,I],g=b}else v=g,g=t;return _--,g===t&&(b=t,_===0&&N(Ie)),g}function zn(){var g,b,y,P,I,K;if(_++,g=v,b=v,r.substr(v,5)===h?(y=h,v+=5):(y=t,_===0&&N(ae)),y===t&&(r.substr(v,3)===x?(y=x,v+=3):(y=t,_===0&&N(de)),y===t&&(r.substr(v,5)===u?(y=u,v+=5):(y=t,_===0&&N(We)),y===t&&(r.substr(v,3)===f?(y=f,v+=3):(y=t,_===0&&N(Mt)),y===t))))if(y=v,P=r.charAt(v),V.test(P)?v++:(P=t,_===0&&N(Ce)),P!==t){if(I=[],K=r.charAt(v),G.test(K)?v++:(K=t,_===0&&N(Ue)),K!==t)for(;K!==t;)I.push(K),K=r.charAt(v),G.test(K)?v++:(K=t,_===0&&N(Ue));else I=t;I!==t?(P=[P,I],y=P):(v=y,y=t)}else v=y,y=t;return y!==t?(P=r.charAt(v),k.test(P)?v++:(P=t,_===0&&N(ke)),P===t&&(P=null),y=[y,P],b=y):(v=b,b=t),b!==t?g=r.substring(g,v):g=b,_--,g===t&&(b=t,_===0&&N(Le)),g}function qn(){var g,b,y;for(_++,g=v,b=[],y=r.charAt(v),R.test(y)?v++:(y=t,_===0&&N(ze));y!==t;)b.push(y),b.length>=2?y=t:(y=r.charAt(v),R.test(y)?v++:(y=t,_===0&&N(ze)));return b.length<1?(v=g,g=t):g=b,_--,g===t&&(b=t,_===0&&N(Rt)),g}function Rr(){var g,b,y,P,I;if(_++,g=v,ue(),r.charCodeAt(v)===36?(b=p,v++):(b=t,_===0&&N(pt)),b!==t){if(y=v,P=[],I=r.charAt(v),U.test(I)?v++:(I=t,_===0&&N(F)),I!==t)for(;I!==t;)P.push(I),I=r.charAt(v),U.test(I)?v++:(I=t,_===0&&N(F));else P=t;P!==t?y=r.substring(y,v):y=P,y!==t?g=ot(y):(v=g,g=t)}else v=g,g=t;return _--,g===t&&_===0&&N(At),g}function Xt(){var g;return g=Kn(),g===t&&(g=Gn()),g}function Kn(){var g,b,y,P,I;if(_++,g=v,r.charCodeAt(v)===123?(b=m,v++):(b=t,_===0&&N(tt)),b!==t){for(y=v,P=[],I=r.charAt(v),A.test(I)?v++:(I=t,_===0&&N(rt));I!==t;)P.push(I),I=r.charAt(v),A.test(I)?v++:(I=t,_===0&&N(rt));y=r.substring(y,v),r.charCodeAt(v)===125?(P=C,v++):(P=t,_===0&&N(nt)),P!==t?g=Qt(y):(v=g,g=t)}else v=g,g=t;return _--,g===t&&(b=t,_===0&&N($t)),g}function Gn(){var g,b,y,P,I;if(_++,g=v,r.charCodeAt(v)===59?(b=S,v++):(b=t,_===0&&N(st)),b!==t){for(y=v,P=[],I=r.charAt(v),z.test(I)?v++:(I=t,_===0&&N(Me));I!==t;)P.push(I),I=r.charAt(v),z.test(I)?v++:(I=t,_===0&&N(Me));y=r.substring(y,v),g=Qe(y)}else v=g,g=t;return _--,g===t&&(b=t,_===0&&N(we)),g}function Ar(){var g,b,y,P;return _++,g=v,ue(),r.charCodeAt(v)===40?(b=O,v++):(b=t,_===0&&N(Ht)),b!==t?(y=Lr(),y!==t?(ue(),r.charCodeAt(v)===41?(P=j,v++):(P=t,_===0&&N(Ft)),P!==t?g=at(y):(v=g,g=t)):(v=g,g=t)):(v=g,g=t),_--,g===t&&_===0&&N(Bt),g}function Vn(){var g,b,y;return _++,g=v,r.substr(v,3)===T?(b=T,v+=3):(b=t,_===0&&N(Ke)),b===t&&(r.substr(v,3)===D?(b=D,v+=3):(b=t,_===0&&N(Ge)),b===t&&(r.substr(v,7)===E?(b=E,v+=7):(b=t,_===0&&N(Ve)),b===t&&(r.charCodeAt(v)===42?(b=H,v++):(b=t,_===0&&N(Wt))))),b!==t?(ue(),y=Xt(),y===t&&(y=null),g=Yt(b,y)):(v=g,g=t),_--,g===t&&(b=t,_===0&&N(qe)),g}function ue(){var g,b;for(_++,g=[],b=r.charAt(v),Q.test(b)?v++:(b=t,_===0&&N(mt));b!==t;)g.push(b),b=r.charAt(v),Q.test(b)?v++:(b=t,_===0&&N(mt));return _--,b=t,_===0&&N(Ut),g}if(re=o(),e.peg$library)return{peg$result:re,peg$currPos:v,peg$FAILED:t,peg$maxFailExpected:q,peg$maxFailPos:pe};if(re!==t&&v===r.length)return re;throw re!==t&&v<r.length&&N(me()),$n(q,pe<r.length?r.charAt(pe):null,pe<r.length?Nr(pe,pe+1):Nr(pe,pe))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const kt=0xffffffffffffffffn;function or(r,e){return(r<<e|r>>64n-e)&0xffffffffffffffffn}function ln(r,e){return r*e&kt}function ra(r){return function(){let e=BigInt(r&kt),t=BigInt(r>>64n&kt);const n=ln(or(ln(e,5n),7n),9n);return t^=e,e=(or(e,24n)^t^t<<16n)&kt,t=or(t,37n),r=t<<64n|e,n}}const Lt=ra(0xa187eb39cdcaed8f31c4b365b102e01en),na=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>Lt()))),sa=Array.from({length:8},()=>Lt()),ia=Array.from({length:16},()=>Lt()),ar=Lt(),le="w",ve="b",Z="p",yr="n",Ot="b",ut="r",Ne="q",te="k",lr="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class yt{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,t){const{color:n,piece:s,from:o,to:c,flags:l,captured:a,promotion:d}=t,h=ne(o),x=ne(c);this.color=n,this.piece=s,this.from=h,this.to=x,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=h+x,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="";for(const u in $)$[u]&l&&(this.flags+=Ae[u]);a&&(this.captured=a),d&&(this.promotion=d,this.lan+=d)}isCapture(){return this.flags.indexOf(Ae.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Ae.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Ae.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Ae.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Ae.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Ae.BIG_PAWN)>-1}}const ie=-1,Ae={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},$={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},wr={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},oa={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},aa={...wr,...oa},M={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},cr={b:[16,32,17,15],w:[-16,-32,-17,-15]},cn={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},la=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],ca=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],ua={p:1,n:2,b:4,r:8,q:16,k:32},da="pnbrqkPNBRQK",un=[yr,Ot,ut,Ne],fa=7,ha=6,ga=1,pa=0,wt={[te]:$.KSIDE_CASTLE,[Ne]:$.QSIDE_CASTLE},Te={w:[{square:M.a1,flag:$.QSIDE_CASTLE},{square:M.h1,flag:$.KSIDE_CASTLE}],b:[{square:M.a8,flag:$.QSIDE_CASTLE},{square:M.h8,flag:$.KSIDE_CASTLE}]},ma={b:ga,w:ha},ur="--";function $e(r){return r>>4}function gt(r){return r&15}function An(r){return"0123456789".indexOf(r)!==-1}function ne(r){const e=gt(r),t=$e(r);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function ct(r){return r===le?ve:le}function va(r){const e=r.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const n=parseInt(e[4],10);if(isNaN(n)||n<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const s=e[0].split("/");if(s.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let c=0;c<s.length;c++){let l=0,a=!1;for(let d=0;d<s[c].length;d++)if(An(s[c][d])){if(a)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(s[c][d],10),a=!0}else{if(!/^[prnbqkPRNBQK]$/.test(s[c][d]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,a=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const o=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:c,regex:l}of o){if(!l.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${c} king`};if((e[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${c} kings`}}return Array.from(s[0]+s[7]).some(c=>c.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function xa(r,e){const t=r.from,n=r.to,s=r.piece;let o=0,c=0,l=0;for(let a=0,d=e.length;a<d;a++){const h=e[a].from,x=e[a].to,u=e[a].piece;s===u&&t!==h&&n===x&&(o++,$e(t)===$e(h)&&c++,gt(t)===gt(h)&&l++)}return o>0?c>0&&l>0?ne(t):l>0?ne(t).charAt(1):ne(t).charAt(0):""}function De(r,e,t,n,s,o=void 0,c=$.NORMAL){const l=$e(n);if(s===Z&&(l===fa||l===pa))for(let a=0;a<un.length;a++){const d=un[a];r.push({color:e,from:t,to:n,piece:s,captured:o,promotion:d,flags:c|$.PROMOTION})}else r.push({color:e,from:t,to:n,piece:s,captured:o,flags:c})}function dn(r){let e=r.charAt(0);return e>="a"&&e<="h"?r.match(/[a-h]\d.*[a-h]\d/)?void 0:Z:(e=e.toLowerCase(),e==="o"?te:e)}function dr(r){return r.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class ba{_board=new Array(128);_turn=le;_header={};_kings={w:ie,b:ie};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(e=lr,{skipValidation:t=!1}={}){this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:ie,b:ie},this._turn=le,this._castling={w:0,b:0},this._epSquare=ie,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...aa},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:n=!1}={}){let s=e.split(/\s+/);if(s.length>=2&&s.length<6){const l=["-","-","0","1"];e=s.concat(l.slice(-(6-s.length))).join(" ")}if(s=e.split(/\s+/),!t){const{ok:l,error:a}=va(e);if(!l)throw new Error(a)}const o=s[0];let c=0;this.clear({preserveHeaders:n});for(let l=0;l<o.length;l++){const a=o.charAt(l);if(a==="/")c+=8;else if(An(a))c+=parseInt(a,10);else{const d=a<"a"?le:ve;this._put({type:a.toLowerCase(),color:d},ne(c)),c++}}this._turn=s[1],s[2].indexOf("K")>-1&&(this._castling.w|=$.KSIDE_CASTLE),s[2].indexOf("Q")>-1&&(this._castling.w|=$.QSIDE_CASTLE),s[2].indexOf("k")>-1&&(this._castling.b|=$.KSIDE_CASTLE),s[2].indexOf("q")>-1&&(this._castling.b|=$.QSIDE_CASTLE),this._epSquare=s[3]==="-"?ie:M[s[3]],this._halfMoves=parseInt(s[4],10),this._moveNumber=parseInt(s[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){let t=0,n="";for(let c=M.a8;c<=M.h1;c++){if(this._board[c]){t>0&&(n+=t,t=0);const{color:l,type:a}=this._board[c];n+=l===le?a.toUpperCase():a.toLowerCase()}else t++;c+1&136&&(t>0&&(n+=t),c!==M.h1&&(n+="/"),t=0,c+=8)}let s="";this._castling[le]&$.KSIDE_CASTLE&&(s+="K"),this._castling[le]&$.QSIDE_CASTLE&&(s+="Q"),this._castling[ve]&$.KSIDE_CASTLE&&(s+="k"),this._castling[ve]&$.QSIDE_CASTLE&&(s+="q"),s=s||"-";let o="-";if(this._epSquare!==ie)if(e)o=ne(this._epSquare);else{const c=this._epSquare+(this._turn===le?16:-16),l=[c+1,c-1];for(const a of l){if(a&136)continue;const d=this._turn;if(this._board[a]?.color===d&&this._board[a]?.type===Z){this._makeMove({color:d,from:a,to:this._epSquare,piece:Z,captured:Z,flags:$.EP_CAPTURE});const h=!this._isKingAttacked(d);if(this._undoMove(),h){o=ne(this._epSquare);break}}}}return[n,this._turn,s,o,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:t,type:n}=this._board[e],s={w:0,b:1}[t],o={p:0,n:1,b:2,r:3,q:4,k:5}[n];return na[s][o][e]}_epKey(){return this._epSquare===ie?0n:sa[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return ia[e]}_computeHash(){let e=0n;for(let t=M.a8;t<=M.h1;t++){if(t&136){t+=7;continue}this._board[t]&&(e^=this._pieceKey(t))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=ar),e}_updateSetup(e){this._history.length>0||(e!==lr?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(lr)}get(e){return this._board[M[e]]}findPiece(e){const t=[];for(let n=M.a8;n<=M.h1;n++){if(n&136){n+=7;continue}!this._board[n]||this._board[n]?.color!==e.color||this._board[n].color===e.color&&this._board[n].type===e.type&&t.push(ne(n))}return t}put({type:e,color:t},n){return this._put({type:e,color:t},n)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,t){this._hash^=this._pieceKey(e),this._board[e]=t,this._hash^=this._pieceKey(e)}_put({type:e,color:t},n){if(da.indexOf(e.toLowerCase())===-1||!(n in M))return!1;const s=M[n];if(e==te&&!(this._kings[t]==ie||this._kings[t]==s))return!1;const o=this._board[s];return o&&o.type===te&&(this._kings[o.color]=ie),this._set(s,{type:e,color:t}),e===te&&(this._kings[t]=s),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const t=this.get(e);return this._clear(M[e]),t&&t.type===te&&(this._kings[t.color]=ie),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){this._hash^=this._castlingKey();const e=this._board[M.e1]?.type===te&&this._board[M.e1]?.color===le,t=this._board[M.e8]?.type===te&&this._board[M.e8]?.color===ve;(!e||this._board[M.a1]?.type!==ut||this._board[M.a1]?.color!==le)&&(this._castling.w&=-65),(!e||this._board[M.h1]?.type!==ut||this._board[M.h1]?.color!==le)&&(this._castling.w&=-33),(!t||this._board[M.a8]?.type!==ut||this._board[M.a8]?.color!==ve)&&(this._castling.b&=-65),(!t||this._board[M.h8]?.type!==ut||this._board[M.h8]?.color!==ve)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===ie)return;const e=this._epSquare+(this._turn===le?-16:16),t=this._epSquare+(this._turn===le?16:-16),n=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||this._board[t]?.color!==ct(this._turn)||this._board[t]?.type!==Z){this._hash^=this._epKey(),this._epSquare=ie;return}const s=o=>!(o&136)&&this._board[o]?.color===this._turn&&this._board[o]?.type===Z;n.some(s)||(this._hash^=this._epKey(),this._epSquare=ie)}_attacked(e,t,n){const s=[];for(let o=M.a8;o<=M.h1;o++){if(o&136){o+=7;continue}if(this._board[o]===void 0||this._board[o].color!==e)continue;const c=this._board[o],l=o-t;if(l===0)continue;const a=l+119;if(la[a]&ua[c.type]){if(c.type===Z){if(l>0&&c.color===le||l<=0&&c.color===ve)if(n)s.push(ne(o));else return!0;continue}if(c.type==="n"||c.type==="k")if(n){s.push(ne(o));continue}else return!0;const d=ca[a];let h=o+d,x=!1;for(;h!==t;){if(this._board[h]!=null){x=!0;break}h+=d}if(!x)if(n){s.push(ne(o));continue}else return!0}}return n?s:!1}attackers(e,t){return t?this._attacked(t,M[e],!0):this._attacked(this._turn,M[e],!0)}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(ct(e),t)}hash(){return this._hash.toString(16)}isAttacked(e,t){return this._attacked(t,M[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let n=0,s=0;for(let o=M.a8;o<=M.h1;o++){if(s=(s+1)%2,o&136){o+=7;continue}const c=this._board[o];c&&(e[c.type]=c.type in e?e[c.type]+1:1,c.type===Ot&&t.push(s),n++)}if(n===2)return!0;if(n===3&&(e[Ot]===1||e[yr]===1))return!0;if(n===e[Ot]+2){let o=0;const c=t.length;for(let l=0;l<c;l++)o+=t[l];if(o===0||o===c)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:n=void 0}={}){const s=this._moves({square:t,piece:n});return e?s.map(o=>new yt(this,o)):s.map(o=>this._moveToSan(o,s))}_moves({legal:e=!0,piece:t=void 0,square:n=void 0}={}){const s=n?n.toLowerCase():void 0,o=t?.toLowerCase(),c=[],l=this._turn,a=ct(l);let d=M.a8,h=M.h1,x=!1;if(s)if(s in M)d=h=M[s],x=!0;else return[];for(let f=d;f<=h;f++){if(f&136){f+=7;continue}if(!this._board[f]||this._board[f].color===a)continue;const{type:p}=this._board[f];let m;if(p===Z){if(o&&o!==p)continue;m=f+cr[l][0],this._board[m]||(De(c,l,f,m,Z),m=f+cr[l][1],ma[l]===$e(f)&&!this._board[m]&&De(c,l,f,m,Z,void 0,$.BIG_PAWN));for(let C=2;C<4;C++)m=f+cr[l][C],!(m&136)&&(this._board[m]?.color===a?De(c,l,f,m,Z,this._board[m].type,$.CAPTURE):m===this._epSquare&&De(c,l,f,m,Z,Z,$.EP_CAPTURE))}else{if(o&&o!==p)continue;for(let C=0,S=cn[p].length;C<S;C++){const O=cn[p][C];for(m=f;m+=O,!(m&136);){if(!this._board[m])De(c,l,f,m,p);else{if(this._board[m].color===l)break;De(c,l,f,m,p,this._board[m].type,$.CAPTURE);break}if(p===yr||p===te)break}}}}if((o===void 0||o===te)&&(!x||h===this._kings[l])){if(this._castling[l]&$.KSIDE_CASTLE){const f=this._kings[l],p=f+2;!this._board[f+1]&&!this._board[p]&&!this._attacked(a,this._kings[l])&&!this._attacked(a,f+1)&&!this._attacked(a,p)&&De(c,l,this._kings[l],p,te,void 0,$.KSIDE_CASTLE)}if(this._castling[l]&$.QSIDE_CASTLE){const f=this._kings[l],p=f-2;!this._board[f-1]&&!this._board[f-2]&&!this._board[f-3]&&!this._attacked(a,this._kings[l])&&!this._attacked(a,f-1)&&!this._attacked(a,p)&&De(c,l,this._kings[l],p,te,void 0,$.QSIDE_CASTLE)}}if(!e||this._kings[l]===-1)return c;const u=[];for(let f=0,p=c.length;f<p;f++)this._makeMove(c[f]),this._isKingAttacked(l)||u.push(c[f]),this._undoMove();return u}move(e,{strict:t=!1}={}){let n=null;if(typeof e=="string")n=this._moveFromSan(e,t);else if(e===null)n=this._moveFromSan(ur,t);else if(typeof e=="object"){const o=this._moves();for(let c=0,l=o.length;c<l;c++)if(e.from===ne(o[c].from)&&e.to===ne(o[c].to)&&(!("promotion"in o[c])||e.promotion===o[c].promotion)){n=o[c];break}}if(!n)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&n.flags&$.NULL_MOVE)throw new Error("Null move not allowed when in check");const s=new yt(this,n);return this._makeMove(n),this._incPositionCount(),s}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,t){this._hash^=this._pieceKey(e),this._board[t]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(t)}_makeMove(e){const t=this._turn,n=ct(t);if(this._push(e),e.flags&$.NULL_MOVE){t===ve&&this._moveNumber++,this._halfMoves++,this._turn=n,this._epSquare=ie;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&$.EP_CAPTURE&&(this._turn===ve?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:t})),this._board[e.to].type===te){if(this._kings[t]=e.to,e.flags&$.KSIDE_CASTLE){const s=e.to-1,o=e.to+1;this._movePiece(o,s)}else if(e.flags&$.QSIDE_CASTLE){const s=e.to+1,o=e.to-2;this._movePiece(o,s)}this._castling[t]=0}if(this._castling[t]){for(let s=0,o=Te[t].length;s<o;s++)if(e.from===Te[t][s].square&&this._castling[t]&Te[t][s].flag){this._castling[t]^=Te[t][s].flag;break}}if(this._castling[n]){for(let s=0,o=Te[n].length;s<o;s++)if(e.to===Te[n][s].square&&this._castling[n]&Te[n][s].flag){this._castling[n]^=Te[n][s].flag;break}}if(this._hash^=this._castlingKey(),e.flags&$.BIG_PAWN){let s;t===ve?s=e.to-16:s=e.to+16,!(e.to-1&136)&&this._board[e.to-1]?.type===Z&&this._board[e.to-1]?.color===n||!(e.to+1&136)&&this._board[e.to+1]?.type===Z&&this._board[e.to+1]?.color===n?(this._epSquare=s,this._hash^=this._epKey()):this._epSquare=ie}else this._epSquare=ie;e.piece===Z?this._halfMoves=0:e.flags&($.CAPTURE|$.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===ve&&this._moveNumber++,this._turn=n,this._hash^=ar}undo(){const e=this._hash,t=this._undoMove();if(t){const n=new yt(this,t);return this._decPositionCount(e),n}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=ar;const n=this._turn,s=ct(n);if(t.flags&$.NULL_MOVE)return t;if(this._movePiece(t.to,t.from),t.piece&&(this._clear(t.from),this._set(t.from,{type:t.piece,color:n})),t.captured)if(t.flags&$.EP_CAPTURE){let o;n===ve?o=t.to-16:o=t.to+16,this._set(o,{type:Z,color:s})}else this._set(t.to,{type:t.captured,color:s});if(t.flags&($.KSIDE_CASTLE|$.QSIDE_CASTLE)){let o,c;t.flags&$.KSIDE_CASTLE?(o=t.to+1,c=t.to-1):(o=t.to-2,c=t.to+1),this._movePiece(c,o)}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const n=[];let s=!1;for(const u in this._header)this._header[u]&&n.push(`[${u} "${this._header[u]}"]`+e),s=!0;s&&this._history.length&&n.push(e);const o=u=>{const f=this._comments[this.fen()];if(typeof f<"u"){const p=u.length>0?" ":"";u=`${u}${p}{${f}}`}return u},c=[];for(;this._history.length>0;)c.push(this._undoMove());const l=[];let a="";for(c.length===0&&l.push(o(""));c.length>0;){a=o(a);const u=c.pop();if(!u)break;if(!this._history.length&&u.color==="b"){const f=`${this._moveNumber}. ...`;a=a?`${a} ${f}`:f}else u.color==="w"&&(a.length&&l.push(a),a=this._moveNumber+".");a=a+" "+this._moveToSan(u,this._moves({legal:!0})),this._makeMove(u)}if(a.length&&l.push(o(a)),l.push(this._header.Result||"*"),t===0)return n.join("")+l.join(" ");const d=function(){return n.length>0&&n[n.length-1]===" "?(n.pop(),!0):!1},h=function(u,f){for(const p of f.split(" "))if(p){if(u+p.length>t){for(;d();)u--;n.push(e),u=0}n.push(p),u+=p.length,n.push(" "),u++}return d()&&u--,u};let x=0;for(let u=0;u<l.length;u++){if(x+l[u].length>t&&l[u].includes("{")){x=h(x,l[u]);continue}x+l[u].length>t&&u!==0?(n[n.length-1]===" "&&n.pop(),n.push(e),x=0):u!==0&&(n.push(" "),x++),n.push(l[u]),x+=l[u].length}return n.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??wr[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=wr[e]||null,!0):!1}getHeaders(){const e={};for(const[t,n]of Object.entries(this._header))n!==null&&(e[t]=n);return e}loadPgn(e,{strict:t=!1,newlineChar:n=`\r?
`}={}){n!==`\r?
`&&(e=e.replace(new RegExp(n,"g"),`
`));const s=ta(e);this.reset();const o=s.headers;let c="";for(const d in o)d.toLowerCase()==="fen"&&(c=o[d]),this.header(d,o[d]);if(!t)c&&this.load(c,{preserveHeaders:!0});else if(o.SetUp==="1"){if(!("FEN"in o))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(o.FEN,{preserveHeaders:!0})}let l=s.root;for(;l;){if(l.move){const d=this._moveFromSan(l.move,t);if(d==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(d),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const a=s.result;a&&Object.keys(this._header).length&&this._header.Result!==a&&this.setHeader("Result",a)}_moveToSan(e,t){let n="";if(e.flags&$.KSIDE_CASTLE)n="O-O";else if(e.flags&$.QSIDE_CASTLE)n="O-O-O";else{if(e.flags&$.NULL_MOVE)return ur;if(e.piece!==Z){const s=xa(e,t);n+=e.piece.toUpperCase()+s}e.flags&($.CAPTURE|$.EP_CAPTURE)&&(e.piece===Z&&(n+=ne(e.from)[0]),n+="x"),n+=ne(e.to),e.promotion&&(n+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?n+="#":n+="+"),this._undoMove(),n}_moveFromSan(e,t=!1){let n=dr(e);if(t||(n==="0-0"?n="O-O":n==="0-0-0"&&(n="O-O-O")),n==ur)return{color:this._turn,from:0,to:0,piece:"k",flags:$.NULL_MOVE};let s=dn(n),o=this._moves({legal:!0,piece:s});for(let u=0,f=o.length;u<f;u++)if(n===dr(this._moveToSan(o[u],o)))return o[u];if(t)return null;let c,l,a,d,h,x=!1;if(l=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(c=l[1],a=l[2],d=l[3],h=l[4],a.length==1&&(x=!0)):(l=n.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(c=l[1],a=l[2],d=l[3],h=l[4],a.length==1&&(x=!0))),s=dn(n),o=this._moves({legal:!0,piece:c||s}),!d)return null;for(let u=0,f=o.length;u<f;u++)if(a){if((!c||c.toLowerCase()==o[u].piece)&&M[a]==o[u].from&&M[d]==o[u].to&&(!h||h.toLowerCase()==o[u].promotion))return o[u];if(x){const p=ne(o[u].from);if((!c||c.toLowerCase()==o[u].piece)&&M[d]==o[u].to&&(a==p[0]||a==p[1])&&(!h||h.toLowerCase()==o[u].promotion))return o[u]}}else if(n===dr(this._moveToSan(o[u],o)).replace("x",""))return o[u];return null}ascii(){let e=`   +------------------------+
`;for(let t=M.a8;t<=M.h1;t++){if(gt(t)===0&&(e+=" "+"87654321"[$e(t)]+" |"),this._board[t]){const n=this._board[t].type,o=this._board[t].color===le?n.toUpperCase():n.toLowerCase();e+=" "+o+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let n=0;const s=this._turn;for(let o=0,c=t.length;o<c;o++)this._makeMove(t[o]),this._isKingAttacked(s)||(e-1>0?n+=this.perft(e-1):n++),this._undoMove();return n}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let t=[];for(let n=M.a8;n<=M.h1;n++)this._board[n]==null?t.push(null):t.push({square:ne(n),type:this._board[n].type,color:this._board[n].color}),n+1&136&&(e.push(t),t=[],n+=8);return e}squareColor(e){if(e in M){const t=M[e];return($e(t)+gt(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],n=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const s=t.pop();if(!s)break;e?n.push(new yt(this,s)):n.push(this._moveToSan(s,this._moves())),this._makeMove(s)}return n}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const t=this._positionCount.get(e)??0;t===1?this._positionCount.delete(e):this._positionCount.set(e,t-1)}_pruneComments(){const e=[],t={},n=s=>{s in this._comments&&(t[s]=this._comments[s])};for(;this._history.length>0;)e.push(this._undoMove());for(n(this.fen());;){const s=e.pop();if(!s)break;this._makeMove(s),n(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const s of[te,Ne])t[s]!==void 0&&(t[s]?this._castling[e]|=wt[s]:this._castling[e]&=~wt[s]);this._updateCastlingRights();const n=this.getCastlingRights(e);return(t[te]===void 0||t[te]===n[te])&&(t[Ne]===void 0||t[Ne]===n[Ne])}getCastlingRights(e){return{[te]:(this._castling[e]&wt[te])!==0,[Ne]:(this._castling[e]&wt[Ne])!==0}}moveNumber(){return this._moveNumber}}const ya=(r,e,t,n,s,o,c,l)=>{const a=w.useRef(null);w.useEffect(()=>{if(!e||s||!o||!r||!e.players||e.players.length<2||!e.players.some(C=>C.isBot))return;const m=t.turn()==="w"&&e.players[0]?.isBot||t.turn()==="b"&&e.players[1]?.isBot;if(e.creatorId===o)return m&&!s&&(async()=>{const S=Math.floor(Math.random()*500)+500;a.current&&clearTimeout(a.current),a.current=setTimeout(async()=>{await d()},S)})(),()=>{a.current&&clearTimeout(a.current)}},[t.fen(),e?.id,s,o]);const d=async()=>{const p=h(t,2);if(p)try{const m=t.move(p);if(m){const C=t.fen();if(n(C),r){const S=Xe(Je,"matches",r);await Ze(S,{"gameState.fen":C,"gameState.lastMove":{from:m.from,to:m.to,san:m.san},"gameState.whiteTimeRemaining":c,"gameState.blackTimeRemaining":l,"gameState.updatedAt":new Date().toISOString()})}}}catch(m){console.error("Bot move error",m)}},h=(p,m)=>{const C=p.moves({verbose:!0});if(C.length===0)return null;let S=null,O=-1/0;for(const j of C){p.move(j);const T=x(p,m-1,-1/0,1/0,!1);p.undo(),(T>O||T===O&&Math.random()>.5)&&(O=T,S=j)}return S||C[Math.floor(Math.random()*C.length)]},x=(p,m,C,S,O)=>{if(m===0||p.game_over())return-u(p.board());const j=p.moves();if(O){let T=-1/0;for(const D of j){p.move(D);const E=x(p,m-1,C,S,!1);if(p.undo(),T=Math.max(T,E),C=Math.max(C,E),S<=C)break}return T}else{let T=1/0;for(const D of j){p.move(D);const E=x(p,m-1,C,S,!0);if(p.undo(),T=Math.min(T,E),S=Math.min(S,E),S<=C)break}return T}},u=p=>{let m=0;for(let C=0;C<8;C++)for(let S=0;S<8;S++)m+=f(p[C][S]);return m},f=p=>{if(p===null)return 0;const C=(S=>S.type==="p"?10:S.type==="r"?50:S.type==="n"||S.type==="b"?30:S.type==="q"?90:S.type==="k"?900:0)(p);return p.color==="w"?C:-C}};class wa extends Xn.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Game Crash:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?i.jsxs("div",{className:"min-h-screen bg-[var(--bg-primary)] flex flex-col items-center justify-center p-4 text-[var(--accent)] font-bold",children:[i.jsx("span",{className:"text-4xl mb-4",children:""}),i.jsx("p",{className:"text-xl mb-4",children:"Game Error"}),i.jsxs("p",{className:"text-sm text-[var(--text-secondary)] font-mono bg-black/20 p-4 rounded max-w-lg break-all",children:[this.state.error?.toString()||"Unknown Error",i.jsx("br",{}),this.state.errorInfo?.componentStack?.slice(0,200),"..."]}),i.jsx("button",{onClick:()=>window.location.reload(),className:"mt-8 px-6 py-2 bg-[var(--accent)] text-black rounded-lg hover:opacity-90",children:"Refresh Page"}),i.jsx("button",{onClick:()=>window.location.href="/play",className:"mt-4 text-sm text-[var(--text-secondary)] hover:text-white",children:"Back to Hub"})]}):this.props.children}}const Ca=()=>{const{id:r}=Cr(),{user:e}=hn(),t=Sr(),[n,s]=w.useState(null);w.useEffect(()=>{if(e)s(e.id);else{const L=localStorage.getItem("guest_identity");L&&s(JSON.parse(L).id)}},[e]);const[o,c]=w.useState(null),[l]=w.useState(new ba),[a,d]=w.useState(l.fen()),[h,x]=w.useState(!1),[u,f]=w.useState(null),[p,m]=w.useState(null),[C,S]=w.useState(600),[O,j]=w.useState(600),T=w.useRef(null);w.useRef(null),w.useEffect(()=>{o&&console.log("Match State:",o),a&&console.log("Current FEN:",a)},[o,a]),w.useEffect(()=>{if(e){Zn.getWallet(e.id).then(m);const L=U=>{m(U.detail)};return window.addEventListener("walletUpdate",L),()=>window.removeEventListener("walletUpdate",L)}},[e]),w.useEffect(()=>{if(!r)return;const L=X.listenToMatch(r,U=>{if(U){if(c(U),U.gameState?.fen){const se=l.fen();if(U.gameState.fen!==se)try{l.load(U.gameState.fen),d(l.fen())}catch{console.error("Invalid FEN from server:",U.gameState.fen)}}U.gameState?.whiteTimeRemaining!==void 0&&S(U.gameState.whiteTimeRemaining),U.gameState?.blackTimeRemaining!==void 0&&j(U.gameState.blackTimeRemaining),U.status==="completed"&&(x(!0),f(U.winnerName||null))}});return()=>L()},[r]),w.useEffect(()=>{o?.timeControl&&!o.gameState?.whiteTimeRemaining&&(S(o.timeControl),j(o.timeControl))},[o?.id]),w.useEffect(()=>{if(!o||h){T.current&&clearInterval(T.current);return}if(T.current&&clearInterval(T.current),!(o.status!=="locked"&&o.status!=="in_progress")&&!(!o.players||o.players.length<2))return T.current=setInterval(()=>{l.turn()==="w"?S(L=>L<=0?(D("black"),0):L-1):j(L=>L<=0?(D("white"),0):L-1)},1e3),()=>{T.current&&clearInterval(T.current)}},[o,h,l.turn()]);const D=async L=>{if(!o||!r)return;x(!0);const U=L==="white"?0:1,se=o.players[U].userId,G=o.players[U].userName;f(G);const k=Xe(Je,"matches",r);await Ze(k,{status:"completed",winnerId:se,winnerName:G,completedAt:new Date().toISOString()}),Ee.error(`Time's up! ${G} wins!`)},E=L=>{const U=Math.floor(L/60),se=L%60;return`${U}:${se.toString().padStart(2,"0")}`};ya(r,o,l,d,h,n,C,O);const[H,V]=w.useState(null);return w.useEffect(()=>{const L=setTimeout(()=>{o||V("Failed to load match. Please check your connection.")},1e4);return()=>clearTimeout(L)},[o]),H?i.jsxs("div",{className:"min-h-screen bg-[var(--bg-primary)] flex flex-col items-center justify-center p-4 text-center",children:[i.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-full mb-4",children:i.jsx("span",{className:"text-3xl",children:""})}),i.jsx("h2",{className:"text-2xl font-black mb-2",children:"Something went wrong"}),i.jsx("p",{className:"text-[var(--text-secondary)] mb-6",children:H}),i.jsx("button",{onClick:()=>t("/play"),className:"px-6 py-3 bg-[var(--accent)] text-[var(--bg-primary)] font-bold rounded-xl hover:opacity-90 transition-all",children:"Back to Hub"})]}):o?i.jsxs("div",{className:"min-h-screen bg-[var(--bg-primary)] text-[var(--text-primary)] pb-24 lg:pb-8 relative",children:[p&&i.jsxs("div",{className:"absolute top-4 right-4 lg:right-8 z-50 flex items-center gap-2 px-4 py-2 bg-[var(--glass)]/90 backdrop-blur-md border border-[var(--accent)]/30 rounded-full shadow-[0_0_15px_rgba(0,255,194,0.1)]",children:[i.jsx(Yn,{className:"w-4 h-4 text-[var(--accent)]"}),i.jsx("span",{className:"font-bold font-mono text-sm",children:Jn(p.espoCoins)}),i.jsxs("span",{className:"text-xs text-[var(--text-secondary)] border-l border-[var(--border)] pl-2",children:["(",(p.espoCoins/2.5).toFixed(0),")"]})]}),i.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[i.jsxs("button",{onClick:()=>t("/play"),className:"flex items-center gap-2 text-[var(--text-secondary)] hover:text-[var(--text-primary)] mb-4",children:[i.jsx(gn,{className:"w-5 h-5"}),"Back to Play"]}),i.jsxs("div",{className:"flex flex-col lg:flex-row gap-8 items-start",children:[i.jsx("div",{className:"w-full lg:w-2/3",children:i.jsxs("div",{className:"bg-[var(--glass)] p-4 rounded-2xl border border-[var(--border)] relative",children:[i.jsx("div",{className:"flex justify-between items-center mb-4 px-2",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center text-xs font-bold border border-red-500/30",children:o.players.find(L=>L.userId!==n)?.userName?.charAt(0)||"?"}),i.jsxs("span",{className:"font-bold text-sm",children:[o.players.find(L=>L.userId!==n)?.userName||"Opponent",o.players.find(L=>L.userId!==n)?.isBot&&i.jsx("span",{className:"ml-2 text-xs bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded",children:"BOT"})]})]})}),i.jsx(Qo,{position:a||"start",onPieceDrop:makeMove,boardWidth:600,customBoardStyle:{borderRadius:"8px"}}),i.jsx("div",{className:"flex justify-between items-center mt-4 px-2",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-[var(--accent)]/20 flex items-center justify-center text-xs font-bold border border-[var(--accent)]/30",children:e?.firstName?.charAt(0)||"U"}),i.jsx("span",{className:"font-bold text-sm",children:"You"})]})})]})}),i.jsxs("div",{className:"w-full lg:w-1/3 space-y-4",children:[i.jsxs("div",{className:"p-6 bg-[var(--glass)] rounded-xl border border-[var(--border)]",children:[i.jsx("h2",{className:"text-xl font-black mb-4",children:"Match Info"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-1",children:"Game"}),i.jsx("p",{className:"font-bold",children:"Chess"})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-1",children:"Mode"}),i.jsx("p",{className:"font-bold",children:o.mode==="free"?"Free Play":`Paid (${o.entryFee} EC entry)`})]}),i.jsxs("div",{children:[i.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-1",children:"Players"}),Array.isArray(o.players)&&o.players.map(L=>i.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[i.jsx("div",{className:"w-6 h-6 rounded-full bg-gradient-to-br from-[var(--accent)] to-purple-500 flex items-center justify-center text-xs font-bold",children:L.userName?L.userName.charAt(0):"?"}),i.jsx("p",{className:"text-sm",children:L.userName||"Unknown"}),L.userId===n&&i.jsx("span",{className:"text-xs text-[var(--accent)]",children:"(You)"}),L.isBot&&i.jsx("span",{className:"text-xs bg-blue-500/20 text-blue-400 px-1.5 py-0.5 rounded",children:"BOT"})]},L.userId))]}),h&&u&&i.jsxs("div",{className:"mt-6 p-4 bg-[var(--accent)]/10 border border-[var(--accent)]/30 rounded-lg",children:[i.jsxs("p",{className:"text-center font-black text-[var(--accent)] text-lg",children:[" ",u," Wins!"]}),o.mode==="paid"&&i.jsxs("p",{className:"text-center text-sm text-[var(--text-secondary)] mt-2",children:["Prize: ",o.winnerPrize," EC"]})]})]})]}),!h&&i.jsxs("div",{className:"flex gap-4",children:[i.jsxs("div",{className:`flex-1 p-4 rounded-lg border ${l.turn()==="w"?"bg-green-500/20 border-green-500/50":"bg-[var(--glass)] border-[var(--border)]"}`,children:[i.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-1",children:"White Time"}),i.jsx("p",{className:"text-2xl font-mono font-bold",children:E(C)})]}),i.jsxs("div",{className:`flex-1 p-4 rounded-lg border ${l.turn()==="b"?"bg-green-500/20 border-green-500/50":"bg-[var(--glass)] border-[var(--border)]"}`,children:[i.jsx("p",{className:"text-xs text-[var(--text-secondary)] mb-1",children:"Black Time"}),i.jsx("p",{className:"text-2xl font-mono font-bold",children:E(O)})]})]})]})]})]})]}):i.jsx("div",{className:"min-h-screen bg-[var(--bg-primary)] flex items-center justify-center",children:i.jsxs("div",{className:"flex flex-col items-center gap-4",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[var(--accent)]"}),i.jsx("p",{className:"text-[var(--accent)] font-mono animate-pulse",children:"Initializing Game..."})]})})},Sa=()=>i.jsx(wa,{children:i.jsx(Ca,{})}),_a=r=>{const[e,t]=w.useState(null),[n,s]=w.useState(null),[o,c]=w.useState(!0);return w.useEffect(()=>{if(!r){c(!1);return}c(!0);const l=X.listenToMatch(r,a=>{if(!a){c(!1);return}t(a),a.gameState&&s(a.gameState),c(!1)});return()=>l()},[r]),{match:e,gameState:n,loading:o}},ja=(r,e,t,n,s)=>{w.useEffect(()=>{if(!s||!e||!r||!n||e.creatorId!==n||e.players.length>=e.maxPlayers)return;const l=setTimeout(async()=>{try{await X.addBotToMatch(r)}catch(a){console.error("Failed to add bot",a)}},1e3);return()=>clearTimeout(l)},[s,e?.players.length,e?.id,r,n]),w.useEffect(()=>{if(!s||!t||!e||!n||!r||t.phase!=="playing")return;const c=e.players[t.currentPlayer];if(!c?.isBot||e.creatorId!==n)return;o(t)==="0:00"&&console.warn(`[BotGuard] ${c.userName} stalled. Forcing move...`);const a=async x=>{const u=t.hands[x]||[];if(u.length===0){console.error(`[Bot] ${x} has no cards but it's their turn!`);return}const f=u.some(j=>j.suit===t.trumpSuit&&j.rank==="K"),p=u.some(j=>j.suit===t.trumpSuit&&j.rank==="Q");if(t.trumpRevealed&&t.trumpSuit&&f&&p&&!t.pairDeclaredBy){console.log(`[Bot] ${c.userName} declaring PAIR!`),await X.declarePair29(r,x,t,e.players);return}const m=t.currentTrick.length>0?t.currentTrick[0].card.suit:null,C=t.trumpSuit;let S=u;if(m){const j=u.filter(T=>T.suit===m);if(j.length>0)S=j;else if(!t.trumpRevealed&&C){console.log(`[Bot] ${c.userName} asking for trump...`),await X.revealTrump29(r,t);return}else if(t.trumpRevealed&&C){const T=u.filter(D=>D.suit===C);T.length>0&&(S=T)}}let O;if(t.currentTrick.length===0){const j=S.filter(T=>["J","9","A","10"].includes(T.rank));O=j.length>0?j[0]:S[0]}else{const j=X.determineTrickWinner(t.currentTrick,t.trumpRevealed?t.trumpSuit:null);if(e.players.findIndex(D=>D.userId===j)%2===t.currentPlayer%2){const D=S.filter(E=>!["J","9","A","10"].includes(E.rank));O=D.length>0?D[0]:S[0]}else O=S.sort((D,E)=>{const H={J:8,9:7,A:6,10:5,K:4,Q:3,8:2,7:1};return H[E.rank]-H[D.rank]})[0]}O||(O=S[0]),console.log(`[Bot] ${c.userName} (Seat ${t.currentPlayer}) playing card:`,O);try{await X.playCard29(r,x,O,t,e.players)}catch(j){console.error("[BotPlayError]",j)}},d=2500+Math.random()*500,h=setTimeout(async()=>{try{await a(c.userId)}catch(x){console.error("[BotError]",x)}},d);return()=>clearTimeout(h)},[s,t?.currentPlayer,t?.phase,t?.trumpRevealed,e?.id,r,n]);const o=c=>{if(!c||!c.turnStartedAt)return"30";const l=Date.now();let a;c.turnStartedAt&&typeof c.turnStartedAt.toMillis=="function"?a=c.turnStartedAt.toMillis():c.turnStartedAt&&c.turnStartedAt.seconds?a=c.turnStartedAt.seconds*1e3:a=new Date(c.turnStartedAt).getTime();const d=c.turnDuration||30;return`0:${Math.max(0,d-Math.floor((l-a)/1e3)).toString().padStart(2,"0")}`};w.useEffect(()=>{if(!s||!t||!e||!n||!r||t.phase!=="bidding")return;const c=e.players[t.currentBidder];if(!c?.isBot||e.creatorId!==n)return;if(t.passedPlayers?.includes(c.userId)){console.log(`[Bot] ${c.userName} has already passed. Skipping loop.`);return}const l=async()=>{const h=t.hands[c.userId]||[],x={J:3,9:2,A:1,10:1},u=h.reduce((j,T)=>j+(x[T.rank]||0),0);let f="pass";const p=t.highestBid?.amount||15,m=t.highestBid?.playerId===c.userId,C=u>=3,S=u>=5,O=u>=7;if(m){const j=p+1;(j<=18&&S||j<=20&&O)&&(f=j)}else p<16&&C?f=16:(p<=18&&S||p<=20&&O)&&(f=p);console.log(`[Bot] ${c.userName} decides to: ${f} (points: ${u}, winning: ${m})`);try{await X.makeBid29(r,c.userId,f,t,e.players)}catch(j){console.error("[BotBidError]",j)}},a=2500+Math.random()*500,d=setTimeout(l,a);return()=>clearTimeout(d)},[s,t?.currentBidder,t?.phase,e?.id,r,n]),w.useEffect(()=>{if(!s||!t||!e||!n||!r||t.trumpSuit||t.phase!=="playing")return;const c=e.players.find(h=>h.userId===t.bidWinner);if(!c?.isBot||e.creatorId!==n)return;const l=async()=>{const h=t.hands[c.userId]||[],x={H:0,D:0,C:0,S:0};h.forEach(f=>x[f.suit]++);const u=Object.keys(x).reduce((f,p)=>x[f]>x[p]?f:p);console.log(`[Bot] ${c.userName} (Bid Winner) selects trump: ${u}`),await X.selectTrump29(r,c.userId,u,t,e.players)},a=2500+Math.random()*500,d=setTimeout(l,a);return()=>clearTimeout(d)},[s,t?.trumpSuit,t?.phase,t?.bidWinner,e?.players.length,n]),w.useEffect(()=>{if(!s||!t||!e||!n||!r||t.bainPhase==="none"||!t.bainPhase||e.creatorId!==n)return;const c=t.bainPhase,l=t.bidWinner,a=e.players.findIndex(f=>f.userId===l),d=e.players.find(f=>f.isBot?c==="double_chance"?e.players.findIndex(m=>m.userId===f.userId)%2!==a%2:c==="redouble_chance"?f.userId===l:!1:!1);if(!d)return;const h=async()=>{const f=t.hands[d.userId]||[],p={J:3,9:2,A:1,10:1},m=f.reduce((D,E)=>D+(p[E.rank]||0),0);let C="skip";c==="double_chance"&&m>=6?C="double":c==="redouble_chance"&&m>=8&&(C="redouble"),console.log(`[BotBain] ${d.userName} decides to ${C} (points: ${m})`);let S=t.bainPhase,O=t.isDoubled||!1,j=t.isRedoubled||!1;c==="double_chance"?C==="double"?(O=!0,S="redouble_chance"):S="none":c==="redouble_chance"&&(C==="redouble"&&(j=!0),S="none");const T={...t,bainPhase:S,isDoubled:O,isRedoubled:j,turnStartedAt:fr(),lastMoveTime:new Date().toISOString()};await Ze(Xe(Je,"matches",r),{gameState:T})},x=2500+Math.random()*500,u=setTimeout(h,x);return()=>clearTimeout(u)},[s,t?.bainPhase,t?.isDoubled,t?.isRedoubled,e?.id,r,n]),w.useEffect(()=>{if(!s||!t||!e||!n||!r||t.phase!=="playing"||!t.trumpSuit)return;const c=e.players[t.currentPlayer];if(!c?.isBot||e.creatorId!==n)return;const l=async()=>{const h=t.hands[c.userId]||[];if(h.length===0)return;const x=C=>({J:3,9:2,A:1,10:1})[C]||0,u=C=>({J:8,9:7,A:6,10:5,K:4,Q:3,8:2,7:1})[C]||0,f=t.currentTrick||[],p=f.length>0?f[0].card.suit:null;let m=h[0];if(p){const C=h.filter(D=>D.suit===p);let S=-1,O=-1;f.forEach(D=>{let E=u(D.card.rank);D.card.suit===t.trumpSuit&&t.trumpRevealed?E+=10:D.card.suit!==p&&(E=-1),E>S&&(S=E,O=e.players.findIndex(H=>H.userId===D.playerId))});const j=t.currentPlayer,T=O!==-1&&O%2===j%2;if(C.length>0)if(!T)C.some(E=>u(E.rank)>S)?m=[...C].sort((E,H)=>u(H.rank)-u(E.rank))[0]:m=[...C].sort((E,H)=>u(E.rank)-u(H.rank))[0];else{const D=C.filter(E=>x(E.rank)>0);D.length>0?m=D[0]:m=C[0]}else{const D=h.filter(H=>H.suit===t.trumpSuit),E=f.reduce((H,V)=>H+x(V.card.rank),0);!T&&D.length>0&&t.trumpRevealed?E>=2||S>=7?m=[...D].sort((H,V)=>u(H.rank)-u(V.rank))[0]:m=h[0]:!t.trumpRevealed&&!T&&!t.trumpRevealed?m=[...h].sort((H,V)=>u(H.rank)-u(V.rank))[0]:m=[...h].sort((H,V)=>u(H.rank)-u(V.rank))[0]}}else m=[...h].sort((C,S)=>u(S.rank)-u(C.rank))[0];console.log(`[BotSmartPlay] ${c.userName} plays ${m.rank} of ${m.suit}`),await X.playCard29(r,c.userId,m,t,e.players)},a=2500+Math.random()*500,d=setTimeout(l,a);return()=>clearTimeout(d)},[s,t?.currentPlayer,t?.phase,t?.trumpSuit,t?.trumpRevealed,e?.id,r,n]),w.useEffect(()=>{if(!s||!t||!e||!n||!r||e.creatorId!==n||t.phase==="completed")return;const l=setInterval(async()=>{if(o(t)==="0:00"){const d=e.players[t.currentPlayer].userId;console.warn(`[StallGuard] Seat ${t.currentPlayer} (${d}) stalled. Forcing valid move.`);try{const h=t.hands[d]||[];if(h.length>0){const x=t.currentTrick.length>0?t.currentTrick[0].card.suit:null;let u=h[0];if(x){const f=h.find(p=>p.suit===x);f&&(u=f)}await X.playCard29(r,d,u,t,e.players)}else t.phase==="bidding"?await X.makeBid29(r,d,"pass",t,e.players):t.phase==="playing"&&!t.trumpSuit&&t.bidWinner===d&&await X.selectTrump29(r,d,"H",t,e.players)}catch(h){console.error("[StallGuardError]",h)}}},5e3);return()=>clearInterval(l)},[s,t?.currentPlayer,t?.phase,t?.turnStartedAt,e?.id,r,n])},Ct=({player:r,isActive:e,tricksWon:t,position:n,turnStartedAt:s,turnDuration:o=30,currentBid:c,gamePhase:l})=>{const[a,d]=w.useState(0);w.useEffect(()=>{if(!e||!s||typeof s.toMillis!="function"){d(0);return}const x=setInterval(()=>{const u=(Date.now()-s.toMillis())/1e3,f=Math.min(u/o*100,100);d(f)},100);return()=>clearInterval(x)},[e,s,o]);const h={bottom:"absolute bottom-2 md:bottom-4 left-1/2 -translate-x-1/2 scale-100",left:"absolute left-8 md:left-20 top-1/2 -translate-y-1/2 scale-100",top:"absolute top-14 md:top-16 left-1/2 -translate-x-1/2 scale-100",right:"absolute right-8 md:right-20 top-1/2 -translate-y-1/2 scale-100"};return i.jsx("div",{className:`${h[n]} z-20`,children:i.jsxs("div",{className:"flex flex-col items-center gap-1",children:[i.jsxs("div",{className:"relative",children:[e&&i.jsx("div",{className:"absolute -inset-2 rounded-full bg-cyan-400/20 blur-md animate-pulse"}),e&&l==="playing"&&s&&i.jsxs("svg",{className:"absolute -inset-2 w-20 h-20 -rotate-90",viewBox:"0 0 100 100",children:[i.jsx("circle",{cx:"50",cy:"50",r:"47",fill:"none",stroke:"rgba(6, 182, 212, 0.1)",strokeWidth:"4"}),i.jsx("circle",{cx:"50",cy:"50",r:"47",fill:"none",stroke:"#06b6d4",strokeWidth:"4",strokeDasharray:`${2*Math.PI*47}`,strokeDashoffset:`${2*Math.PI*47*(1-a/100)}`,strokeLinecap:"round",className:"transition-all duration-100 drop-shadow-[0_0_8px_rgba(6,182,212,0.6)]"})]}),i.jsx("div",{className:`w-16 h-16 rounded-full border-4 relative overflow-hidden ${e?"border-cyan-400 shadow-[0_0_20px_rgba(6,182,212,0.5)]":"border-[#1a3a52]"} bg-[#0f2537]`,children:i.jsx("img",{src:r.userAvatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${r.userId}`,alt:r.userName,className:"w-full h-full rounded-full object-cover"})}),l==="bidding"&&c&&i.jsx("div",{className:"absolute -top-1 -left-1 bg-cyan-500 rounded-full min-w-[24px] h-6 px-2 flex items-center justify-center text-xs font-black text-white border-2 border-[#0a1628] shadow-lg",children:c==="pass"?"P":c}),t>0&&l==="playing"&&i.jsx("div",{className:"absolute -top-1 -right-1 bg-yellow-400 rounded-full w-6 h-6 flex items-center justify-center text-xs font-black text-black border-2 border-[#0a1628] shadow-lg",children:t})]}),r.isBot&&i.jsx("span",{className:"text-[10px] text-white/50 font-bold uppercase",children:"Bot"})]})})},ka=({gameState:r,mySeat:e,team1RoundPoints:t,team2RoundPoints:n})=>{const s=Sr(),o=e===0||e===2||e===-1,c=o?t:n,l=o?n:t,a=(r.highestBid?.amount||16)+(r.bidAdjustment||0),d=Object.keys(r.tricks||{}).length,h=x=>{if(!x)return i.jsx(hr,{className:"w-3 h-3 text-white/20"});switch(x){case"H":return i.jsx("span",{className:"text-red-500 text-base leading-none",children:""});case"D":return i.jsx("span",{className:"text-red-500 text-base leading-none",children:""});case"C":return i.jsx("span",{className:"text-white text-base leading-none",children:""});case"S":return i.jsx("span",{className:"text-white text-base leading-none",children:""});default:return i.jsx(hr,{className:"w-3 h-3 text-white/20"})}};return i.jsx("div",{className:"fixed top-2 left-1/2 -translate-x-1/2 z-40 w-[96%] max-w-lg",children:i.jsxs("div",{className:"relative bg-[#0a1628]/60 backdrop-blur-xl border border-white/10 rounded-3xl shadow-[0_8px_32px_rgba(0,0,0,0.5)] overflow-hidden",children:[i.jsxs("div",{className:"flex items-center justify-between px-4 py-1.5 bg-gradient-to-r from-transparent via-white/5 to-transparent border-b border-white/5",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("button",{onClick:()=>s("/dashboard"),className:"w-6 h-6 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-all active:scale-95",children:i.jsx(gn,{className:"w-3.5 h-3.5 text-white"})}),i.jsxs("span",{className:"text-[9px] font-black text-white/40 uppercase tracking-widest",children:["R-",r.round||1]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest",children:"TRICKS"}),i.jsx("div",{className:"h-3 w-[1px] bg-white/10 mx-1"}),i.jsxs("span",{className:"text-[10px] font-black text-cyan-400 font-mono tracking-widest",children:[d,i.jsx("span",{className:"text-white/30 mx-0.5",children:"/"}),"8"]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-[9px] font-black text-white/40 uppercase tracking-widest",children:"PHASE"}),i.jsx("span",{className:"text-[9px] font-black text-cyan-400 uppercase tracking-widest",children:r.phase==="bidding"?"BID":r.phase==="playing"?"PLAY":"END"})]})]}),i.jsxs("div",{className:"relative px-4 py-2 pb-3",children:[i.jsxs("div",{className:"flex items-center justify-between relative z-10",children:[i.jsxs("div",{className:"flex flex-col items-center flex-1",children:[i.jsx("span",{className:"text-[9px] font-black text-cyan-400 uppercase tracking-[0.2em] mb-0.5 drop-shadow-[0_0_8px_rgba(6,182,212,0.8)]",children:"YOU"}),i.jsx(Y.div,{initial:{scale:.8,opacity:.5},animate:{scale:1,opacity:1},className:"text-3xl font-black text-transparent bg-clip-text bg-gradient-to-b from-cyan-300 to-cyan-600 drop-shadow-[0_0_15px_rgba(6,182,212,0.5)]",children:c},c)]}),i.jsxs("div",{className:"flex flex-col items-center justify-center flex-[1.2] relative px-2",children:[i.jsx("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-[1px] h-8 bg-gradient-to-b from-transparent via-white/10 to-transparent"}),i.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-[1px] h-8 bg-gradient-to-b from-transparent via-white/10 to-transparent"}),i.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[i.jsxs("div",{className:"flex items-center gap-1.5 opacity-90",children:[i.jsx("span",{className:"text-[9px] text-white/80 font-bold tracking-wide",children:"Trump"}),h(r.trumpRevealed?r.trumpSuit:null)]}),i.jsx(Y.div,{className:"text-4xl font-black text-yellow-400 drop-shadow-[0_0_20px_rgba(250,204,21,0.6)] leading-none",children:a})]})]}),i.jsxs("div",{className:"flex flex-col items-center flex-1",children:[i.jsx("span",{className:"text-[9px] font-black text-red-500 uppercase tracking-[0.2em] mb-0.5 drop-shadow-[0_0_8px_rgba(239,68,68,0.8)]",children:"OPP"}),i.jsx(Y.div,{initial:{scale:.8,opacity:.5},animate:{scale:1,opacity:1},className:"text-3xl font-black text-transparent bg-clip-text bg-gradient-to-b from-red-400 to-red-600 drop-shadow-[0_0_15px_rgba(239,68,68,0.5)]",children:l},l)]})]}),i.jsx("div",{className:"absolute top-1/2 left-8 -translate-y-1/2 w-24 h-24 bg-cyan-500/10 blur-[40px] rounded-full pointer-events-none"}),i.jsx("div",{className:"absolute top-1/2 right-8 -translate-y-1/2 w-24 h-24 bg-red-500/10 blur-[40px] rounded-full pointer-events-none"})]}),i.jsx("div",{className:"h-[2px] w-full bg-gradient-to-r from-cyan-500/80 via-yellow-400/80 to-red-500/80 shadow-[0_0_10px_rgba(255,255,255,0.5)]"})]})})},St=({card:r,size:e="md"})=>{const t=r.suit==="H"||r.suit==="D",n=r.suit==="H"?"":r.suit==="D"?"":r.suit==="C"?"":"",o={sm:{w:"w-10",h:"h-14",text:"text-[10px]",icon:"text-xs"},md:{w:"w-14 md:w-16",h:"h-20 md:h-24",text:"text-[10px] md:text-sm",icon:"text-lg md:text-xl"},lg:{w:"w-16 md:w-24",h:"h-24 md:h-36",text:"text-[10px] md:text-base",icon:"text-2xl md:text-4xl"}}[e];return i.jsxs("div",{className:`bg-white text-black rounded-lg ${o.w} ${o.h} flex flex-col justify-between p-1.5 shadow-xl border border-gray-200 relative`,children:[i.jsxs("div",{className:`flex flex-col items-center leading-none ${t?"text-red-600":"text-slate-900"}`,children:[i.jsx("span",{className:`font-black uppercase ${o.text}`,children:r.rank}),i.jsx("span",{className:"text-[10px]",children:n})]}),i.jsx("div",{className:`absolute inset-0 flex items-center justify-center pointer-events-none opacity-90 ${t?"text-red-500":"text-slate-800"} ${o.icon}`,children:n}),i.jsxs("div",{className:`flex flex-col items-center leading-none self-end rotate-180 ${t?"text-red-600":"text-slate-900"}`,children:[i.jsx("span",{className:`font-black uppercase ${o.text}`,children:r.rank}),i.jsx("span",{className:"text-[10px]",children:n})]})]})},Oa=r=>{if(!r||!r.turnStartedAt)return"Starting";const e=Date.now();let t;try{if(r.turnStartedAt&&typeof r.turnStartedAt.toMillis=="function"?t=r.turnStartedAt.toMillis():r.turnStartedAt&&r.turnStartedAt.seconds?t=r.turnStartedAt.seconds*1e3:t=new Date(r.turnStartedAt).getTime(),isNaN(t))return"Starting"}catch{return"Starting"}const n=r.turnDuration||30,s=Math.max(0,n-Math.floor((e-t)/1e3)),o=Math.floor(s/60),c=s%60;return`${o}:${c.toString().padStart(2,"0")}`},Ta=()=>{const{id:r}=Cr(),{user:e}=hn(),t=Sr(),[n,s]=w.useState(null);w.useEffect(()=>{if(e)s(e.id);else{const k=localStorage.getItem("guest_identity");k&&s(JSON.parse(k).id)}},[e]);const[o,c]=w.useState(!1),{match:l,gameState:a}=_a(r),d=l?.creatorId===n;ja(r,l,a,n??void 0,d);const[h,x]=w.useState(!1),[u,f]=w.useState(null),[p,m]=w.useState(!1);w.useEffect(()=>{if(!a||a.phase==="completed")return;const k=setInterval(()=>{Oa(a)==="0:00"&&a.phase!=="completed"&&x(!0)},1e3);return l&&l.players.length<l.maxPlayers&&!l.withBots&&a.phase!=="completed"&&f("A player"),()=>clearInterval(k)},[a,l]),w.useEffect(()=>{if(!l||!r||!d||l.players.length<l.maxPlayers||a?.hands&&Object.keys(a.hands).length>0)return;(async()=>{const R=["H","D","C","S"],A=["7","8","9","10","J","Q","K","A"],z=[];R.forEach(J=>A.forEach(oe=>z.push({suit:J,rank:oe})));for(let J=z.length-1;J>0;J--){const oe=Math.floor(Math.random()*(J+1));[z[J],z[oe]]=[z[oe],z[J]]}const Q={},ce=a?.dealerIndex!==void 0?a.dealerIndex:0,he=(ce+3)%4;l.players.forEach((J,oe)=>{const Ce=(he-oe+4)%4,Se=l.players[Ce];Q[Se.userId]=z.slice(oe*4,(oe+1)*4)});const ge={hands:Q,currentTrick:[],tricks:{},gamePoints:a?.gamePoints||{team1:0,team2:0},trumpSuit:null,currentPlayer:(ce+3)%4,round:a?.round||1,scores:Object.fromEntries(l.players.map(J=>[J.userId,0])),turnStartedAt:fr(),turnDuration:30,bids:{},currentBidder:(ce+3)%4,highestBid:null,bidWinner:null,phase:"bidding",dealerIndex:ce,pairShown:!1,lastTrickCards:[],secondDealComplete:!1,remainingDeck:z.slice(16),bainPhase:"none",isDoubled:!1,isRedoubled:!1,singleHandMode:!1};await Ze(Xe(Je,"matches",r),{gameState:ge})})()},[l?.players.length,l?.id,d,a?.hands]);const C=async k=>{if(!(!r||!e||!a))try{await X.playCard29(r,e.id,k,a,l.players)}catch(R){Ee.error(R.message||"Invalid move!")}},S=async k=>{if(!(!l||!a||!r||!e))try{await X.makeBid29(r,e.id,k,a,l.players)}catch(R){Ee.error(R.message||"Bidding failed")}},O=async k=>{if(!a||!r)return;let{bainPhase:R,isDoubled:A,isRedoubled:z}=a;R==="double_chance"?k==="double"?(A=!0,R="redouble_chance"):R="none":R==="redouble_chance"&&(k==="redouble"&&(z=!0),R="none"),await Ze(Xe(Je,"matches",r),{gameState:{...a,bainPhase:R,isDoubled:A,isRedoubled:z,turnStartedAt:fr()}})},j=async k=>{if(!(!a||!r||!l||!e))try{await X.selectTrump29(r,n||"unknown",k,a,l.players)}catch(R){Ee.error(R.message||"Failed to select trump")}},T=async()=>{if(!(!r||!a))try{await X.revealTrump29(r,a)}catch{Ee.error("Failed to reveal trump")}};if(!l||!a)return i.jsx("div",{className:"min-h-screen bg-[#0a0f1e] flex items-center justify-center text-cyan-400 font-mono",children:"Loading Game..."});const D=a.hands[n||""]||[],E=l.players.findIndex(k=>k.userId===n),H=a.phase==="bidding"?a.currentBidder===E:a.currentPlayer===E,V=(E+1)%4,L=(E+2)%4,U=(E+3)%4,se=(a.scores?.[l.players[0]?.userId]||0)+(a.scores?.[l.players[2]?.userId]||0),G=(a.scores?.[l.players[1]?.userId]||0)+(a.scores?.[l.players[3]?.userId]||0);return i.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-[#0a1628] via-[#0f2537] to-[#1a3a52] text-white relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 opacity-5 bg-[url('https://www.transparenttextures.com/patterns/fake-luxury.png')]"}),i.jsx(ka,{gameState:a,mySeat:E,team1RoundPoints:se,team2RoundPoints:G}),i.jsx("div",{className:"flex items-start justify-center min-h-screen pt-20 md:pt-24 pb-24 overflow-hidden fixed inset-0",children:i.jsxs("div",{className:"relative w-full max-w-4xl aspect-square max-h-[85vh]",children:[a.lastTrickCards&&a.lastTrickCards.length>=4&&a.phase!=="bidding"&&i.jsx(Y.button,{drag:!0,dragConstraints:{left:-100,right:300,top:-200,bottom:200},initial:{x:0,opacity:0},animate:{x:20,opacity:1},whileHover:{scale:1.1,backgroundColor:"rgba(6, 182, 212, 0.4)"},whileTap:{scale:.9,cursor:"grabbing"},onClick:()=>c(!o),className:`absolute left-0 bottom-32 md:bottom-40 z-30 w-14 h-14 rounded-full flex items-center justify-center border-2 transition-all shadow-xl backdrop-blur-md ${o?"bg-cyan-500 border-cyan-400 text-black":"bg-[#1a3a52]/60 border-white/20 text-white"}`,children:i.jsxs("span",{className:"text-[10px] font-black uppercase leading-none text-center pointer-events-none",children:["Last",i.jsx("br",{}),"Hand"]})}),i.jsx(Jt,{children:o&&a.lastTrickCards&&i.jsx(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"absolute bottom-48 left-8 z-30 bg-[#1a1f2e]/90 backdrop-blur-lg border border-cyan-500/30 p-3 rounded-2xl shadow-2xl flex gap-1.5",children:a.lastTrickCards.map((k,R)=>i.jsxs("div",{className:"flex flex-col items-center gap-1",children:[i.jsx(St,{card:k.card,size:"sm"}),i.jsx("span",{className:"text-[8px] text-white/60 font-medium truncate w-10 text-center",children:k.playerName})]},R))})}),i.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:i.jsxs("div",{className:"relative w-[500px] h-[500px] rounded-full bg-gradient-to-br from-[#2d5016] via-[#1f3a0f] to-[#0f1e08] border-[12px] border-[#3d2b1f] shadow-[0_0_80px_rgba(0,0,0,0.8),inset_0_0_100px_rgba(0,0,0,0.7)] flex items-center justify-center",children:[i.jsx("div",{className:"absolute inset-0 opacity-20 rounded-full bg-[url('https://www.transparenttextures.com/patterns/felt.png')]"}),i.jsx("div",{className:"absolute inset-4 border-2 border-yellow-900/20 rounded-full"}),i.jsx("div",{className:"relative z-10 w-full h-full flex items-center justify-center",children:i.jsx(Jt,{children:a.currentTrick.map((k,R)=>{const z=(l.players.findIndex(ge=>ge.userId===k.playerId)-E+4)%4,Q=[{x:0,y:220},{x:-220,y:0},{x:0,y:-220},{x:220,y:0}],ce=[{x:0,y:60},{x:-60,y:0},{x:0,y:-60},{x:60,y:0}];let he={y:-220,opacity:0};if(a.lastWinnerId){const J=(l.players.findIndex(oe=>oe.userId===a.lastWinnerId)-E+4)%4;J!==-1&&(he={...Q[J],opacity:0,scale:.3})}return i.jsx(Y.div,{initial:{...Q[z],opacity:0,scale:.5,rotate:0},animate:{...ce[z],opacity:1,scale:1,rotate:z*90+(R*2-4)},exit:{...he,transition:{duration:.6,ease:"circIn"}},className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2",children:i.jsx(St,{card:k.card,size:"md"})},`${k.playerId}-${k.card.rank}-${R}`)})})})]})}),i.jsx(Ct,{position:"bottom",player:l.players[E],isActive:H,isCurrentUser:!0,tricksWon:0,playerNumber:1,turnStartedAt:a.turnStartedAt,turnDuration:a.turnDuration,currentBid:a.bids[l.players[E].userId],gamePhase:a.phase}),i.jsx(Ct,{position:"left",player:l.players[V],isActive:a.currentPlayer===V,isCurrentUser:!1,tricksWon:0,playerNumber:2,turnStartedAt:a.turnStartedAt,turnDuration:a.turnDuration,currentBid:a.bids[l.players[V].userId],gamePhase:a.phase}),i.jsx(Ct,{position:"top",player:l.players[L],isActive:a.currentPlayer===L,isCurrentUser:!1,tricksWon:0,playerNumber:3,turnStartedAt:a.turnStartedAt,turnDuration:a.turnDuration,currentBid:a.bids[l.players[L].userId],gamePhase:a.phase}),i.jsx(Ct,{position:"right",player:l.players[U],isActive:a.currentPlayer===U,isCurrentUser:!1,tricksWon:0,playerNumber:4,turnStartedAt:a.turnStartedAt,turnDuration:a.turnDuration,currentBid:a.bids[l.players[U].userId],gamePhase:a.phase})]})}),i.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent z-40",children:i.jsx("div",{className:"max-w-4xl mx-auto flex flex-col items-center gap-4",children:i.jsxs("div",{className:"flex flex-col items-center gap-3 mb-2",children:[i.jsx("div",{className:"flex items-center gap-4",children:a.phase==="playing"&&H&&a.trumpRevealed&&!a.pairDeclaredBy&&(()=>{const k=D.some(A=>A.suit===a.trumpSuit&&A.rank==="K"),R=D.some(A=>A.suit===a.trumpSuit&&A.rank==="Q");return k&&R?i.jsx("button",{onClick:async()=>{try{await X.declarePair29(r,e.id,a,l.players),Ee.success("Pair Declared!")}catch(A){Ee.error(A.message)}},className:"px-6 py-3 bg-gradient-to-r from-yellow-400 to-yellow-600 text-black font-black rounded-xl shadow-xl hover:scale-105 transition-all text-[10px] tracking-widest uppercase",children:"Declare Pair"}):null})()}),i.jsx("div",{className:"grid grid-cols-4 md:flex md:justify-center gap-2 md:gap-0 pb-6 w-full px-4 items-end min-h-[160px] max-w-lg mx-auto",children:D.map((k,R)=>{let A=H;if(H&&a.currentTrick.length>0){const Q=a.currentTrick[0].card.suit;D.some(he=>he.suit===Q)?A=k.suit===Q:a.trumpRevealed&&a.trumpSuit&&D.some(ge=>ge.suit===a.trumpSuit)&&(A=k.suit===a.trumpSuit)}const z=D.length<=4;return i.jsx(Y.button,{onClick:()=>C(k),disabled:!A,whileHover:A?{y:-20,scale:1.05,zIndex:50}:{},className:`relative transition-all  ${A?"cursor-pointer":"opacity-60 grayscale cursor-not-allowed"}`,children:i.jsx(St,{card:k,size:"lg"})},R)})})]})})}),a.phase==="bidding"&&H&&i.jsxs("div",{className:"fixed bottom-44 md:bottom-56 left-1/2 -translate-x-1/2 z-50 flex items-center gap-4",children:[i.jsx(Y.button,{whileTap:{scale:.9},onClick:()=>S("pass"),className:"w-14 h-14 bg-red-500/20 border-2 border-red-500/40 text-red-400 font-black rounded-full hover:bg-red-500/30 transition-all uppercase text-[10px] shadow-lg flex items-center justify-center italic",children:"Pass"}),a.highestBid?a.highestBid.playerId!==e?.id&&i.jsxs(Y.button,{whileTap:{scale:.9},onClick:()=>S(a.highestBid.amount),className:"px-6 h-16 bg-cyan-500 text-black font-black rounded-full hover:scale-105 transition-all uppercase tracking-widest text-[10px] shadow-[0_0_15px_rgba(6,182,212,0.3)] flex items-center justify-center text-center leading-tight",children:["MATCH",i.jsx("br",{}),a.highestBid.amount]}):i.jsx(Y.button,{animate:{scale:[1,1.05,1],opacity:[.8,1,.8]},transition:{repeat:1/0,duration:1.5},whileTap:{scale:.9},onClick:()=>S(16),className:"w-16 h-16 bg-cyan-500 shadow-[0_0_20px_rgba(6,182,212,0.5)] text-black font-black rounded-full flex items-center justify-center text-xl",children:"16"}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx(Y.button,{whileTap:{scale:.9},onClick:()=>m(!p),className:"w-14 h-14 bg-cyan-500/20 border-2 border-cyan-500/40 text-cyan-400 font-extrabold rounded-full hover:bg-cyan-500/30 transition-all text-lg shadow-xl flex items-center justify-center",children:Math.max(16,(a.highestBid?.amount||14)+2)}),i.jsx(Y.button,{whileTap:{scale:.9},onClick:()=>{const R=(a.highestBid?.amount||14)+2;R<=28?S(R):Ee.error("Maximum bid is 28")},className:"w-12 h-12 bg-gradient-to-br from-cyan-400 to-cyan-600 text-black font-black rounded-full hover:scale-110 active:scale-95 transition-all shadow-[0_0_15px_rgba(6,182,212,0.4)] flex items-center justify-center text-2xl border-2 border-white/20",children:"+"})]})]}),p&&a.phase==="bidding"&&H&&i.jsx("div",{className:"fixed inset-0 z-[60] bg-black/40 backdrop-blur-sm flex items-end justify-center p-4",onClick:()=>m(!1),children:i.jsxs(Y.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},onClick:k=>k.stopPropagation(),className:"bg-[#1a1f2e] border border-cyan-500/30 p-6 rounded-t-[2.5rem] w-full max-w-md shadow-[0_-10px_80px_rgba(6,182,212,0.2)]",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsx("h3",{className:"text-lg font-black text-white uppercase",children:"Select Bid"}),i.jsx("button",{onClick:()=>m(!1),className:"w-8 h-8 bg-white/10 rounded-full flex items-center justify-center text-white hover:bg-white/20 transition-all text-xl",children:""})]}),i.jsx("div",{className:"grid grid-cols-4 gap-3 mb-4",children:[16,17,18,19,20,21,22,23,24,25,26,27,28].map(k=>{const R=a.highestBid?.amount||15;return k>R?i.jsx(Y.button,{whileTap:{scale:.95},onClick:()=>{S(k),m(!1)},className:"py-4 bg-cyan-500/10 border border-cyan-500/20 text-cyan-400 font-bold rounded-xl hover:bg-cyan-500/20 transition-all",children:k},k):null})})]})}),a.bainPhase!=="none"&&(()=>{const k=l.players.findIndex(z=>z.userId===a.bidWinner)%2===E%2,R=a.bainPhase==="double_chance"&&!k,A=a.bainPhase==="redouble_chance"&&k;return!R&&!A?null:i.jsx("div",{className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4",children:i.jsxs(Y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-[#1a1f2e] border border-purple-500/30 p-8 rounded-3xl text-center shadow-[0_0_50px_rgba(168,85,247,0.2)]",children:[i.jsx("h2",{className:"text-2xl font-black text-purple-400 mb-6 uppercase tracking-widest",children:a.bainPhase==="double_chance"?"CHALLENGE (DOUBLE)?":"DEFEND (REDOUBLE)?"}),i.jsxs("div",{className:"flex gap-4",children:[i.jsx("button",{onClick:()=>O("skip"),className:"flex-1 px-8 py-4 rounded-2xl bg-white/5 border border-white/10 text-white font-black hover:bg-white/10 transition-all uppercase tracking-widest text-sm",children:"SKIP"}),i.jsx("button",{onClick:()=>O(a.bainPhase==="double_chance"?"double":"redouble"),className:"flex-1 px-8 py-4 rounded-2xl bg-gradient-to-r from-purple-600 to-purple-500 font-black text-white hover:scale-105 transition-all shadow-xl uppercase tracking-widest text-sm",children:a.bainPhase==="double_chance"?"DOUBLE":"REDOUBLE"})]}),i.jsx("p",{className:"mt-6 text-[10px] text-white/40 uppercase font-bold tracking-[0.2em]",children:a.bainPhase==="double_chance"?"Increase reward/penalty X2":"Increase reward/penalty X4"})]})})})(),a.phase==="playing"&&!a.trumpSuit&&a.bidWinner===e?.id&&i.jsx("div",{className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4",children:i.jsxs("div",{className:"bg-[#1a1f2e] border border-cyan-500/30 p-8 rounded-3xl text-center max-w-md w-full",children:[i.jsx("h2",{className:"text-2xl font-black mb-6 text-white",children:"CHOOSE TRUMP"}),i.jsx("div",{className:"grid grid-cols-2 gap-4",children:["H","D","C","S"].map(k=>i.jsx("button",{onClick:()=>j(k),className:"p-6 rounded-2xl bg-white/5 border border-white/10 text-4xl hover:border-cyan-500 transition-all",children:k==="H"?"":k==="D"?"":k==="C"?"":""},k))}),a.secondDealComplete&&D.length===8&&i.jsxs("div",{className:"mt-8 p-4 bg-gradient-to-br from-purple-500/10 to-pink-500/10 border border-purple-500/20 rounded-2xl",children:[i.jsxs("div",{className:"flex items-center justify-center gap-4 mb-2",children:[i.jsx("span",{className:"text-sm font-bold text-white",children:"PLAY SINGLE HAND?"}),i.jsx("input",{type:"checkbox",checked:a.singleHandMode||!1,onChange:k=>Ze(Xe(Je,"matches",r),{"gameState.singleHandMode":k.target.checked}),className:"w-6 h-6 accent-cyan-400 cursor-pointer"})]}),i.jsx("p",{className:"text-[10px] text-white/60 leading-relaxed",children:"Only 1 trick  Highest rank wins  Trump doesn't matter"})]})]})}),a.phase==="playing"&&!a.trumpSuit&&a.bidWinner!==e?.id&&i.jsx("div",{className:"fixed inset-0 z-50 bg-black/60 backdrop-blur-md flex items-center justify-center p-4",children:i.jsxs(Y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-[#1a1f2e]/90 border border-cyan-500/30 p-10 rounded-3xl text-center shadow-[0_0_50px_rgba(6,182,212,0.2)]",children:[i.jsx("div",{className:"w-16 h-16 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-6"}),i.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-widest mb-2",children:"Waiting for Trump"}),i.jsxs("p",{className:"text-cyan-400/60 font-mono text-sm",children:[l.players.find(k=>k.userId===a.bidWinner)?.userName," is choosing..."]})]})}),a.trumpSuit&&a.phase==="playing"&&(()=>{const k=a.currentTrick?.length>0?a.currentTrick[0].card.suit:null,R=k?D.some(z=>z.suit===k):!0,A=H&&!R&&!a.trumpRevealed;return i.jsxs("div",{className:"fixed top-32 md:top-40 right-4 md:right-8 z-[45] flex flex-col items-center",children:[i.jsx("div",{className:"relative w-14 h-20 md:w-28 md:h-40 group",children:i.jsx(Jt,{mode:"wait",children:a.trumpRevealed?i.jsxs(Y.div,{initial:{rotateY:180,opacity:0,scale:.8},animate:{rotateY:0,opacity:1,scale:1},exit:{rotateY:-180,opacity:0,scale:.8},transition:{duration:.5,ease:"circOut"},className:"absolute inset-0 bg-white rounded-xl md:rounded-2xl overflow-hidden shadow-[0_0_40px_rgba(234,179,8,0.25)] border-4 border-yellow-500 flex flex-col items-center justify-center",children:[i.jsx("div",{className:`text-5xl md:text-8xl leading-none ${a.trumpSuit==="H"||a.trumpSuit==="D"?"text-red-600":"text-black"}`,children:a.trumpSuit==="H"?"":a.trumpSuit==="D"?"":a.trumpSuit==="C"?"":""}),i.jsxs("div",{className:"mt-2 md:mt-4 flex items-center gap-1.5 md:gap-2 px-2 md:px-4 py-1 md:py-1.5 bg-yellow-500/10 rounded-full border border-yellow-500/30",children:[i.jsx(ts,{className:"w-2.5 h-2.5 md:w-4 md:h-4 text-yellow-600 animate-pulse"}),i.jsx("span",{className:"text-[10px] md:text-sm font-black text-yellow-700 uppercase leading-none",children:"Revealed"})]})]},"front"):i.jsxs(Y.div,{initial:{rotateY:-180,opacity:0,scale:.8},animate:{rotateY:0,opacity:1,scale:A?[1,1.15,1]:1,y:A?[0,-10,0]:0},exit:{rotateY:180,opacity:0,scale:.8},transition:{rotateY:{duration:.5,ease:"circOut"},scale:A?{duration:1,repeat:1/0}:{duration:.5},y:A?{duration:1,repeat:1/0}:{duration:.5}},onClick:()=>A&&T(),className:`absolute inset-0 bg-gradient-to-br from-[#1e293b] via-[#0f172a] to-black border-2 rounded-xl md:rounded-2xl overflow-hidden shadow-[0_0_30px_rgba(0,0,0,0.5),0_0_15px_rgba(6,182,212,0.1)] flex flex-col items-center justify-center transition-colors ${A?"border-yellow-400 cursor-pointer shadow-[0_0_50px_rgba(250,204,21,0.3)]":"border-cyan-500/40 cursor-default"}`,children:[i.jsx("div",{className:"absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"}),i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsxs("div",{className:"relative",children:[i.jsx(hr,{className:`w-8 h-8 md:w-16 md:h-16 ${A?"text-yellow-400 animate-pulse":"text-cyan-500/30"}`}),i.jsx("div",{className:"absolute inset-0 blur-xl bg-cyan-500/10"})]}),i.jsx("span",{className:`text-[8px] md:text-[10px] font-black uppercase mt-2 md:mt-3 tracking-widest bg-black/40 px-2 py-0.5 rounded-full ${A?"text-yellow-400":"text-cyan-400/80"}`,children:A?"Reveal!":"Trump"})]})]},"back")})}),A&&i.jsx("p",{className:"mt-2 text-[8px] md:text-[10px] text-yellow-400 font-black uppercase tracking-widest text-center animate-bounce",children:"No Suit! Reveal?"})]})})(),a.showRoundPopup&&a.roundWinner&&i.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex items-center justify-center p-4",children:i.jsxs(Y.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"bg-[#1a1f2e] border border-cyan-500/30 p-10 rounded-[3rem] w-full max-w-lg text-center shadow-[0_0_100px_rgba(6,182,212,0.2)]",children:[i.jsx("div",{className:"text-6xl mb-6",children:a.roundWinner.isDraw?"":a.roundWinner.bidWon?"":""}),i.jsx("h2",{className:"text-4xl font-black mb-2 text-white italic tracking-tighter uppercase",children:a.roundWinner.isDraw?"ROUND DRAW!":`Round ${a.round} Complete!`}),i.jsx("div",{className:"text-cyan-400 font-mono mb-6 uppercase tracking-widest text-sm",children:a.roundWinner.isDraw?"Trump Not Revealed":a.roundWinner.bidWon?"Bid Successful!":"Bid Failed!"}),i.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 mb-6",children:[i.jsx("div",{className:"text-lg font-bold text-white mb-2",children:a.roundWinner.isDraw?"No Points Awarded":`Team ${a.roundWinner.team} Wins!`}),!a.roundWinner.isDraw&&i.jsxs("div",{className:"text-3xl font-black text-cyan-400",children:[a.roundWinner.points," Points"]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[i.jsxs("div",{className:"bg-cyan-500/10 border border-cyan-500/20 p-4 rounded-2xl",children:[i.jsx("div",{className:"text-xs text-cyan-400 mb-1",children:"Your Team"}),i.jsx("div",{className:"text-2xl font-black text-white",children:a.gamePoints?.team1||0})]}),i.jsxs("div",{className:"bg-pink-500/10 border border-pink-500/20 p-4 rounded-2xl",children:[i.jsx("div",{className:"text-xs text-pink-400 mb-1",children:"Opponents"}),i.jsx("div",{className:"text-2xl font-black text-white",children:a.gamePoints?.team2||0})]})]}),i.jsx("button",{onClick:async()=>{await X.dismissRoundPopup(r,a)},className:"w-full py-5 bg-gradient-to-r from-cyan-600 to-cyan-500 text-black font-black rounded-2xl shadow-xl hover:scale-[1.02] transition-all uppercase tracking-widest text-sm",children:"Next Round"})]})}),a.showSetPopup&&a.setWinner&&i.jsx("div",{className:"fixed inset-0 z-[110] bg-black/90 backdrop-blur-xl flex items-center justify-center p-4",children:i.jsxs(Y.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"bg-[#1a1f2e] border-2 border-yellow-500/50 p-12 rounded-[4rem] w-full max-w-xl text-center shadow-[0_0_150px_rgba(234,179,8,0.3)]",children:[i.jsx($r,{className:"w-24 h-24 text-yellow-500 mx-auto mb-8 drop-shadow-[0_0_30px_rgba(234,179,8,0.6)]"}),i.jsxs("h2",{className:"text-5xl font-black mb-4 text-white italic tracking-tighter uppercase leading-tight",children:["SET VICTORY!",i.jsx("br",{}),"TEAM ",a.setWinner.team," WINS"]}),i.jsx("div",{className:"text-yellow-500 font-mono mb-10 uppercase tracking-[0.2em] text-sm font-bold",children:"Total Set Domination"}),i.jsxs("div",{className:"bg-white/5 rounded-[2rem] p-8 mb-10 border border-white/10",children:[i.jsx("div",{className:"text-xl font-bold text-white mb-4 uppercase tracking-widest",children:"Final Pips"}),i.jsxs("div",{className:"flex justify-around items-center",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-xs text-cyan-400 mb-2 uppercase font-black",children:"Team 1"}),i.jsx("div",{className:`text-4xl font-black ${a.setWinner.team===1?"text-white":"text-white/40"}`,children:Math.abs(a.gamePoints?.team1||0)})]}),i.jsx("div",{className:"h-12 w-[2px] bg-white/10"}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-xs text-pink-400 mb-2 uppercase font-black",children:"Team 2"}),i.jsx("div",{className:`text-4xl font-black ${a.setWinner.team===2?"text-white":"text-white/40"}`,children:Math.abs(a.gamePoints?.team2||0)})]})]})]}),i.jsx("button",{onClick:async()=>{await X.dismissSetPopup(r,a)},className:"w-full py-6 bg-yellow-500 text-black font-black rounded-3xl shadow-[0_10px_40px_rgba(234,179,8,0.3)] hover:scale-[1.05] active:scale-95 transition-all uppercase tracking-[0.3em] text-lg",children:"OK - Next Set"})]})}),(a.phase==="completed"||l.status==="completed")&&i.jsx("div",{className:"fixed inset-0 z-[100] bg-black/80 backdrop-blur-md flex items-center justify-center p-4",children:i.jsxs(Y.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"bg-[#1a1f2e] border border-cyan-500/30 p-10 rounded-[3rem] w-full max-w-lg text-center shadow-[0_0_100px_rgba(6,182,212,0.2)]",children:[i.jsx($r,{className:"w-20 h-20 text-yellow-400 mx-auto mb-6 drop-shadow-[0_0_30px_rgba(250,204,21,0.5)]"}),i.jsx("h2",{className:"text-4xl font-black mb-2 text-white italic tracking-tighter uppercase",children:(a.gamePoints?.team1||0)>=6||(a.gamePoints?.team2||0)<=-6?"MATCH VICTORY":"MATCH OVER"}),i.jsx("div",{className:"text-cyan-400 font-mono mb-8 uppercase tracking-widest text-xs",children:"Final Set Results"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-10",children:[i.jsxs("div",{className:`p-6 rounded-3xl border transition-all ${(a.gamePoints?.team1||0)>=0?"bg-cyan-500/10 border-cyan-500/20 shadow-[inset_0_0_20px_rgba(6,182,212,0.1)]":"bg-red-500/10 border-red-500/20 shadow-[inset_0_0_20px_rgba(239,68,68,0.1)]"}`,children:[i.jsx("div",{className:"text-[10px] font-black uppercase mb-1",style:{color:(a.gamePoints?.team1||0)>=0?"#06b6d4":"#ef4444"},children:"Your Team"}),i.jsx("div",{className:"text-4xl font-black text-white",children:Math.abs(a.gamePoints?.team1||0)}),i.jsx("div",{className:"text-[10px] text-gray-500 mt-2",children:(a.gamePoints?.team1||0)>=0?"RED PIPS (WON)":"BLACK PIPS (LOST)"})]}),i.jsxs("div",{className:`p-6 rounded-3xl border transition-all ${(a.gamePoints?.team2||0)>=0?"bg-pink-500/10 border-pink-500/20 shadow-[inset_0_0_20px_rgba(236,72,153,0.1)]":"bg-red-500/10 border-red-500/20 shadow-[inset_0_0_20px_rgba(239,68,68,0.1)]"}`,children:[i.jsx("div",{className:"text-[10px] font-black uppercase mb-1",style:{color:(a.gamePoints?.team2||0)>=0?"#ec4899":"#ef4444"},children:"Opponents"}),i.jsx("div",{className:"text-4xl font-black text-white",children:Math.abs(a.gamePoints?.team2||0)}),i.jsx("div",{className:"text-[10px] text-gray-500 mt-2",children:(a.gamePoints?.team2||0)>=0?"RED PIPS (WON)":"BLACK PIPS (LOST)"})]})]}),i.jsx("button",{onClick:()=>t("/play"),className:"w-full py-5 bg-gradient-to-r from-cyan-600 to-cyan-500 text-black font-black rounded-2xl shadow-xl hover:scale-[1.02] transition-all uppercase tracking-widest text-sm",children:"Return To Lobby"})]})}),h&&i.jsx(fn,{title:"Time Expired!",message:"A player took too long to move. The game has been paused.",onBack:()=>t("/play"),onNew:()=>t("/play/create")}),u&&i.jsx(fn,{title:"Player Left!",message:`${u} has left the match. You can start a new game or return to the lobby.`,onBack:()=>t("/play"),onNew:()=>t("/play/create")}),a.lastTrickCards&&a.lastTrickCards.length>0&&o&&i.jsxs("div",{className:"fixed left-20 top-1/2 -translate-y-1/2 flex flex-col gap-2 bg-[#1a1f2e]/95 backdrop-blur-xl p-4 rounded-3xl border border-cyan-500/20 shadow-[0_0_50px_rgba(0,0,0,0.5)] z-50 min-w-[180px]",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("span",{className:"text-[10px] uppercase font-black text-white/40 tracking-[0.2em]",children:"Previous Trick"}),i.jsx("button",{onClick:()=>c(!1),className:"text-white/40 hover:text-white transition-colors",children:""})]}),i.jsx("div",{className:"flex flex-col gap-2",children:a.lastTrickCards.slice(-4).map((k,R)=>i.jsxs("div",{className:"flex items-center gap-3 bg-white/5 p-2 rounded-xl border border-white/5",children:[i.jsx("div",{className:"scale-[0.6] -m-3",children:i.jsx(St,{card:k.card,size:"sm"})}),i.jsxs("div",{className:"flex flex-col",children:[i.jsx("span",{className:"text-[10px] font-black text-white/90 leading-tight",children:k.playerName?.split(" ")[0]}),i.jsx("span",{className:"text-[8px] font-bold text-cyan-400/60 uppercase",children:"Played"})]})]},R))})]})]})},fn=({title:r,message:e,onBack:t,onNew:n})=>i.jsx("div",{className:"fixed inset-0 z-[150] bg-black/95 backdrop-blur-2xl flex items-center justify-center p-4",children:i.jsxs(Y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-[#1a1f2e] border border-cyan-500/30 p-8 md:p-12 rounded-[3.5rem] w-full max-w-md text-center shadow-[0_0_100px_rgba(6,182,212,0.3)]",children:[i.jsx("div",{className:"w-20 h-20 bg-cyan-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-cyan-500/20",children:i.jsx("span",{className:"text-4xl",children:""})}),i.jsx("h2",{className:"text-3xl font-black mb-2 text-white italic tracking-tighter uppercase",children:r}),i.jsx("p",{className:"text-gray-400 mb-10 text-sm leading-relaxed",children:e}),i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsx("button",{onClick:n,className:"w-full py-4 bg-gradient-to-r from-cyan-600 to-cyan-500 text-black font-black rounded-2xl shadow-xl hover:scale-[1.02] transition-all uppercase tracking-widest text-sm",children:"Start New Game"}),i.jsx("button",{onClick:t,className:"w-full py-4 bg-white/5 border border-white/10 text-white font-bold rounded-2xl hover:bg-white/10 transition-all uppercase tracking-widest text-xs",children:"Back to Lobby"})]})]})}),Fa=()=>{const{id:r}=Cr(),[e,t]=w.useState(null),[n,s]=w.useState(!0);return w.useEffect(()=>{r&&X.getMatch(r).then(o=>{o&&t(o.gameId),s(!1)})},[r]),n?i.jsx("div",{className:"min-h-screen bg-[var(--bg-primary)] flex items-center justify-center",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-[var(--accent)]"})}):e==="chess"?i.jsx(Sa,{}):e==="card29"?i.jsx(Ta,{}):i.jsx("div",{className:"min-h-screen bg-[var(--bg-primary)] flex items-center justify-center text-[var(--text-primary)]",children:i.jsxs("div",{className:"text-center",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Game Not Found"}),i.jsx("p",{className:"text-[var(--text-secondary)]",children:"Invalid game type"})]})})};export{Fa as default};
